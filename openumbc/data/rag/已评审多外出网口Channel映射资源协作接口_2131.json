{
    "topic_id": 2131,
    "question": "【已评审】多外出网口Channel映射资源协作接口 - content: issue 链接\n评审背景\n前置评审\n\n【已评审】支持双网口场景channel配置及定制化评审 Interface评审\n\n    背景介绍： \n诉求： BMC双网口场景，eth0固定为NCSI口，eth2固定为专用口，双网口有独立IP。该场景两个网口分别会作为一个IPMI的LAN通道，需要支持CSR配置以及定制会对应LAN通道的channel nunmber。 \n现状： 由于ipmi相关组件内部已经固定分配LAN2的channel number为2，channel number 8也被用作其他通道，预期LAN2的chann…\n  \n\n需求\n多个产业和客户有诉求，需要BMC提供多个外出网口来对接不同的网管或者处理不同通道的外来的管理业务请求，其中就包括使用 IPMI over LAN 进行BMC的管理，对 BMC 支持的对外 LAN 的Channel 要求有多个\n现状\n目前BMC仅有一个对外网口，因此对外提供的 LAN 通道的 Channel Number 也固定为1，不支持其他的对外 Channel\n差距分析\n\n根据 IPMI 规范分析，对于 Channel 的定义上，可以在 [1, 11] 的区间内可以根据厂商自行定义，没有限定说必须通道和 Channel Number 绑定\n根据 BMC 当前的实现，对于外部 LAN 通道的实现已经有两个通道预留，分解为 Channel Number 1/2；当前 BMC 是固定使用1，对于不同客户或者产业的诉求，在通道 2 上大概率存在定制的情况（如某客户要求使用 Channel 8）\n\n解决方案\n根据BMC的现状以及后续产业/客户的诉求，采用 “适配器” 方案进行处理，即：\n\n对于客户面可见的通道是客户定制的通道，如 Channel 8\n对于BMC内部处理的通道是BMC预置的通道，如 Channel 2\n在这两个通道之间建立 配置映射 关系，并且该关于在资源协作接口上暴露，提供给下游进行对应通道切换时或者定制时的业务处理查询和感知\n冲突解决： 如果客户定制的 Channel X 和当前 BMC 已经内部预置的通道发生了冲突，则优先保障客户定制，并且BMC内部的通道以及通道上的业务使用进行平滑迁移（自行建立一个映射，映射到没有使用的一个通道上）然后继续提供服务\n\n大致方案流程如下：\nsequenceDiagram\n    participant 用户\n    participant RMCP\n    participant IPMI管理\n    participant 业务处理\n\n    用户->>+RMCP: IPMI请求 (ipmitool -I lan/lanplus)\n    RMCP->>+RMCP: 获取 LAN 的IP，以及通道号\n    RMCP->>+IPMI管理: 获取 通道号 映射规则，判断是否存在映射\n    IPMI管理-->>-RMCP: 返回实时通道映射关系数据\n    RMCP->>+业务处理: 更新上下文通道号，并且发送请求\n    业务处理-->>-RMCP: 返回处理结果响应数据\n    RMCP-->>-用户: IPMI响应 (数据)\n\n评审点\n评审点1：新增资源协作接口，用于表征对外多网口的不同Channel映射关系\npath（新增）： /bmc/kepler/IpmiService/Channels/:Id\ninterface（新增）： bmc.kepler.IpmiService.ChannelNumberMapping\n新增属性如下：\n\n属性名称\n签名\n权限\n持久化\n变化通知\n属性值来源\n说明\n\nExternal\ny\nR：ReadOnlyW：不支持\n掉电\ntrue\n业务更新\n对外的通道号\n\nInternal\ny\nR：ReadOnlyW：不支持\n掉电\nfalse\n业务更新\n对内的通道号\n\n评审结论\n通过，具体结论如下：\n\n同意新增资源 /bmc/kepler/IpmiService/Channels/:Id 和资源协作接口  bmc.kepler.IpmiService.ChannelNumberMapping\n同意在资源协作接口  bmc.kepler.IpmiService.ChannelNumberMapping 下新增属性 External，Internal，分别表征通道映射的对外和对内的通道号，属性签名均为 y，并且均需要掉电持久化，均为只读属性；其中属性 External 需要发送变更通知，告知下游的业务当前对外通道发生变化\nlinks: #p-5363-issue-1, #p-5363-h-2, #p-5363-h-3, https://discuss.openubmc.cn/t/topic/1748, /c/sig-interface/40-category/40, #p-5363-h-4, #p-5363-h-5, #p-5363-h-6, #p-5363-h-7, #p-5363-h-8, #p-5363-h-1channel-9, #p-5363-h-10",
    "topic_user_name": "pengqiang",
    "best_answer_url": "",
    "reply_posts": []
}