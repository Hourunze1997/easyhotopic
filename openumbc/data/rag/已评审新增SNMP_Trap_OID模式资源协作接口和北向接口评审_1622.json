{
    "topic_id": 1622,
    "question": "【已评审】新增SNMP Trap OID模式资源协作接口和北向接口评审 - content: ISSUE链接\n【需求】支持通过接口查询和配置SNMP Trap模式-rackmount-GitCode\n评审背景\nSNMP Trap报文当前仅支持精准告警模式，部分客户对OID模式存在诉求，需要新增OID模式\n触发原因\n新需求\n决策点\n一、新增接口\n1. 新增资源协作接口属性：TrapMode\npath：/bmc/kepler/EventService/Subscriptions/Snmp\ninterface：bmc.kepler.EventService.Subscriptions.Snmp\n变化类型：新增属性\n应用场景：客户需要通过snmp trap进行告警订阅时，选择不同的trap报文模式\n详细描述：\n\n属性名称\n变化类型\n签名\n读写权限\n持久化\n默认值\n变化通知\n接口说明\n接口约束\n\nTrapMode\n新增属性\ny\n读写read:ReadOnlywrite:BasicSetting\n掉电持久化\n2\nfalse\nsnmp trap报文模式\n取值：0：预留1：OID模式2：精准告警模式\n\n二、历史接口相关属性说明\n说明：SNMP Trap报文模式查询和设置已存在相关历史接口，openUBMC版本尚未实现，因此需要在openUBMC实现对应的北向接口，支持设置的模式仅为“OID模式”、“精准告警模式”两种。\n1. redfish接口/redfish/v1/Managers/1/SnmpService 增加属性TrapMode\nuri：/redfish/v1/Managers/1/SnmpService\n变化类型：在SnmpTrapNotification下增加属性TrapMode\n操作类型：GET/PATCH\n应用场景：客户需要通过snmp trap进行告警订阅时，使用redfish接口查询和配置trap报文模式\n详细描述：\n\n属性名称\n取值类型\n说明\n取值范围\n操作权限\n是否频繁变化\n约束\n\nTrapMode\nString\nSNMP Trap报文模式\n“OID” “PreciseAlarm\nGET:ReadOnlyPATCH:BasicSetting\n否\n\n2. web_rest接口/UI/Rest/Maintenance/TrapNotification 增加属性Mode\n变化类型：新增属性\n操作类型：GET/PATCH\n应用场景：客户需要通过snmp trap进行告警订阅时，使用WEB UI查询和配置trap报文模式\n详细描述：\n\n属性名称\n取值类型\n说明\n取值范围\n操作权限\n约束\n\nMode\nString\nSNMP Trap报文模式\n“OID” “PreciseAlarm\nGET:ReadOnlyPATCH:BasicSetting\n\n3. cli接口增加mode参数\nCLI命令：ipmcget -t trap -d mode\n变化类型：新增参数\n操作类型：Get\n应用场景：客户需要通过snmp trap进行告警订阅时，使用cli接口查询trap报文模式\n\n响应示例\n响应说明\n响应参数\n取值类型\n取值范围\n约束\n\nTrap mode : <mode>\nsnmp trap报文模式\nmode\nstring\nOID  Precise Alarm\n\nCLI命令：ipmcset -t trap -d mode -v <option>\n变化类型：新增参数\n操作类型：Set\n应用场景：客户需要通过snmp trap进行告警订阅时，使用cli接口配置trap报文模式\n\n参数名称\n参数说明\n取值类型\n取值范围\n约束\n\noption\nsnmp trap报文模式\ninteger\n1：OID模式2：精准告警模式\n\n4. SNMP接口新增trapMode节点\nSNMP OID：1.3.6.1.4.1.{{SnmpOemIdentifier}}.4.4.0\n变化类型：新增OID节点\n应用场景：客户需要通过snmp trap进行告警订阅时，使用snmp接口查询和配置trap报文模式\n操作类型： GET/PATCH\n\nOID\n节点名称\n取值类型\n取值范围\n读写操作\n约束\n\n1.3.6.1.4.1.{{SnmpOemIdentifier}}.4.4.0\ntrapMode\ninteger\n1：reserved2：trapOidMode 3：trapPreciseAlarmMode\nread-write\n\n5. 新增定制化项Custom_Trap_Mode\n应用场景：客户需要通过snmp trap进行告警订阅时，定制选择不同的trap报文模式\n详细说明：\n\n定制化项名称\n定制化项\n归属组件\n取值说明\n默认值\n处理逻辑\n说明\n实现方式\n\n定制snmp trap报文模式\nCustom_Trap_Mode\nevent_policy\n1：OID模式 2：精准告警模式\n2\nif (Custom_Trap_Mode == 1）    设置trap报文模式为OID模式 elseif(Custom_Trap_Mode == 2 or Custom_Trap_Mode == 空)    设置trap报文模式为精准告警模式else         设置失败\n\n配置导入导出\n\n6. 新增配置导入导出项TrapMode\n应用场景：客户需要通过snmp trap进行告警订阅时，定制选择不同的trap报文模式\n详细说明：\n\n配置项名称\n配置项类别\n配置项\n归属组件\n取值说明\n导入导出类型\n导出后是否可直接导入\n\nsnmp trap报文模式\n服务配置类\nTrapMode\nevent_policy\n1：OID模式 2：精准告警模式\nImportAndExport\n是\n\n评审结论\n决策点一：同意资源协作接口新增属性，用于标识snmp trap报文模式，具体如下：\npath：/bmc/kepler/EventService/Subscriptions/Snmp\ninterface：bmc.kepler.EventService.Subscriptions.Snmp\n新增属性名称：TrapMode\n签名：y\n读写权限：read:ReadOnly，write:BasicSetting\n持久化类型：掉电持久化\n接口说明：snmp trap报文模式，不发送变更通知事件，取值 0：预留，1：OID模式，2：精准告警模式\n默认值：2\n决策点二：历史接口说明\n1. 同意redfish接口新增属性支持用户查询和设置snmp trap报文模式\n具体如下：\nuri：/redfish/v1/Managers/1/SnmpService\n变化类型：在SnmpTrapNotification下新增属性TrapMode\n操作类型：GET/PATCH\n操作权限：GET:ReadOnly，PATCH:BasicSetting\n取值范围：“OID”，“PreciseAlarm”\n2. 同意webrest接口新增属性支持用户查询和设置snmp trap报文模式\n具体如下：\nuri：/UI/Rest/Maintenance/TrapNotification\n变化类型：新增属性Mode\n操作类型：GET/PATCH\n操作权限：GET:ReadOnly，PATCH:BasicSetting\n取值范围：“OID”，“PreciseAlarm”\n3. 同意cli接口增加命令支持用户查询和设置snmp trap报文模式\n命令：ipmcget -t trap -d mode\n操作类型：Get\n回显格式：Trap mode : <mode>\n参数说明：\nmode - 字符串类型，取值范围：OID 、Precise Alarm\n命令：ipmcset -t trap -d mode -v <option>\n操作类型：Set\n参数说明：\noption - 整数类型，取值范围：1：OID模式  2：精准告警模式\n4. 同意新增SNMP接口支持用户查询和设置snmp trap报文模式\nSNMP OID：1.3.6.1.4.1.{{SnmpOemIdentifier}}.4.4.0\n变化类型：新增OID节点\n节点名称：trapMode\n取值类型：integer\n取值范围：1：reserved  2：trapOidMode 3：trapPreciseAlarmMode\n读写操作：read-write\n5. 同意新增定制化项支持出厂定制snmp trap报文模式\n定制化项：Custom_Trap_Mode\n取值范围：1：OID模式 2：精准告警模式\n处理逻辑：\nif (Custom_Trap_Mode == 1） 设置trap报文模式为OID模式 elseif(Custom_Trap_Mode == 2) 设置trap报文模式为精准告警模式else  设置失败\n默认值：2\n6. 同意新增配置导入导出支持用户设置snmp trap报文模式\n配置项名称：TrapMode\n取值范围：1：OID模式 2：精准告警模式\n导入导出类型：ImportAndExport\n导出后是否可直接导入：是\nlinks: #p-3941-issue-1, https://gitcode.com/openUBMC/rackmount/issues/195, #p-3941-h-2, #p-3941-h-3, #p-3941-h-4, #p-3941-h-5, #p-3941-h-1-trapmode-6, #p-3941-h-7, #p-3941-h-1-redfishredfishv1managers1snmpservice-trapmode-8, #p-3941-h-2-web_restuirestmaintenancetrapnotification-mode-9, #p-3941-h-3-climode-10, #p-3941-h-4-snmptrapmode-11, #p-3941-h-5-custom_trap_mode-12, #p-3941-h-6-trapmode-13, #p-3941-h-14, #p-3941-snmp-trap-15, #p-3941-h-16, #p-3941-h-1-redfishsnmp-trap-17, #p-3941-h-2-webrestsnmp-trap-18, #p-3941-h-3-clisnmp-trap-19, #p-3941-h-4-snmpsnmp-trap-20, #p-3941-h-5-snmp-trap-21, #p-3941-h-6-snmp-trap-22",
    "topic_user_name": "chengkun",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1622/2",
            "text": ""
        }
    ]
}