{
    "topic_id": 1179,
    "question": "【已评审】支持能效管理子系统组件在线调试客户端自定义命令 - content: 背景\n能效组件需支持在线调试自定义命令，并区分debug版本命令和release版本命令，即release包中仅包含release相关命令，debug包中包含所有命令。\n现状：能效组件无在线调试自定义命令及其对应的资源协作接口\n决策点\n新增path：/bmc/kepler/Debug/PowerStrategy，interface：bmc.kepler.Debug.EnergySavingMeasurement和方法SetPeriod\n新增path：/bmc/kepler/Debug/PowerStrategy，interface：bmc.kepler.Debug.PowerCapping，方法：SimulatePowerCappingTask和SimulatePowerCappingConfig\n在path：/bmc/kepler/Systems/:SystemId/PowerMgmt/:ID下，新增interface： bmc.kepler.Release.OnePower.Collector，方法： GetFanSpeed和GetRegisterValue\n将接口bmc.kepler.Debug.BlackBox和其方法DumpPsuBlackbox放置新增路径/bmc/kepler/Debug/Chassis/:ChasisId/PowerMgmt/:ID下\n新增path：/bmc/kepler/Debug/ThermalMgmt，interface： bmc.kepler.Debug.PidConfiguration，方法： GetVersion，SetPidPrintMode，SetPidConfigItem\n在path：bmc/kepler/ThermalMgmt下，新增interface： bmc.kepler.Release.ThermalControlStrategy，方法：GetActivatedPolicy\n描述\n决策点1：\n资源path：/bmc/kepler/Debug/PowerStrategy\n资源interface：bmc.kepler.Debug.EnergySavingMeasurement\n变化类型：新增方法\n应用场景：节能专家推荐系统中，修改计算周期，进行策略重新推荐\n持久化类型：不涉及\n操作权限：BasicSetting\n\n方法名称\n变化类型\n签名\n读写&权限\n持久化\n变化通知\n接口说明\n接口约束\n命令字\n描述(displayDescription)\n\nSetPeriod\n新增方法\n请求: u  响应：–\nBasicSetting\n不涉及\n不涉及\n设置节能专家推荐系统计算周期请求：Period：计算周期时间，单位为秒，最小时间为60s，最大时间为86400s（24小时）响应：无\n为防止对能效组件性能影响，最小时间为60s，最大时间为86400s（24小时）\nsetpwrcalcperiod\n方法描述： Set the calculation period of the energy saving measurement.  请求参数描述： Period：Energy saving measurement calculation period, in seconds, which range is [60, 86400].For example: setpwrcalcperiod 60.\n\n决策点2：\n资源path：/bmc/kepler/Debug/PowerStrategy\n资源interface：bmc.kepler.Debug.PowerCapping\n变化类型：新增方法\n应用场景：模拟功耗封顶；设置功耗封顶下限建议值，模拟上报功耗封顶失败事件\n持久化类型：不持久化\n操作权限：PowerMgmt\n\n方法名称\n变化类型\n签名\n读写&权限\n持久化\n变化通知\n接口说明\n接口约束\n命令字\n描述(displayDescription)\n\nSimulatePowerCappingTask\n新增方法\n请求: yd  响应：–\nPowerMgmt\n不涉及\n不涉及\n通过模拟整机功耗值进行功耗封顶请求：Mode：是否开启整机功耗调试模式，取值0和1,0表示关闭，1表示开启Ratio：功耗封顶值比例范围[0.1, 1.0]，该参数为可选参数\nMode取值只能为0和1Ratio取值范围为[0.1, 1.0].\npwrcapsyspwrmock\n方法描述： Simulate the system power for power capping.  请求参数描述： Mode：Indicate whether to enable the system power debug mode， 0: disable, 1: enable.  Ratio：Modify ratio value，which range is [0.1, 1.0] to simulate the system power.  For example: 1. pwrcapsyspwrmock 0; 2. pwrcapsyspwrmock 1 0.1.\n\nSimulatePowerCappingConfig\n新增方法\n请求: yu  响应：–\nPowerMgmt\n不涉及\n不涉及\n设置功耗封顶下限值，以及模拟上报功耗封顶失败事件请求请求：Type：调试类型，0表示模拟功耗封顶下限值，1表示模拟上报功耗封顶失败事件Value：功耗封顶下限值，该参数为可选参数\nType当前只支持0和1，保留扩展性Value值仅在Type取值为0时生效\npwrcapmock\n方法描述： Set lower limit of power capping or simulate the power capping failure event.  请求参数描述： Type：Indicate power capping debug type, 0: Simulate power capping lower limit value, 1: Simulate the power capping failure event. Value: Lower limit of the power capping value, which is used when type is set to 0.  For example: 1. pwrcapmock 0 100; 2. pwrcapmock 1.\n\n决策点3：\n资源path：/bmc/kepler/Systems/:SystemId/PowerMgmt/:ID\n资源interface：bmc.kepler.Release.OnePower.Collector\n变化类型：新增方法\n应用场景：查询电源风扇转速，查询电源I2C信息\n持久化类型： 不持久化\n操作权限：ReadOnly\n\n方法名称\n变化类型\n签名\n读写&权限\n持久化\n变化通知\n接口说明\n接口约束\n命令字\n描述(displayDescription)\n\nGetFanSpeed\n新增方法\n请求: –响应: q\nReadOnly\n不涉及\n不涉及\n获取电源风扇转速响应参数：FanSpeed：电源风扇转速\n无\ngetpsufanspeed\n方法描述：Get PSU fan speed.响应参数描述：FanSpeed:  PSU fan speed. For example: getpsufanspeed OnePower_0_010109.\n\nGetRegisterValue\n新增方法\n请求：uu响应：ay\nReadOnly\n不涉及\n不涉及\n获取电源寄存器信息请求参数：Cmd：电源寄存器地址Length：读取长度响应参数：OutData：寄存器读取结果\n传入的寄存器地址需为当前已支持的电源寄存器地址，否则返回操作失败\ngetpsureg\n方法描述：Get PSU register value.请求参数描述：Cmd: PSU register address.Length: Read length.  For example: getpsureg OnePower_0_010109 144 2.\n\n资源path：/bmc/kepler/Debug/Chassis/:ChasisId/PowerMgmt/:ID\n资源interface：bmc.kepler.Debug.BlackBox\n变化类型：DumpPsuBlackbox（该方法已存在）\n应用场景：收集黑匣子日志\n持久化类型： 不持久化\n操作权限：ReadOnly\n\n方法名称\n变化类型\n签名\n读写&权限\n持久化\n变化通知\n接口说明\n接口约束\n命令字\n描述(displayDescription)\n\nDumpPsuBlackbox\n该方法已存在\n请求：–响应：–\nReadOnly\n不涉及\n不涉及\n收集电源黑匣子日志\n无\ndumppsublackbox\n方法描述：Dump PSU blackbox data. (file path: /var/log/ps_black_box.log)  For example: dumppsublackbox OnePowerDebug_0_010109.\n\n决策点4：\n资源path：/bmc/kepler/Debug/ThermalMgmt/\n资源interface：bmc.kepler.Debug.PidConfiguration\n变化类型：新增方法\n应用场景：PID相关查询和设置\n持久化类型： 不持久化\n操作权限：ReadOnly/BasicSetting\n\n方法名称\n变化类型\n签名\n读写&权限\n持久化\n变化通知\n接口说明\n接口约束\n命令字\n描述(displayDescription)\n\nGetVersion\n新增方法\n无\nReadOnly\n不涉及\n不涉及\n打印PID版本信息\n无约束\ngetpidver\n方法描述：Print PID version.  For example: getpidver.\n\nSetPidPrintMode\n新增方法\n请求：yy响应：–\nBasicSetting\n不涉及\n不涉及\n设置PID信息打印开关请求参数：Type：PID信息类型，1表示配置信息，2表示控制信息Enabled：PID信息打印开关，取值为0和1, 0表示关闭信息打印，1表示开启信息打印\n当前Type仅支持配置信息和控制信息\nsetpidprintmode\n方法描述：Set PID message output.请求参数描述：Type:  PID message type, 1: configuration message, 2: control message.Enabled: Indicate whether to enable to print PID message, 0: disable, 1: enable.  For example: setpidprintmode 0 1.\n\nSetPidConfigItem\n新增方法\n请求：yy响应：–\nBasicSetting\n不涉及\n不涉及\n设置PID模块配置信息请求参数：ItemIndex：PID场景识别配置项索引，当前仅支持0表示高温场景。ItemValue：配置场景值\nItemIndex：当前仅支持0高温场景 ItemValue：配置场景值\nsetpidconf\n方法描述：Set PID module configuration items.请求参数描述：ItemIndex: PID configuration item index, 0: high-temperature configuration item. ItemValue: Indicate configuration item value   For example: setpidconf 0 1.\n\n决策点5：\n资源path：/bmc/kepler/ThermalMgmt/\n资源interface：bmc.kepler.Release.ThermalControlStrategy\n变化类型：新增方法\n应用场景：查询当前转速生效的策略\n持久化类型： 不持久化\n操作权限：ReadOnly\n\n方法名称\n变化类型\n签名\n读写&权限\n持久化\n变化通知\n接口说明\n接口约束\n命令字\n描述(displayDescription)\n\nGetActivatedPolicy\n新增方法\n请求：sy响应：s\nReadOnly\n不涉及\n不涉及\n获取指定散热器件和模式生效的调速因子请求参数：Type：散热器件类型，取值为FanMode：查询模式，0表示生效因子，1表示生效算法响应参数：ActivatedPolicy\nType取值为FanMode取值为0调速因子，1表示调速算法ActivatedPolicy取值为：当Mode为0时：MPC – 自动调速模式下，MPC生效时显示传感器名称 – 自动调速模式下，MPC未生效时显示异常调速因子名称 – 自动调速模式下，MPC未生效时且存在异常调速时显示（比如：风扇不在位）N/A – 手动调速模式下显示当Mode为1时：MPC – 自动调速模式下，MPC生效时显示PID  – 自动调速模式下，PID生效时显示N/A – 手动调速模式下显示\ngetactivatedpolicy\n方法描述：Get activated policy for a specified cooling device type and mode.请求参数描述：Type: Cooling device type, include Fan.Mode: Cooling effective mode, 0: effective factor, 1: algorithm\n\n评审结论\n决策点1：\n新增path：/bmc/kepler/Debug/PowerStrategy，interface：bmc.kepler.Debug.EnergySavingMeasurement和方法SetPeriod\n结论：同意新增上述path，interface和method\n方法名：SetPeriod\n请求签名：u\n响应签名：无\n读写&权限：BasicSetting\n决策点2. 新增path：/bmc/kepler/Debug/PowerStrategy，interface：bmc.kepler.Debug.PowerCapping，方法：SimulatePowerCappingTask和SimulatePowerCappingConfig\n结论：同意新增上述path，interface和method\n方法名：SimulatePowerCappingTask\n请求签名：yd\n响应签名：无\n读写&权限：PowerMgmt\n方法名：SimulatePowerCappingConfig\n请求签名：yu\n响应签名：无\n读写&权限：PowerMgmt\n决策点3.\n①. 在path：/bmc/kepler/Systems/:SystemId/PowerMgmt/:ID下，新增interface： bmc.kepler.Release.OnePower.Collector，方法： GetActualFanSpeed和GetRegisterValue\n②. 将接口bmc.kepler.Debug.BlackBox和其方法DumpPsuBlackbox放置新增路径/bmc/kepler/Debug/Chassis/:ChasisId/PowerMgmt/:ID下\n结论：同意新增上述path，interface和method\n方法名：GetFanSpeed\n请求签名：无\n响应签名：q\n读写&权限：ReadOnly\n方法名：GetRegisterValue\n请求签名：uu\n响应签名：ay\n读写&权限：ReadOnly\n决策点4. 新增path：/bmc/kepler/Debug/ThermalMgmt，interface： bmc.kepler.Debug.PidConfiguration，方法： GetVersion，SetPidPrintMode，SetPidConfigItem\n结论：同意新增上述path，interface和method\n方法名：GetVersion\n请求签名：无\n响应签名：无\n读写&权限：ReadOnly\n方法名：SetPidPrintMode\n请求签名：yy\n响应签名：无\n读写&权限：BasicSetting\n方法名：SetPidConfigItem\n请求签名：yy\n响应签名：无\n读写&权限：BasicSetting\n决策点5. 在path：bmc/kepler/ThermalMgmt下，新增interface： bmc.kepler.Release.ThermalControlStrategy，方法：GetActivatedPolicy\n结论：同意新增上述interface和method\n方法名：GetActivatedPolicy\n请求签名：sy\n响应签名：s\n读写&权限：ReadOnly\n遗留问题\n问题1：确认方法是否可以合并为通过不同参数进行调用\n结论1：已将可合并的方法合并，通过不同参数进行调用，具体为SetPidPrintModeEnabled；\n问题2：确认命令字名称；\n结论2：已将需要修改的命令字名称完成修改，并简化个别名称；\nlinks: #p-2549-h-1, #p-2549-h-2, #p-2549-h-3",
    "topic_user_name": "Weber Chen",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1179/4",
            "text": ""
        }
    ]
}