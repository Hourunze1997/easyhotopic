{
    "topic_id": 270,
    "question": "openUBMC整包构建提示gpp_header错误 - manifest.yml 配置\n\n# yaml-language-server: $schema=/usr/share/bmcgo/schema/manifest.platform.schema.json\nbase:\n  # openUBMC四段式版本号定义规则：第1段为1字节，范围是1-9；后3段固定2字节，范围为00-99\n  version: \"1.00.00.00.B001\"\n  # 单板定制化脚本,位于build/customization目录,需要实现一个Customization类\n  customization: \"customization/prototype.py\"\n  rtos_version: 208.8.0\n  rtos_kernel: 5.10_ek_preempt_pro\n  dependency_buildtools: dependency/dependency_buildtools.xml\n  # 签名文件，由构建系统复制到self.config.board_path目录，如需定制\n  signature:\n    ## 伙伴自签名配置示例\n    certificates:\n      rootca_der: ${product}/ca/rootca.der\n      signer_pem: ${product}/ca/signer.pem\n      timestamp_signer_pem: ${product}/ca/ts_signer.pem\n      timestamp_signer_cnf: ${product}/ca/tsa.cnf\n      rootca_crl: ${product}/ca/rootca.crl\n    files:\n      - file: ${product}/ca/rootca.crl\n        dst: cms.crl\n\ndependencies:\n  - conan: huawei_secure_c\n  - conan: kmc\n  ...\n\n编译报错\n\n切换工作目录到: /home/workspace/source/manifest/temp/build_openUBMC_debug_dev/sdk\n切换工作目录到: origin_uboot_debug\n>> gpp_header uboot\nOpen emmc_uboot_header.config fail.\nWARN! file NULL not exist\nERROR: 执行命令 ['/usr/local/bin/gpp_header', 'uboot'] 错误, 日志: /home/workspace/source/manifest/temp/log/task.log\n\nemmc_uboot_header.config 在系统中存在：\n\nfind / -name \"emmc_uboot_header.config\"\n/home/workspace/source/manifest/temp/build_openUBMC_debug_dev/gpp_build_dir/emmc_uboot_header.config\n/usr/local/bin/emmc_uboot_header.config\n\nmanifest 最新提交：\n\ngit log\ncommit 194d39223c350f95767c4bab55b6aa14ab636ab8 (HEAD -> main, origin/main, origin/HEAD)\nMerge: fae0914 4102748\nAuthor: openUBMC-robot <chaotomzhu@gmail.com>\nDate:   Tue Mar 18 23:08:08 2025 +0800\n\n    merge dev into main\n\n    品牌信息白牌化\n\n    Created-by: xyzheng1122\n    Commit-by: xyzheng1122\n    Merged-by: openUBMC-robot\n    Description: 品牌信息白牌化\n\n    See merge request: openUBMC/manifest!35",
    "topic_user_name": "易重辉",
    "best_answer_url": "/t/topic/270/10",
    "reply_posts": [
        {
            "user_name": "xuhaijun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/2",
            "text": "content: yizhonghui:\n\nemmc_uboot_header.config\n\n参考 3.3日clone的manifest，签名相关问题导致编译报错 处理\nlinks: https://gitcode.com/openUBMC/manifest/issues/4?ref=&did=408ea84fa41ff97d2738732a4a21fa10de20c633#tid-78520131"
        },
        {
            "user_name": "易重辉",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/3",
            "text": "content: 我的这个报错信息，和3.3日clone的manifest，签名相关问题导致编译报错 是不一样的\n尝试用上述方法，但是报错没有变\n在gpp/files中新增配置 - file: /usr/local/bin/emmc_uboot_header.config\n\n目前是这么加的：\n...\ngpp:\n  files:\n    # rootfs镜像文件固定为rootfs_BMC.img\n    - file: ${work_out}/rootfs_iBMC.img\n    # rootfs镜像压缩文件固定为rootfs_BMC.img\n    - file: ${work_out}/rootfs_iBMC.tar.gz\n    # rootfs_BMC.img的cms签名文件\n    - file: ${work_out}/rootfs_iBMC.img.cms\n\n    - file: /usr/local/bin/emmc_uboot_header.config\n\n    ## 伙伴自签名配置示例\n    # 签名文件的证书吊销列表\n    - file: ${product}/ca/rootca.crl\n      dst: cms.crl\n    # 签名的根证书\n    - file: ${product}/ca/rootca.der\n      dst: rootca.der\n...\nlinks: https://gitcode.com/openUBMC/manifest/issues/4?ref=&did=408ea84fa41ff97d2738732a4a21fa10de20c633#tid-78520131"
        },
        {
            "user_name": "xuhaijun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/4",
            "text": "需要详细堆栈信息，构建时设置LOG=info环境变量，可以打印堆栈，命令示例：LOG=info bmcgo build"
        },
        {
            "user_name": "易重辉",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/6",
            "text": "LOG=info bmcgo build -b openUBMC\n...\n[2025-03-24 16:46:08,319 INFO] task.py:233 切换工作目录到: /home/workspace/source/manifest/temp/build_openUBMC_debug_dev/sdk\n[2025-03-24 16:46:08,320 INFO] task.py:233 切换工作目录到: origin_uboot_debug\n[2025-03-24 16:46:08,324 ERROR] task_download_dependency.py:109 执行命令 ['/usr/local/bin/gpp_header', 'uboot'] 错误, 日志: /home/workspace/source/manifest/temp/log/task.log\n[2025-03-24 16:46:08,327 INFO] frame.py:241 Traceback (most recent call last):\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/frame.py\", line 231, in run\n    ret = self._run()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/frame.py\", line 275, in _run\n    ret = work_x.run()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py\", line 92, in run\n    self.move_dependency()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py\", line 76, in move_dependency\n    self._self_sign_uboot(\"origin_uboot_debug\", \".\", True)\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py\", line 109, in _self_sign_uboot\n    self.run_command(\"gpp_header uboot\")\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task.py\", line 242, in run_command\n    return self.tools.run_command(command, ignore_error, sudo, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/utils/tools.py\", line 570, in run_command\n    raise e\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/utils/tools.py\", line 560, in run_command\n    ret = subprocess.run(command, stdout=log_fd, stderr=log_fd, check=check, timeout=timeout)\n  File \"/usr/lib/python3.8/subprocess.py\", line 516, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command '['/usr/local/bin/gpp_header', 'uboot']' returned non-zero exit status 255.\n\n[2025-03-24 16:46:08,327 ERROR] frame.py:243 Command '['/usr/local/bin/gpp_header', 'uboot']' returned non-zero exit status 255.\n[2025-03-24 16:46:10,388 ERROR] cli.py:365 任务 personal 执行失败\n[2025-03-24 16:46:10,388 ERROR] cli.py:366 请查看日志信息\n...\n\ncat /home/workspace/source/manifest/temp/log/task.log\n...\n[2025-03-24 16:49:07,755 INFO] task.py:233 切换工作目录到: /home/workspace/source/manifest/temp/build_openUBMC_debug_dev/sdk\n[2025-03-24 16:49:07,756 INFO] task.py:233 切换工作目录到: origin_uboot_debug\nOpen emmc_uboot_header.config fail.\nWARN! file NULL not exist\n[2025-03-24 16:49:07,760 ERROR] task_download_dependency.py:109 执行命令 ['/usr/local/bin/gpp_header', 'uboot'] 错误, 日志: /home/workspace/source/manifest/temp/log/task.log\n..."
        },
        {
            "user_name": "xuhaijun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/7",
            "text": "yizhonghui:\n\n_self_sign_uboot\n\nOk，此问题需要转开发定位，稍等。"
        },
        {
            "user_name": "yaoshun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/8",
            "text": "yizhonghui:\n\n- file: /usr/local/bin/emmc_uboot_header.config\n\ncat  /usr/local/bin/emmc_uboot_header.config看一下"
        },
        {
            "user_name": "易重辉",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/9",
            "text": "root@d607db415317:/home/source# cat /usr/local/bin/emmc_uboot_header.config\nGPP_MAX_SIZE                =      384\nFW_NUM                      =      3\nBOOT_NAME                   =      uboot.bin\nBOOT_SITE                   =      -3145728\nBOOT_SIZE                   =      2097152\nROOTFS_Header_NAME          =      NULL\nROOTFS_Header_SITE          =      -4194304\nROOTFS_Header_SIZE          =      1048576\nROOTFS_NAME                 =      NULL\nROOTFS_SITE                 =      0\nROOTFS_SIZE                 =      0\n\n//uboot SUB HEADER的相关配置\n//VendorSig: 产商签名是否开启\n//CustomerSig: 客户签名是否开启\nVendorSig                   =      ENABLE\nCustomerSig                 =      DISABLE\nVendorRootPubkCertPath      =      rootca.der\nVendorCMSSignaturePath      =      uboot.bin.cms\nVendorCRLPath               =      cms.crl\nCustomerRootPubkCertPath    =      NULL\nCustomerCMSSignaturePath    =      NULL\nCustomerCRLPath             =      NULL\nROOTFSPath                  =      uboot.bin"
        },
        {
            "user_name": "易重辉",
            "topic_closed": true,
            "is_solution": true,
            "post_url": "/t/topic/270/10",
            "text": "content: 补充版本信息\nbmcgo\ndpkg -l hw-ibmc-bmcgo\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name           Version      Architecture Description\n+++-==============-============-============-==============================================\nii  hw-ibmc-bmcgo  0.5.282      all          The bmc depveloper toolkits provided by huawei\n\npip3 show hw-ibmc-bmcgo\nName: hw-ibmc-bmcgo\nVersion: 0.5.214\nSummary: Tools provided by ibmcv3\nHome-page: https://www.huawei.com\nAuthor: None\nAuthor-email: None\nLicense: UNKNOWN\nLocation: /usr/local/lib/python3.8/dist-packages\nRequires: protobuf, pyopenssl, dbus-python, inflection, pyinstaller, pyecharts, conan, jsonschema, pyyaml, mako, gitpython, colorama, cryptography, meson, pysftp, typeguard, setuptools, kafka-python, launchpadlib, node-semver, pyyaml-include\nRequired-by:\n\nmanifest\n最新提交\ncommit 194d39223c350f95767c4bab55b6aa14ab636ab8\nmanifest.yml 签名配置\n cat ./build/product/BMC/openUBMC/manifest.yml\n# yaml-language-server: $schema=/usr/share/bmcgo/schema/manifest.platform.schema.json\nbase:\n  # openUBMC四段式版本号定义规则：第1段为1字节，范围是1-9；后3段固定2字节，范围为00-99\n  version: \"1.00.00.00.B001\"\n  # 单板定制化脚本,位于build/customization目录,需要实现一个Customization类\n  customization: \"customization/prototype.py\"\n  rtos_version: 208.8.0\n  rtos_kernel: 5.10_ek_preempt_pro\n  dependency_buildtools: dependency/dependency_buildtools.xml\n  # 签名文件，由构建系统复制到self.config.board_path目录，如需定制\n  signature:\n    ## 伙伴自签名配置示例\n    certificates:\n      rootca_der: ${product}/ca/rootca.der\n      signer_pem: ${product}/ca/signer.pem\n      timestamp_signer_pem: ${product}/ca/ts_signer.pem\n      timestamp_signer_cnf: ${product}/ca/tsa.cnf\n      rootca_crl: ${product}/ca/rootca.crl\n    #simple_signer_server:\n    # url: 172.17.0.2\n    #  rootca_der: ${product}/ca/rootca.der\n    #  cert_id: _bmc_build\n    #  ssl_verify: false\n    files:\n      - file: ${product}/ca/rootca.crl\n        dst: cms.crl\n\n编译失败原因汇总\nemmc_uboot_header.config 文件找不到\nFileNotFoundError: [Errno 2] No such file or directory: '/home/workspace/source/manifest/temp/build_openUBMC_release_dev/gpp_build_dir/emmc_uboot_header.config'\n\n[2025-03-25 11:11:15,799 ERROR] [Errno 2] No such file or directory: '/home/workspace/source/manifest/temp/build_openUBMC_release_dev/gpp_build_dir/emmc_uboot_header.config'\n[2025-03-25 11:11:17,811 ERROR] 任务 personal 执行失败\n[2025-03-25 11:11:17,812 ERROR] 请查看日志信息\n\n[2025-03-25 11:01:34,001 INFO] 复制 /home/workspace/source/manifest/temp/build_openUBMC_debug_dev/sdk/Hi1711_boot_pmode_debug.bin 到 Hi1711_boot_pmode.bin 并保留权限\n[2025-03-25 11:01:34,002 INFO] >> gpp_header hpm\n[2025-03-25 11:01:34,006 ERROR] 执行命令 ['/usr/local/bin/gpp_header', 'hpm'] 错误, 日志: /home/workspace/source/manifest/temp/log/task.log\n[2025-03-25 11:01:34,009 INFO] Traceback (most recent call last):\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/frame.py\", line 231, in run\n    ret = self._run()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/frame.py\", line 275, in _run\n    ret = work_x.run()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_buildgppbin.py\", line 94, in run\n    self.build_gpp_hpm_bin()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_buildgppbin.py\", line 53, in build_gpp_hpm_bin\n    self.run_command(\"gpp_header hpm\")\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task.py\", line 242, in run_command\n    return self.tools.run_command(command, ignore_error, sudo, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/utils/tools.py\", line 570, in run_command\n    raise e\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/utils/tools.py\", line 560, in run_command\n    ret = subprocess.run(command, stdout=log_fd, stderr=log_fd, check=check, timeout=timeout)\n  File \"/usr/lib/python3.8/subprocess.py\", line 516, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command '['/usr/local/bin/gpp_header', 'hpm']' returned non-zero exit status 255.\n\n[2025-03-25 11:01:34,009 ERROR] Command '['/usr/local/bin/gpp_header', 'hpm']' returned non-zero exit status 255.\n[2025-03-25 11:01:34,013 ERROR] 运行子任务 work.task_hpm_envir_prepare 类 bmcgo.tasks.task_hpm_envir_prepare失败\n[2025-03-25 11:01:34,099 ERROR] 运行子任务 work.task_build_rootfs_img 类 bmcgo.tasks.task_build_rootfs_img失败\n[2025-03-25 11:01:36,103 ERROR] 任务 personal 执行失败\n[2025-03-25 11:01:36,103 ERROR] 请查看日志信息\n\nmake_uboot_img.sh 传参异常\n[2025-03-25 10:56:06,466 INFO] >> make_uboot_img.sh\n[2025-03-25 10:56:06,469 ERROR] 执行命令 ['/usr/local/bin/make_uboot_img.sh'] 错误, 日志: /home/workspace/source/manifest/temp/log/task.log\n[2025-03-25 10:56:06,476 INFO] Traceback (most recent call last):\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/frame.py\", line 231, in run\n    ret = self._run()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/frame.py\", line 275, in _run\n    ret = work_x.run()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py\", line 92, in run\n    self.move_dependency()\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py\", line 76, in move_dependency\n    self._self_sign_uboot(\"origin_uboot_debug\", \".\", True)\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py\", line 111, in _self_sign_uboot\n    self.run_command(\"make_uboot_img.sh\")\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task.py\", line 242, in run_command\n    return self.tools.run_command(command, ignore_error, sudo, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/utils/tools.py\", line 570, in run_command\n    raise e\n  File \"/usr/local/lib/python3.8/dist-packages/bmcgo/utils/tools.py\", line 560, in run_command\n    ret = subprocess.run(command, stdout=log_fd, stderr=log_fd, check=check, timeout=timeout)\n  File \"/usr/lib/python3.8/subprocess.py\", line 516, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command '['/usr/local/bin/make_uboot_img.sh']' returned non-zero exit status 255.\n\n[2025-03-25 10:56:06,476 ERROR] Command '['/usr/local/bin/make_uboot_img.sh']' returned non-zero exit status 255.\n[2025-03-25 10:56:08,548 ERROR] 任务 personal 执行失败\n[2025-03-25 10:56:08,548 ERROR] 请查看日志信息\n\n长期解决方案：\n更新bmcgo软件\n临时解决方案：\n\n修改build/product/BMC/openUBMC/manifest.yml文件，在gpp/files下增加：\n\n    - file: /usr/local/bin/emmc_uboot_header.config\n    - file: /usr/local/bin/hpm_header.config\n\n修改/usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_download_dependency.py文件的函数_self_sign_uboot：\n新增行：\nshutil.copy(\"/usr/local/bin/emmc_uboot_header.config\", \"emmc_uboot_header.config\")\n修改行：\nself.run_command(f\"make_uboot_img.sh 1711\")\n\n修改完成后：\ndef _self_sign_uboot(self, uboot_dir, output_dir, is_debug):\n        output_dir = os.path.realpath(output_dir)\n        rootca_der = self.config.rootca_der\n        rootca_crl = self.config.rootca_crl\n        debug_flag = \"_debug\" if is_debug else \"\"\n        cwd = os.getcwd()\n        cmd = f\"dd if=Hi1711_boot_4096{debug_flag}.bin of={uboot_dir}/l0l1.bin bs=1K count=1K count=768\"\n        self.run_command(cmd)\n        self.run_command(f\"cp bin/signed_bin/sdk/u-boot_cms{debug_flag}.bin {uboot_dir}/u-boot_cms.bin\")\n        self.run_command(f\"cp {rootca_der} {uboot_dir}/rootca.der\")\n        self.run_command(f\"cp {rootca_crl} {uboot_dir}/cms.crl\")\n        self.run_command(f\"cp {uboot_dir}/u-boot.bin {uboot_dir}/uboot.bin\")\n        self.signature(f\"{uboot_dir}/uboot.bin\", f\"{uboot_dir}/uboot.bin.cms\")\n        self.chdir(uboot_dir)\n        # 此处新增\n        shutil.copy(\"/usr/local/bin/emmc_uboot_header.config\", \"emmc_uboot_header.config\")\n        self.run_command(\"gpp_header uboot\")\n        # 此处修改\n        self.run_command(f\"make_uboot_img.sh 1711\")\n        cmd = f\"dd if=Hi1711_boot_4096.bin of={output_dir}/Hi1711_boot_pmode{debug_flag}.bin bs=1K count=1024 skip=768\"\n        self.run_command(cmd)\n        self.run_command(f\"cp Hi1711_boot_4096.bin {output_dir}/Hi1711_boot_4096{debug_flag}.bin\")\n        self.chdir(cwd)\nlinks: #p-452-h-1, #p-452-bmcgo-2, #p-452-manifest-3, #p-452-manifestyml-4, #p-452-h-5, #p-452-emmc_uboot_headerconfig-6, #p-452-make_uboot_imgsh-7, #p-452-h-8, #p-452-h-9, #p-452-h-10"
        },
        {
            "user_name": "yaoshun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/11",
            "text": "社区开发者需要安装配套的pip包和deb包，理论上2者版本要对应，\npip3 install xxx.whl --upgrade\ndpkg -i xxx.deb\n当前构建工具288版本前存在issue，\nvi /usr/local/lib/python3.8/dist-packages/bmcgo/tasks/task_buildgppbin.py删除\nshutil.copy(os.path.join(self.config.gpp_build_dir, “emmc_uboot_header.config”), “emmc_uboot_header.config”)这一行"
        },
        {
            "user_name": "yaoshun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/12",
            "text": "适用于214版本"
        },
        {
            "user_name": "yaoshun",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/270/13",
            "text": "适用于282、283版本"
        }
    ]
}