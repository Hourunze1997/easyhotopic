{
    "topic_id": 1516,
    "question": "【已评审】新增可观测度量指标和调用跟踪定义和描述 - content: ISSUE链接\n背景\n随着可观测技术的能力构建逐步完善，需要对系统采集和上报的指标和跟踪统一定义和管理，防止定义冲突、含义不清等问题，确保可观测规范持续演进和社区共建共享。\n决策点\n\n新增可观测跟踪定义\n新增可观测指标定义（RPC访问、持久化管理、微组件管理、硬件管理）\n新增可观测指标描述\n\n整体架构/方案（可选，文字/图描述接口设计背后的整体管理架构/方案）\n可观测是基于openTelemetry规范构建的可视化能力,主要围绕系统中的可观测数据(包括指标、跟踪和日志),提供采集、上报以及与多种可视化工具集成的能力,帮助用户更好的监控系统性能,预测运行趋势、分析和定位系统故障\n跟踪（Trace）\n跟踪是一组事件，这些事件是由单个逻辑操作触发的，并通过应用程序的各个组件处理后最终整合在一起。跟踪可能包含跨越进程、网络和安全边界的事件，因此也被称为分布式跟踪，当有人按下按钮在网站上启动一个操作时，就可能会启动分布式跟踪。\n具体来说，跟踪可以被认为是跨度（Span）的有向无环图 (DAG)，其中跨度之间的边定义为父子关系。例如，以下是一个由6个跨度组成的跟踪示例：\n            [Span A]  ←←←(the root span)\n               |\n        +------+------+\n        |             |\n    [Span B]      [Span C] ←←←(Span C is a `child` of Span A)\n        |             |\n    [Span D]      +---+-------+\n                  |           |\n               [Span E]    [Span F]\n\n使用时间轴来显示跟踪轨迹会更容易理解，如下图所示：\n––|–––––––|–––––––|–––––––|–––––––|–––––––|–––––––|–––––––|–> time\n\n [Span A···················································]\n   [Span B··············································]\n      [Span D··········································]\n    [Span C········································]\n         [Span E·······]        [Span F··]\n\n跨度的组成\n\n操作名称。\n开始和结束时间戳。\n属性：键值对列表。\n事件：零个或多个事件的集合，每个事件本身都是一个元组（时间戳、名称、属性）。名称必须是字符串。\n父级跨度标识符。\n链接：指向零个或多个因果相关的跨度的链接（通过这些相关的跨度上下文）。\n上下文：引用跨度所需的跨度上下文（Span Context）信息。\n\n跨度的名称\n跨度的名称简洁地标识了跨度所代表的工作，例如RPC方法名称、函数名称或更大计算中的子任务或阶段的名称。\n跨度的类型\n\nSERVER 表示跨度涵盖了服务端处理的远程请求，而客户端等待响应。\nCLIENT 表示跨度描述了一个远程服务的请求，客户端等待响应。当 CLIENT 跨度的上下文被传播时，CLIENT 跨度通常会成为远程 SERVER 跨度的父级。\nPRODUCER 表示跨度描述了本地或远程操作的启动或调度。这个启动跨度通常在相关的 CONSUMER 跨度结束之前结束，甚至可能在 CONSUMER 跨度开始之前结束。 在具有批处理的消息传递场景中，跟踪单个消息需要为每条消息创建一个新的 PRODUCER 跨度。\nCONSUMER 表示跨度代表由生产者启动的操作的处理，生产者不等待结果。\nINTERNAL 默认值。表示跨度代表应用程序内的内部操作，而不是具有远程父级或子级的操作。\n\n指标（Metric)\n指标是是对系统行为、性能或状态的量化测量，可以是任何可测量的数值，例如CPU使用率、内存占用率、请求延迟、错误率等。记录测量值主要涉及计量仪（Meter）、仪表（Instrument）和测量值（Measurement）：\n\n计量器（Meter）：主要负责创建和管理仪表（Instrument）。\n仪表（Instrument）：具有名称、类型、描述和单位等标识，主要用于捕捉和记录测量值。\n测量值（Measurement）：单次记录的原始值，包含键值对属性标签，用于标记和区分不同场景下的测量值。\n\n+------------------+\n| MeterProvider    |                 +-----------------+             +--------------+\n|   Meter A        | Measurements... |                 | Metrics...  |              |\n|     Instrument X +-----------------> In-memory state +-------------> MetricReader |\n|     Instrument Y |                 |                 |             |              |\n|   Meter B        |                 +-----------------+             +--------------+\n|     Instrument Z |\n|     ...          |                 +-----------------+             +--------------+\n|     ...          | Measurements... |                 | Metrics...  |              |\n|     ...          +-----------------> In-memory state +-------------> MetricReader |\n|     ...          |                 |                 |             |              |\n|     ...          |                 +-----------------+             +--------------+\n+------------------+\n\n指标的组成\n\n指标由元数据和数据组成。\n元数据部分包含多个属性：\n\n指标名称。\n属性 （维度，也被称为标签）。\n值类型（整数、浮点等）。\n计量单位。\n\n数据是计数器、仪表、直方图等类型之一。\n\n数据点包含时间戳、属性和值。\n\n指标名称\n\n它们不是空字符串。\n它们是不区分大小写的 ASCII 字符串。\n第一个字符必须是字母。后续字符必须是字母数字字符、“_”、“.”、“-”和“/”。\n它们的最大长度为 255 个字符。\n\n指标名称使用约定\n指标名称不应复数化。\n\nlimit - 一种测量某种已知总量的恒定值的工具应称为 entity.limit。例如，system.memory.limit 表示系统内存的总量。\nusage - 一种测量已知总量（限制）中已使用量的工具应称为 entity.usage。例如，system.memory.usage 带有属性 state = used | cached | free |… 表示每种状态下的内存量。在适当的情况下，所有属性值的总使用量应等于限制。\n对无限资源或其限制不可知的资源消耗量的测量与使用量不同。例如，一个进程可能消耗的最大虚拟内存量可能会随时间波动，通常无法得知。\nutilization - 一种测量使用量相对于其限制的比例工具应称为 entity.utilization。例如，system.memory.utilization 表示正在使用的内存比例。利用率可以是相对于固定限制或软限制的。利用率值以比率表示，通常在范围 [0, 1] 内，但在超过软限制时可能超过 1。\ntime - 一种测量时间流逝的工具应称为 entity.time。例如，system.cpu.time 带有属性 state = idle | user | system |… 时间测量不一定是墙钟时间，可能小于或大于测量之间的实际墙钟时间。\n时间工具是使用量指标的特殊情况，其中限制通常可以计算为所有属性值的时间总和。时间工具的利用率可以通过使用指标事件时间戳自动推导。例如，system.cpu.utilization 定义为 system.cpu.time 测量值之间的差值除以经过的时间和 CPU 数量。\nio - 一种测量双向数据流的工具应称为 entity.io，并具有方向属性。例如，system.network.io。\n\n属性\n属性是一个键值对，必须具有以下属性：\n\n属性键必须是一个非空的字符串。键的大小写敏感，大小写不同的键被视为不同的键。\n属性值可以是：\n一个原始类型：字符串、布尔值、双精度浮点数（IEEE 754-1985）或带符号的 64 位整数。\n一个原始类型值的数组。数组必须是同质的，即它不能包含不同类型的值。\n属性的最大个数128。\n\n属性名称\n以otel.开头的属性名称属于OpenTelemetry规范保留定义。\n名称应遵循以下规则：\n\n名称应为小写。\n使用命名空间。使用点字符分隔命名空间。例如，service.version 表示服务版本，其中 service 是命名空间，version 是该命名空间中的一个属性。\n命名空间可以嵌套。例如，telemetry.sdk 是顶级 telemetry 命名空间中的一个命名空间，而 telemetry.sdk.name 是 telemetry.sdk 命名空间中的一个属性。\n在合适的情况下使用命名空间（和点分隔符）。例如，在引入表示某个对象属性的属性时，遵循 {object}.{property} 模式。如果该对象可能有其他属性，避免使用下划线（{object}_{property}）。\n对于名称中每个多词的点分隔组件，使用下划线分隔单词（即使用 snake_case）。例如，http.response.status_code 表示 http 命名空间中的状态码。\n仅在点（命名空间）的使用没有意义或改变名称的语义意义时使用下划线。例如，使用 rate_limiting 而不是 rate.limiting。\n属性、事件、指标和其他名称应具有描述性和明确性。\n在引入描述对象某个属性的名称时，包含属性名称。例如，使用 file.owner.name 而不是 file.owner，以及 system.network.packet.dropped 而不是 system.network.dropped。\n避免引入在不同约定或工具中使用时含义不同的名称和命名空间。例如，使用 security_rule 而不是 rule。\n在不影响清晰度的情况下使用更短的名称。在多词组件中删除不必要的命名空间组件或单词。例如，vcs.change.id 与 vcs.repository.change.id 一样精确地描述拉取请求 ID。\n\n详细描述（必填，描述待评审接口的详细内容）\n新增可观测跟踪定义\n\n类型\n应用场景\n关键字段\n使用规范\n\n描述\n示例\n备注\n\nServer\n服务端处理的接口远程请求\nspan.name\n<app_name>.server.request.<method_name/property_name>\n\n以组件名开头，明确标识收到请求的组件，后面跟对应请求的资源协作接口方法或属性\nhwproxy.dbus.Read\n\nspan.attributes\nclient.mc.name\n必选\n请求发起方（客户端）的名称\nhwdiscovery\n\nrpc.dbus.path\n必选\n资源协作路径\n\nrpc.dbus.interface\n必选\n资源协作接口\n\nrpc.dbus.method\n条件必选\n资源协作方法\n\nrpc.dbus.property\n条件必选\n资源协作属性\n\nClient\n客户端发起的远程请求\nspan.name\n<app_name>.client.request.<method_name/property_name>\n\n以组件名开头，明确标识发起请求的组件，后面跟对应请求的资源协作接口方法或属性\n\nspan.attributes\nserver.mc.name\n必选\n请求接收方（服务端）的名称\n\nrpc.dbus.path\n必选\n资源协作路径\n\nrpc.dbus.interface\n必选\n资源协作接口\n\nrpc.dbus.method\n条件必选\n资源协作方法\n\nrpc.dbus.property\n条件必选\n资源协作属性\n\nProducer\n本地或远程操作的启动或调度\nspan.name\n<app_name>.producer.signal.<signal_name>\n\n以组件名开头，明确标识发送信号的组件，后面跟对应请求的资源协作接口信号名称\n\nspan.attributes\nproducer.dbus.path\n必选\n资源协作路径\n\nproducer.dbus.interface\n必选\n资源协作接口\n\nConsumer\n生产者启动的操作的处理\nspan.name\n<app_name>.consumer.signal.<signal_name>\n\n以组件名开头，明确标识接收信号的组件，后面跟对应请求的资源协作接口方法或属性\n\nspan.attributes\nproducer.dbus.path\n必选\n资源协作路径\n\nproducer.dbus.interface\n必选\n资源协作接口\n\nInternal\n应用程序内的内部操作\nspan.name\n<app_name>.<file_name>.<method_name><app_name>.<file_name><app_name>.<module_name>.<method_name>\n\n以组件名开头，明确标识当前处理的组件；后面紧跟模块名和方法名\n\n1、支持应用层不指定名称，不指定时，默认采用该名称；应用层指定名称时，应当采用<app_name>.<module_name>.<opertion_name>的格式2、进程名称已包含在resource头中，待补充进程id\n\nspan.attributes\nservice.name\n必选\n服务名称。对于C/C++语言，线程名称；lua语言，skynet服务名称\n\n保留属性名，应用框架填入\n\nservice.id\n必选\n服务id，对于C/C++语言，线程id；lua语言，skynet服务id\n\n保留属性名，应用框架填入\n\nfile.name\n条件必选\n文件名。应用层不指定span.name时，可以不填。\n\n保留属性名，应用框架填入\n\nfile.method\n条件必选\n方法名。应用层不指定span.name时，可以不填；对于匿名场景，可以不填。\n\n保留属性名，应用框架填入\n\nfile.lineno\n必选\n文件行号\n\n保留属性名，应用框架填入\n\ntable.name\n持久化表名\n必选\n\n新增可观测指标定义\n指标类型：Counter（计数器）、UpDownCounter（增减计数器）、Guage（仪表盘）、Histogram（直方图）\n属性要求：必选、条件必选、推荐、可选\n\n分类\n指标名称\n指标类型\n指标单位\n属性列表\n属性描述\n属性要求\n描述\n标准定义\n\n硬件管理\nbmc.hw.chip.io\ncounter\ncount（次）\nhw.bus.name\n硬件总线的名称\n必选\n硬件器件IO指标\n否，自定义指标\n\nhw.chip.name\n硬件器件的名称\n必选\n\nhw.operation.name\n硬件操作的名称，包括write、read\n必选\n\nhw.operation.result\n硬件操作的结果，包括success、failed\n必选\n\nbmc.hw.chip.accessor\ncounter\ncount（次）\nhw.bus.name\n硬件总线的名称\n必选\n硬件器件访问器指标\n否，自定义指标\n\nhw.chip.name\n硬件器件的名称\n必选\n\nhw.chip.accessor.name\n硬件器件的访问器名称\n必选\n\nhw.chip.accessor.direction\n硬件器件的访问器的访问方向，包括write, read\n必选\n\nhw.chip.accessor.result\n硬件器件的访问器的访问结果，包括success、failed、emitSignal\n必选\n\nbmc.hw.chip.scanner\ncounter\ncount（次）\nhw.bus.name\n硬件总线的名称\n必选\n硬件器件扫描器指标\n否，自定义指标\n\nhw.chip.name\n硬件器件的名称\n必选\n\nhw.chip.scanner.name\n硬件器件扫描器的名称\n必选\n\nhw.chip.scanner.result\n硬件器件扫描器的扫描结果，包括success、failed、emitSignal\n必选\n\n微组件管理\nbmc.mc.flash.io\ncounter\nBy（字节）\nmc.name\n微组件名称\n必选\n微组件flash IO指标\n否，自定义指标\n\nfs.file.name\n文件名称\n条件必选，普通文件\n\nfs.file.type\n文件类型：日志文件 log、持久化文件 persistence、普通文件 regular\n必选\n\nflash.io.direction\nflash IO操作方向\n必选\n\nRPC访问\nbmc.rpc.client.request\ncounter\ncount（次）\nserver.mc.name\nRPC服务端组件名称\n必选\nrpc客户端请求指标\n否，自定义指标\n\nclient.mc.name\nRPC请求端组件名称\n必选\n\nrpc.dbus.path\nRPC请求的dbus路径\n必选\n\nrpc.dbus.interface\nRPC请求的dbus接口\n必选\n\nrpc.dbus.method\nRPC请求的dbus方法\n条件必选，方法访问\n\nrpc.dbus.property\nRPC请求的dbus属性\n条件必选，属性访问\n\n持久化管理\nbmc.persistence.server.request\ncounter\ncount（次）\nclient.mc.name\n持久化请求端组件名称\n必选\n持久化服务侧请求指标\n否，自定义指标\n\npersistence.data.type\n持久化类型，例如PermanentPer（跟模型定义保持一致）\n必选\n\npersistence.container.name\n持久化容器名\n必选\n\npersistence.operation.name\n持久化操作类型，例如insert, update, delete\n必选\n\nbmc.persistence.flash.io\ncounter\nBy（字节）\nclient.mc.name\n持久化请求端组件名称\n必选\n持久化flash IO指标（基于数据类型预估，跟实际写入量存在偏差）\n否，自定义指标\n\npersistence.data.type\n持久化数据类型，例如PermanentPer（跟模型定义保持一致）\n必选\n\npersistence.container.name\n持久化存储容器名\n必选\n\nflash.io.direction\nflash IO操作方向\n必选\n\n新增可观测指标描述\n使用场景：\n\n统一定义和管理系统指标，解决命名冲突、含义模糊等问题\n北向接口提供指标查询和使能能力\n应用框架对指标进行校验和管控，禁止不合理的指标和属性标签\n\n{\n    \"metrics\": [\n        {\n            \"name\": \"bmc.hw.chip.io\",\n            \"description\": \"硬件器件IO操作\",\n            \"unit\": \"count\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"hw.bus.name\",\n                    \"description\": \"硬件总线的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.name\",\n                    \"description\": \"硬件器件的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.operation.name\",\n                    \"description\": \"硬件操作的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.operation.result\",\n                    \"description\": \"硬件操作的结果\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                }\n            ]\n        },\n        {\n            \"name\": \"bmc.hw.chip.accessor\",\n            \"description\": \"硬件器件访问器\",\n            \"unit\": \"count\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"hw.bus.name\",\n                    \"description\": \"硬件总线的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.name\",\n                    \"description\": \"硬件器件的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.accessor.name\",\n                    \"description\": \"硬件器件的访问器名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.accessor.direction\",\n                    \"description\": \"硬件器件的访问器的访问方向\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.accessor.result\",\n                    \"description\": \"硬件器件的访问器的访问结果\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                }\n            ]\n        },\n        {\n            \"name\": \"bmc.hw.chip.scanner\",\n            \"description\": \"硬件器件扫描器\",\n            \"unit\": \"count\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"hw.bus.name\",\n                    \"description\": \"硬件总线的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.name\",\n                    \"description\": \"硬件器件的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.scanner.name\",\n                    \"description\": \"硬件器件扫描器的名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"hw.chip.scanner.result\",\n                    \"description\": \"硬件器件扫描器的扫描结果\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                }\n            ]\n        },\n        {\n            \"name\": \"bmc.mc.flash.io\",\n            \"description\": \"微组件flash IO\",\n            \"unit\": \"By\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"mc.name\",\n                    \"description\": \"微组件名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"fs.file.name\",\n                    \"description\": \"文件名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Recommended\"\n                },\n                {\n                    \"name\": \"fs.file.type\",\n                    \"description\": \"文件类型\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"flash.io.direction\",\n                    \"description\": \"flash IO操作方向\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                }\n            ]\n        },\n        {\n            \"name\": \"bmc.rpc.client.request\",\n            \"description\": \"RPC客户端请求\",\n            \"unit\": \"count\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"server.mc.name\",\n                    \"description\": \"RPC服务端组件名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"rpc.dbus.path\",\n                    \"description\": \"RPC请求的dbus路径\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"rpc.dbus.interface\",\n                    \"description\": \"RPC请求的dbus接口\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"rpc.dbus.method\",\n                    \"description\": \"RPC请求的dbus方法\",\n                    \"type\": \"String\",\n                    \"level\": \"Conditionally-Required\"\n                },\n                {\n                    \"name\": \"rpc.dbus.property\",\n                    \"description\": \"RPC请求的dbus属性\",\n                    \"type\": \"String\",\n                    \"level\": \"Conditionally-Required\"\n                }\n            ]\n        },\n        {\n            \"name\": \"bmc.persistence.server.request\",\n            \"description\": \"持久化服务请求\",\n            \"unit\": \"count\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"client.mc.name\",\n                    \"description\": \"持久化请求端组件名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"persistence.data.type\",\n                    \"description\": \"持久化数据类型\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"persistence.container.name\",\n                    \"description\": \"持久化存储容器名\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"persistence.operation.name\",\n                    \"description\": \"持久化操作类型\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                }\n            ]\n        },\n        {\n            \"name\": \"bmc.persistence.flash.io\",\n            \"description\": \"持久化服务flash IO\",\n            \"unit\": \"By\",\n            \"type\": \"Counter\",\n            \"attributes\": [\n                {\n                    \"name\": \"client.mc.name\",\n                    \"description\": \"持久化请求端组件名称\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"persistence.data.type\",\n                    \"description\": \"持久化数据类型\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                },\n                {\n                    \"name\": \"persistence.container.name\",\n                    \"description\": \"持久化存储容器名\",\n                    \"type\": \"String\",\n                    \"level\": \"Required\"\n                }\n            ]\n        }\n    ]\n}\n\n评审结论（评审结束后录入，描述全面且清晰，不能是通过或不通过、同意或不同意）\n\n同意新增可观测指标定义，BMC侧指标调整如下：\n\n指标名称加上bmc.的命名空间\n指标属性（标签）名称加上更精准的命名空间约定\n\n同意新增可观测指标指标描述，采用json格式，由observability可观测组件承载\nlinks: #p-3680-trace-1, #p-3680-h-2, #p-3680-h-3, #p-3680-h-4, #p-3680-metric-5, #p-3680-h-6, #p-3680-h-7, #p-3680-h-8, http://entity.io, http://system.network.io, #p-3680-h-9, #p-3680-h-10, #p-3680-h-11, #p-3680-h-12, http://bmc.hw.chip.io, http://bmc.mc.flash.io, http://bmc.persistence.flash.io, #p-3680-h-13",
    "topic_user_name": "许强",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "许强",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1516/2",
            "text": "使用场景：\n\n应用框架对度量指标进行校验和管控，禁止不合理的度量指标和属性标签\n北向接口提供度量指标查询和使能能力\n统一定义和管理系统度量指标，解决命名冲突、含义模糊等问题"
        },
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1516/3",
            "text": ""
        }
    ]
}