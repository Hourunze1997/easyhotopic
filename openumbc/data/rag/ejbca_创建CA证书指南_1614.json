{
    "topic_id": 1614,
    "question": "ejbca 创建CA证书指南 - content: EJBCA CA 证书创建指南\n1. 进入证书 Profile 管理\n\n登录 EJBCA 管理控制台。\n依次点击 CA Functions → Certificate Profiles 进入管理页面。\n\n2. 创建证书 Profile\n方法 1：克隆现有 Profile\n\n在列表中找到合适的 Profile（如 ENDUSER）。\n点击 Clone，输入新名称，保存。\n\n方法 2：手动创建 Profile\n\n在底部输入框中输入新 Profile 名称（如 CustomProfile）。\n点击 Add 创建。\n\n3. 创建 Crypto Token\n\n点击 CA Functions → Crypto Tokens。\n\n进入管理页面，点击 Create New。\n\n在新建页面填写信息：\n\nName：输入 Crypto Token 名称。\n\nType：选择 SOFT。\n\nAuto-activation：可选，勾选可自动激活。\n\nAllow export of private keys：如需导出私钥，勾选 Allow。\n\nAuthentication Code：输入认证码并重复确认。\ndd if=/dev/random bs=1 count=128 2>&1| sha256sum | awk '{print $1}\n\n点击 Save 保存。\n\n4. 生成密钥对\n\n进入 Crypto Token 详情页面。\n在 Crypto Token currently does not contain any key pairs. 处输入密钥名称（如 signKey）。\n选择密钥算法（如 RSA 4096）。\n点击 Generate new key pair 生成密钥。\n\n注意：默认 Profile 不能修改，需克隆后新建。\n\n5. CA 类型与密钥配置\n\n参数\n说明\n\nCA Type\n选择 X.509 CA，表示创建标准 X.509 证书的 CA。\n\nCrypto Token\n选择已创建的 Crypto Token（例如 HefeibaixinCrypto）。必须先创建 Crypto Token，否则无法选择。\n\nSigning Algorithm\n选择 SHA256WithRSA，该算法用于 CA 签名，SHA256 以上算法更安全。\n\nAlternative Signing Algorithm\n如果需要混合证书签名算法，可在此选择，通常保持 None，也就是不动这个选项。\n\nKey Sequence Format\n选择 Numeric (0-9)，用于生成 CA 证书的序列号。\n\nKey Sequence\n设为 00000，这是 CA 证书的初始序列号，可根据需求修改。\n\nDescription\n可填写 CA 相关描述信息，如用途或其他说明，方便管理。\n\n6. 证书策略（Directives）\n\n参数\n说明\n\nEnforce unique public keys\n强制公钥唯一性，防止多个证书共享相同公钥。\n\nEnforce key renewal\n续期时强制生成新密钥，确保更高安全性。(RootCA可不启用)\n\nEnforce unique DN\n确保 CA 颁发的证书 DN 唯一，防止同名证书冲突。\n\nEnforce unique Subject DN SerialNumber\n确保 Subject DN 和 序列号 组合唯一，防止重复证书。如果 CA 规模较大，建议启用。\n\nUse Certificate Request History\n记录证书请求历史，便于审计。\n\nUse User Storage\n存储用户信息，便于管理。\n\nUse Certificate Storage\n存储已颁发的证书，以便管理和查询。\n\n7. 证书数据（CA Certificate Data）\n\n参数\n说明\n\nSubject DN\nCN=Hefeibaixin EnterpriseIT Root CA，即 CA 证书的 Distinguished Name（可分辨名称）。\n\nSigned By\nSelf Signed，Root CA 必须自签名，而中间 CA 需要由上级 CA 签名。\n\nCertificate Profile\n选择克隆后或者自定义的 模板，ROOTCA，适用于 Root CA 的证书配置。\n\nValidity\n例如 50y，表示 CA 证书有效期 50 年。\n\nSubject Alternative Name\n可选，Root CA 通常不需要。\n\nCertificate Policy OID\n可选，填写特定的证书策略 OID，若不需要可留空。自签可不需要填写。\n\nUse UTF-8 in policy notice text\n启用 UTF-8，确保国际字符支持。\n\nPrintableString encoding in DN\n一般不勾选，否则 DN 仅支持基本字符，可能影响国际化。\n\nLDAP DN order\n启用，确保 DN 按 LDAP 规范排列。\n\nSerial Number Octet Size\n设为 20，决定 CA 证书序列号的字节长度，推荐 20 以保证唯一性。\n\nName Constraints, Permitted\n限制允许的证书使用范围，默认 Name Constraints option is disabled in Certificate Profile.\n\n示例\nexample.com 198.51.100.0/24 CN=Name,O=Company @example.com uri:example.com uri:.example.com\n\nName Constraints, Excluded\n限制不允许的证书范围，默认 Name Constraints option is disabled in Certificate Profile.\n\n示例\n0.0.0.0/0 和 ::/0 可禁止所有 IP 地址，单独输入 . 可禁止所有 DNS 名称。\n\n8. CRL 配置（证书吊销列表）\n\n参数\n说明\n\nMicrosoft CA Compatibility Mode\n仅在 Windows AD 兼容环境下启用，一旦启用无法撤销。Root CA 通常不启用，适用于 Windows 证书颁发机构（AD CS）。\n\nAuthority Key ID\n启用，并标记 Critical，用于标识 CRL 发行者。建议 Root CA 和中间 CA 都启用。\n\nCRL Number\n启用，并标记 Critical，确保 CRL 版本唯一。建议 Root CA 和中间 CA 启用。\n\nIssuing Distribution Point on CRLs\n适用于分层 CRL 结构的环境，启用时 CRL 发行者信息会写入 CRL，Root CA 可不启用，中间 CA 视情况决定。（仅适用于大规模环境），基本禁用。\n\nCA issuer URI\n填写 CA 证书下载地址，如 http://myejbca.baixin.local/certs/rootca.pem，便于证书链验证。可选（留空即可，若有 Web 端可填写）\n\nKeep expired certificates on CRL\n建议 Root CA 不启用，中间 CA 视情况决定。启用后，即使证书过期，仍会出现在 CRL 中，以便历史查询。\n\nUse CRL partitions\n适用于大规模证书管理，如果 CA 需要管理大量证书，建议启用。Root CA 通常不启用，中间 CA 需要时启用。  不需要（Root CA 负载小，没必要）\n\nCRL Expire Period\n设为 1d，表示 CRL 有效期 1 天，建议中间 CA 采用较短的 CRL 过期时间。Root CA 可设长一些，如 30d。\n\nCRL Issue Interval\n设为 0m，表示不定期发布 CRL。对于活跃 CA，建议设置为 7d，定期更新 CRL。\n\nCRL Overlap Time\n设为 10m，旧 CRL 与新 CRL 重叠 10 分钟，防止证书验证失败。建议所有 CA 启用。\n\nDelta CRL Period\n设为 0m，Root CA 通常不使用 Delta CRL，只有对实时性要求高的 CA 才需要启用。\n\nGenerate CRL Upon Revocation\n建议 Root CA 不启用，中间 CA 需要时启用，证书撤销后立即生成新的 CRL，以便尽快更新状态。\n\nAllow changing revocation reason\n启用，允许修改证书撤销原因。适用于所有 CA。\n\nAllow invalidity date\n启用，允许设置证书失效日期。适用于所有 CA。\n\n9. 默认 CA 证书与 CRL URL 配置\n\n参数\n说明\n\nDefault CRL Distribution Point\n例如 http://myejbca.baixin.local/ejbca/publicweb/webdist/certdist?cmd=crl&issuer=CN%3DHefeibaixin+EnterpriseIT+Root+CA，用于 CRL 分发。\n\nDefault CRL Issuer\n留空，通常不需要此字段。\n\nDefault Freshest CRL Distribution Point\n留空，Root CA 不使用 Delta CRL。\n\nOCSP Service Default URI\n留空，Root CA 通常不提供 OCSP。\n\nCA Issuer Default URI\n例如 http://myejbca.baixin.local/certs/rootca.pem，用于下载 CA 证书。\n\n10. 其他审批与监控配置\n审批设置（Approval Settings）\n\n参数\n说明\n\nAdd/Edit End Entity\nNone，Root CA 不管理终端实体，由中间 CA 负责。\n\nKey Recovery\nNone，Root CA 不提供密钥恢复，中间 CA 视需求启用。\n\nRevocation\nNone，Root CA 很少撤销自身证书，中间 CA 可启用以控制撤销审批。\n\nCA Service Activation\nNone，Root CA 通常手动激活，不需要审批。\n\n其他数据（Other Data）\n\n参数\n说明\n\nValidators\nFinish User，启用证书验证策略。\n\nCMP RA Authentication Secret\n留空，仅在使用 CMP 协议时需要配置。\n\nMonitor if CA active (healthcheck)\nActivate，启用 CA 运行监控，适用于所有 CA。\n\nRequest Processor\nNone，如果 CA 需要外部请求处理，可以在这里配置，但 Root CA 通常不需要。\n\n11. 外部签名 CA 创建或更新（Externally signed CA creation/renewal）\n\n参数\n说明\n\nRenew CA\n建议创建新的 Root CA，而不是重新生成密钥并重新签名现有 CA。重新签名可能会导致多个 Root CA 证书共享相同的 Subject DN，从而可能引发意外问题。\n\nCA Chain Certificates\n- 如果 CA 需要由外部 CA 签名（例如中间 CA 由 Root CA 签名），需要上传外部 CA 提供的证书链（PEM/DER 格式）。\n\n- 如果 Root CA 已安装在本地，则不需要上传此文件。\n\n适用情况\n\nRoot CA：通常 不需要 这一项，因为 Root CA 是 自签名 的。\n中间 CA：如果 由上级 CA 签名，需要在这里上传 CA 证书链，并生成 CSR（证书请求）。\n\n如果正在创建 Root CA，直接忽略这一项，点击 “Create” 即可完成 CA 生成。\n12. 最终检查与完成\n\n确保所有参数填写正确。\n\n点击 “Create” 生成 CA。\n\n验证 CA 证书信息：\nopenssl x509 -in rootca.pem -noout -text\n\n测试 CRL URL 是否可访问：\ncurl -I \"http://myejbca.baixin.local/ejbca/publicweb/webdist/certdist?cmd=crl&issuer=CN%3DHefeibaixin+EnterpriseIT+Root+CA\"\n\n CA 操作说明已完成！如果有任何问题，请继续交流！\n Root CA 创建简要步骤\n CA 类型与密钥配置\n\n参数\n说明\n\nCA Type\nX.509 CA  标准 X.509 证书 CA。\n\nCrypto Token\n选择已创建的 Crypto Token （如 HefeibaixinCrypto）。\n\nSigning Algorithm\nSHA256WithRSA  更安全的签名算法。\n\nAlternative Signing Algorithm\nNone  无需备用签名算法。\n\nKey Sequence Format\nNumeric (0-9)  用于 CA 证书序列号。\n\nKey Sequence\n00000  初始序列号，可修改。\n\nDescription\nRoot CA 说明，可填写用途、管理单位等 \n\n 证书策略（Directives）\n\n参数\n说明\n\nEnforce unique public keys\n 强制公钥唯一性，防止重复\n\nEnforce key renewal\n Root CA 可不启用\n\nEnforce unique DN\n 确保 DN 唯一（适用于小规模 CA）\n\nEnforce unique Subject DN SerialNumber\n 仅适用于大规模 CA（20 个以下证书可不启用）\n\nUse Certificate Request History\n 记录证书请求历史,Root CA 不启用\n\nUse User Storage\n 存储用户信息\n\nUse Certificate Storage\n 存储已颁发证书\n\n 证书数据（CA Certificate Data）\n\n参数\n说明\n\nSubject DN\nCN=Hefeibaixin EnterpriseIT Root CA \n\nSigned By\nSelf Signed  Root CA 必须自签名\n\nCertificate Profile\nITROOTCA_profile  选择克隆后的 ROOTCA，允许修改参数\n\nValidity\n50y  证书有效期 50 年\n\nSubject Alternative Name\n Root CA 通常不需要\n\nCertificate Policy OID\n 可选，默认留空\n\nUse UTF-8 in policy notice text\n 确保国际字符支持\n\nPrintableString encoding in DN\n 不勾选，避免影响国际化\n\nLDAP DN order\n 确保 DN 按 LDAP 规范排列\n\nSerial Number Octet Size\n20  推荐 20 字节，确保唯一性\n\nName Constraints, Permitted\n Root CA 默认禁用，留空\n\nName Constraints, Excluded\n Root CA 默认禁用，留空\n\n CRL 配置（证书吊销列表）\n\n参数\n说明\n\nMicrosoft CA Compatibility Mode\n Root CA 不启用，仅适用于 Windows 证书颁发机构（AD CS）。\n\nAuthority Key ID\n 启用，并标记 Critical，用于标识 CRL 发行者。建议 Root CA 和中间 CA 都启用。\n\nCRL Number\n 启用，并标记 Critical，确保 CRL 版本唯一。建议 Root CA 和中间 CA 启用。\n\nIssuing Distribution Point on CRLs\n Root CA 可不启用，仅适用于分层 CRL 结构的大规模 CA。\n\nCA issuer URI\n 留空，证书下载后期由用户自行提供接口。\n\nKeep expired certificates on CRL\n Root CA 不启用，中间 CA 视情况决定，启用后即使证书过期仍会出现在 CRL 中。\n\nUse CRL partitions\n Root CA 负载小，不需要。适用于大规模证书管理的 CA。\n\nCRL Expire Period\n30d  Root CA 设长一些，如 30d，中间 CA 采用较短的 CRL 过期时间。\n\nCRL Issue Interval\n7d  定期更新 CRL，建议活跃 CA 采用 7d。\n\nCRL Overlap Time\n12h  旧 CRL 与新 CRL 重叠 12h，防止证书验证失败。\n\nDelta CRL Period\n0m  Root CA 不使用 Delta CRL，只有对实时性要求高的 CA 才需要启用。\n\nGenerate CRL Upon Revocation\n Root CA 不启用，中间 CA 需要时启用，证书撤销后立即生成新的 CRL。\n\nAllow changing revocation reason\n 启用，允许修改证书撤销原因。适用于所有 CA。\n\nAllow invalidity date\n 启用，允许设置证书失效日期。适用于所有 CA。\n\n审批设置\n\n参数\n说明\n\nAdd/Edit End Entity\nNone  Root CA 不管理终端实体\n\nKey Recovery\nNone  Root CA 不提供密钥恢复\n\nRevocation\nNone  Root CA 很少撤销自身证书\n\nCA Service Activation\nNone  Root CA 手动激活\n\n 其他数据\n\n参数\n说明\n\nValidators\nFinish User  启用证书验证策略。\n\nCMP RA Authentication Secret\n 留空，仅在使用 CMP 协议时需要配置。\n\nMonitor if CA active (healthcheck)\nActivate  启用 CA 运行监控，适用于所有 CA。\n\nRequest Processor\nNone  Root CA 通常不需要外部请求处理。\n\n 外部签名 CA 创建或更新（Externally signed CA creation/renewal）\n\n参数\n说明\n\nRenew CA\n 建议创建新的 Root CA，而不是重新生成密钥并重新签名现有 CA，以避免同名 Root CA 证书带来的问题。\n\nCA Chain Certificates\n 仅当 CA 由外部 CA 签名时才需要上传证书链文件（PEM/DER 格式）。如果 Root CA 已安装在本地，则不需要上传此文件。\n\n 完成 CA 创建\n检查所有参数，确认无误后，点击 Create 生成 CA。\n① 下载并验证 Root CA 证书：\n使用以下 OpenSSL 命令验证证书格式和有效性：\n# 验证 PEM 格式证书\nopenssl x509 -in rootca.pem -text -noout  \n\n# 验证 DER 格式证书\nopenssl x509 -in rootca.der -inform DER -text -noout\n\n# 检查证书 SHA256 指纹信息\nopenssl x509 -noout -fingerprint -sha256 -in rootca.pem\n\n# 验证证书的有效性（自签名证书验证）\nopenssl verify -CAfile rootca.pem rootca.pem\n\n② 部署并验证 CRL（证书吊销列表）：\n若配置了 CRL URL，执行：\n# 验证 CRL 文件\nopenssl crl -in rootca.crl -text -noout\n\n确保 CRL 可通过 Web 正常访问。\n Root CA 现在已成功创建，可用于签发中间 CA！ \n 中间 CA 创建简要步骤\n CA 类型与密钥配置\n\n参数\n说明\n\nCA Type\nX.509 CA  标准 X.509 证书 CA\n\nCrypto Token\n选择已创建的 Crypto Token （如 HefeibaixinCrypto）\n\nSigning Algorithm\nSHA256WithRSA  更安全的签名算法\n\nAlternative Signing Algorithm\nNone  无需备用签名算法\n\nKey Sequence Format\nNumeric (0-9)  用于 CA 证书序列号\n\nKey Sequence\n00001  初始序列号，与 Root CA 区分\n\nDescription\n中间 CA 说明，可填写用途、管理单位等 \n\n 证书策略（Directives）\n\n参数\n说明\n\nEnforce unique public keys\n 强制公钥唯一性，防止重复\n\nEnforce key renewal\n 中间 CA 建议启用，保证安全\n\nEnforce unique DN\n 确保 DN 唯一\n\nEnforce unique Subject DN SerialNumber\n 规模小于20个证书时可不启用\n\nUse Certificate Request History\n 记录证书请求历史\n\nUse User Storage\n 存储用户信息\n\nUse Certificate Storage\n 存储已颁发证书\n\n 证书数据（CA Certificate Data）\n\n参数\n说明\n\nSubject DN\n例如 CN=Hefeibaixin Intermediate CA \n\nSigned By\nHefeibaixin EnterpriseIT Root CA  中间 CA 必须由 Root CA 签名\n\nCertificate Profile\nINTERMEDIATE_CA_profile  克隆后配置适合中间 CA\n\nValidity\n10y  通常为10年，有效期小于 Root CA\n\nSubject Alternative Name\n 中间 CA 通常不需要\n\nCertificate Policy OID\n 默认留空，或按需填写\n\nUse UTF-8 in policy notice text\n 确保国际字符支持\n\nPrintableString encoding in DN\n 不勾选，避免影响国际化\n\nLDAP DN order\n 按 LDAP 规范排列 DN\n\nSerial Number Octet Size\n20  推荐20字节\n\nName Constraints, Permitted\n 默认禁用，留空\n\nName Constraints, Excluded\n 默认禁用，留空\n\n CRL 配置（证书吊销列表）\n\n参数\n说明\n\nMicrosoft CA Compatibility Mode\n 一般不启用，仅用于 Windows AD 环境\n\nAuthority Key ID\n 启用，并标记为 Critical\n\nCRL Number\n 启用，并标记为 Critical\n\nIssuing Distribution Point on CRLs\n 通常不启用\n\nCA issuer URI\n 留空，或按需填写下载地址\n\nKeep expired certificates on CRL\n 中间 CA 建议启用，保留过期证书，目前不启用，会导致吊销列表越来越大\n\nUse CRL partitions\n 通常不需要\n\nCRL Expire Period\n7d  建议7天，确保及时更新\n\nCRL Issue Interval\n1d  每天发布，确保及时更新\n\nCRL Overlap Time\n12h  与旧 CRL 重叠 12 小时，确保平稳过渡\n\nDelta CRL Period\n0m  不使用 Delta CRL\n\nGenerate CRL Upon Revocation\n 启用，证书撤销后立即更新\n\nAllow changing revocation reason\n 允许修改证书撤销原因\n\nAllow invalidity date\n 允许设置证书失效日期\n\n 默认 CA 验证数据（Default CA defined validation data）\n\n参数\n说明\n\nDefault CRL Distribution Point\n 默认留空或按需填写，用于 CRL 分发地址\n\nDefault CRL Issuer\n 默认留空，通常无需填写\n\nDefault Freshest CRL Distribution Point\n 默认留空，通常无需填写\n\nOCSP Service Default URI\n 默认留空，按需填写 OCSP 地址\n\nCA Issuer Default URI\n 默认留空或后期提供接口\n\n 审批设置与其他数据\n审批设置目前只有None选项，表示无需额外审批流程，如需开启需检查 EJBCA 的全局审批策略，Supervision Fuctions。\n\n参数\n说明\n\nValidators\nFinish User  启用证书验证策略\n\nCMP RA Authentication Secret\n 留空，仅在使用 CMP 协议时需要配置\n\nMonitor if CA active (healthcheck)\nActivate  启用运行监控\n\nRequest Processor\nNone  一般不需外部请求处理\n\n 完成中间 CA 创建\n检查所有参数，确认无误后，点击 Create 生成 CA 请求文件 (CSR)。\n提交 CSR 给 Root CA 签名后，下载签名后的证书并验证：\nopenssl x509 -in intermediate_ca.pem -text -noout\nopenssl verify -CAfile rootca.pem intermediate_ca.pem\n\n 中间 CA 已成功创建，可用于签发终端实体证书！\nlinks: #p-3920-ejbca-ca-1, #p-3920-h-1-profile-2, #p-3920-h-2-profile-3, #p-3920-h-1-profile-4, #p-3920-h-2-profile-5, #p-3920-h-3-crypto-token-6, #p-3920-h-4-7, #p-3920-h-5-ca-8, #p-3920-h-6-directives-9, #p-3920-h-7-ca-certificate-data-10, http://example.com, #p-3920-h-8-crl-11, #p-3920-h-9-ca-crl-url-12, #p-3920-h-10-13, #p-3920-approval-settings-14, #p-3920-other-data-15, #p-3920-h-11-ca-externally-signed-ca-creationrenewal-16, #p-3920-h-17, #p-3920-h-12-18, #p-3920-root-ca-19, #p-3920-h-1-ca-20, #p-3920-h-2-directives-21, #p-3920-h-3-ca-certificate-data-22, #p-3920-h-4-crl-23, #p-3920-h-5-24, #p-3920-h-6-25, #p-3920-h-7-ca-externally-signed-ca-creationrenewal-26, #p-3920-h-8-ca-27, #p-3920-ca-28, #p-3920-h-1-ca-29, #p-3920-h-2-directives-30, #p-3920-h-3-ca-certificate-data-31, #p-3920-h-4-crl-32, #p-3920-h-5-ca-default-ca-defined-validation-data-33, #p-3920-h-6-34, #p-3920-h-7-ca-35",
    "topic_user_name": "shenwei 百信信息技术",
    "best_answer_url": "",
    "reply_posts": []
}