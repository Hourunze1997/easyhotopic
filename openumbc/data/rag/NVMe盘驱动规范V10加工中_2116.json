{
    "topic_id": 2116,
    "question": "NVMe盘驱动规范V1.0（加工中） - content: NVMe盘驱动规范V1.0（加工中）\n\n 注意！\n本驱动规范定义了NVMe盘需实现的驱动接口，目前面向社区进行意见征集，欢迎大家反馈。\n\n概述\nNVMe是一种基于PCIe协议的高性能SSD接口标准，相比传统SATA/SAS SSD，具有更低的延迟和更高的吞吐量，各硬盘厂商在协议实现、调速策略等方面存在差别，因此openUBMC通过南向部件驱动的设计达到兼容各硬盘厂商的差异，满足不同厂商快速接入。\n\n1 NVMe盘驱动对象定义\n1.1 NVMe盘相关定义\n简介： NVMe对象是指NVMe盘的抽象定义，天池架构下NVMe盘是插在接UBC线缆的硬盘背板。\n1.1.1 NVMe对象\n说明： 描述NVMe盘自身的对象\n对象路径：/bmc/dev/Systems/1/NVMe/{Id}\n\ninterface\n说明\n可选/必选\n\nbmc.dev.NVMe\n描述NVMe盘基本信息相关接口\n必选\n\nbmc.dev.NVMe.Management\n描述NVMe盘管理配置的接口\n必选\n\nbmc.dev.NVMe.ProductInfo\n描述NVMe盘产品信息的接口\n必选\n\nbmc.dev.NVMe.MultiRecord\n描述NVMe盘多记录信息的接口\n必选\n\nbmc.dev.NVMe.Status\n描述NVMe盘状态类属性的接口\n必选\n\nbmc.dev.NVMe.Cooling\n描述NVMe盘温度类属性的接口\n必选\n\nbmc.dev.NVMe.BasicManagement\n描述NVMe盘基础管理的接口\n可选\n\nbmc.dev.NVMe.NVMeMI\n描述NVMe-MI相关的接口\n可选\n\nbmc.dev.NVMe.LogCollection\n描述NVMe盘日志收集的接口\n可选\n\nbmc.dev.NVMe.Smart\n描述NVMe盘Smart的接口\n可选\n\nbmc.dev.NVMe.HwDefinedSmart\n描述NVMe盘华为自定义Smart的接口\n可选\n\n2 NVMe盘接口详细信息\n2.1 NVMe盘基本信息相关接口\n2.1.1 bmc.dev.NVMe\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nSlot\nU8\n只读\n无\n槽位号\n\nMediaType\nU8\n只读\n无\n介质类型\n\nProtocol\nU8\n只读\n无\n接口类型\n\nNegotiatedSpeedGbs\nU8\n只读\n变更广播\n协商速率\n\nPredictedMediaLifeLeftPercent\nU8\n只读\n变更广播\n剩余磨损率\n\nSpareBlockPercentage\nU8\n只读\n变更广播\n空闲块百分比\n\n2.1.2 bmc.dev.NVMe.Management\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nNvmeProtocol\nU8\n只读\n变更广播\nNVMe盘使用的协议，如：NVMe-MI、SSD Form Factor\n\nSupportedMctpOverPcie\nBoolean\n只读\n变更广播\n是否支持MCTP Over PCIe\n\nSupportedHwDefinedSmart\nU8\n只读\n变更广播\n是否支持华为自定义SMART信息\n\nVPDChip\nString\n只读\n无\n读取VPD数据的芯片引用对象\n\nSSDChip\nString\n只读\n无\n读取基础管理数据的芯片引用对象\n\nRefComponent\nString\n只读\n无\n硬盘关联的部件对象\n\n2.1.3 bmc.dev.NVMe.ProductInfo\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nModel\nString\n只读\n变更广播\n型号\n\nSerialNumber\nString\n只读\n变更广播\n序列号\n\nManufacturer\nString\n只读\n变更广播\n厂商\n\nManufacturerId\nString\n只读\n变更广播\n厂商Id\n\n2.1.4 bmc.dev.NVMe.MultiRecord\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nRevision\nString\n只读\n无\n固件版本\n\nCapacityMiB\nU32\n只读\n变更广播\n硬盘容量，以MiB为单位\n\nCapableSpeedGbs\nU8\n只读\n变更广播\n接口速率（最大速率）\n\n2.1.5 bmc.dev.NVMe.Status\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nFailure\nU8\n只读\n变更广播\n故障状态\n\nPredictiveFailure\nU8\n只读\n变更广播\n预故障状态\n\nMediaErrorCount\nU8\n只读\n变更广播\n媒介错误统计\n\n2.1.6 bmc.dev.NVMe.Cooling\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nTemperatureCelsius\nU8\n只读\n变更广播\n硬盘温度\n\n2.1.7 bmc.dev.NVMe.BasicManagement\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nPort0PCIeLinkActive\nU8\n只读\n变更广播\n端口0的PCIe连接激活状态\n\nPort1PCIeLinkActive\nU8\n只读\n变更广播\n端口1的PCIe连接激活状态\n\nResetNotRequired\nU8\n只读\n变更广播\n故障恢复无需是否需要重置\n\nDriveFunctional\nU8\n只读\n变更广播\n硬盘功能性\n\nDriveNotReady\nU8\n只读\n变更广播\n硬盘未准备完成\n\nSMARTWarnings\nU8\n只读\n变更广播\nSMART告警\n\nPercentageDriveLifeUsed\nU8\n只读\n变更广播\n硬盘使用寿命百分比\n\n2.2 NVMe盘扩展管理相关接口\n2.2.1 bmc.dev.NVMe.NVMeMI\n\n方法名称\nreq签名\nreq说明\nrsp签名\nrsp说明\n方法说明\n\nGetSmartInfo\nq\nVendor：指定smart信息为标准协议还是自定义,标准格式传0,自定义传厂商自定义标识\nay\nMessageResponse： 响应报文, 小端字节序排列\n通过标准NVMe-mi协议获取SMART/Health Information\n\nSendNvmeMICommand\nyuuay\nOpcode：该字段指定要处理的 NVMe-MI 命令的操作码Dword0：该字段为特定命令的 Dword 0Dword1：该字段为特定命令的 Dword 1RequestData：预留请求字节, 小端字节序排列\nyuay\nStatus：该字段为命令的响应码NVMeResponse：该字段为特定命令响应ResponseData：预留响应字节, 小端字节序排列\n按照标准NVMe-mi协议发送NVMe-MI Command格式命令,请求参数可以参照协议第5章Management Interface Command Set的请求报文填充\n\nGetTelemetryData\ns\nDataType：指定收集硬盘host或controller的日志,取值范围：Host/Controller\nu\nTaskId：任务标识\n通过标准NVMe-mi协议获取Telemetry Host/Controller-initiated\n\nGetIdentifyData\ny\nCNSValue：指定Controller or Namespace Structure决定该命令返回的数据结构,参考协议的Identify – CNS Values图表定义\nay\nMessageResponse： 响应报文, 小端字节序排列\n通过标准NVMe-mi协议获取Identify command信息\n\n2.2.2 bmc.dev.NVMe.LogCollection\n\n方法名称\nreq签名\nreq说明\nrsp签名\nrsp说明\n方法说明\n\nDumpErrorInfo\ns\nPath：NVMe盘错误日志存放路径\nu\nTaskId：任务标识\n收集NVMe盘错误日志\n\nDumpSmartInfo\ns\nPath：NVMe盘Smart日志存放路径\nu\nTaskId：任务标识\n收集NVMe盘的Smart日志\n\nDumpSupportedLogPages\ns\nPath：NVMe盘支持的日志类型存放路径\nu\nTaskId：任务标识\n收集NVMe盘支持的日志类型\n\nDumpFirmwareSlotInfo\ns\nPath：NVMe盘固件插槽信息存放路径\nu\nTaskId：任务标识\n收集NVMe盘的固件插槽信息\n\nDumpFeatureIdentifiersLog\ns\nPath：NVMe盘支持的特性标识存放路径\nu\nTaskId：任务标识\n收集NVMe盘支持的特性标识日志\n\nDumpControllerHealthStatus\ns\nPath：NVMe盘控制器健康状态存放路径\nu\nTaskId：任务标识\n收集NVMe盘的控制器健康状态\n\nDumpSubsystemHealthStatus\ns\nPath：NVMe盘子系统健康状态存放路径\nu\nTaskId：任务标识\n收集NVMe盘的子系统健康状态\n\nDumpSubsystemInfo\ns\nPath：NVMe盘子系统信息存放路径\nu\nTaskId：任务标识\n收集NVMe盘的子系统信息\n\n2.2.3 bmc.dev.NVMe.Smart\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nStatus\nU8\n只读\n变更广播\nSMART告警状态\n\nAvailableSpare\nU8\n只读\n变更广播\n驱动器可用冗余空间的百分比（0到100）\n\nCriticalWarning\nU8\n只读\n变更广播\n控制器状态的重要的告警,bit0:表示冗余空间小于设定的阈值,bit1:表示温度超过或低于一个重要的阈值,bit2:表示由于重要的media错误，器件的可靠性已经降低,bit3:该介质已经被置为只读模式,bit4:表示控制器的易失性器件fail，该域仅在控制器内部存在易失性器件时有效,bit5-7:保留\n\nUsedPercentage\nU8\n只读\n变更广播\n用户实际使用和厂家设定的器件寿命的百分比（0到100）\n\nTLCSpareBlockPercentage\nU8\n只读\n变更广播\n用户区剩余冗余块百分比\n\nPowerOnHours\nDouble\n只读\n变更广播\n硬盘通电时间\n\n2.2.4 bmc.dev.Drive.NVMe.HwDefinedSmart\n\n属性名\n类型\n可读写\n信号通知\n描述\n\nTlcTotalSpareBlock\nU32\n只读\n变更广播\n用户区出厂时冗余块总数\n\nSlcTotalSpareBlock\nU32\n只读\n变更广播\n非用户区出厂时冗余块总数\n\nTlcValidSpareBlock\nU32\n只读\n变更广播\n用户区当前有效冗余块个数\n\nSlcValidSpareBlock\nU32\n只读\n变更广播\n非用户区当前有效冗余块个数\n\nTlcUsedLifespan\nU32\n只读\n变更广播\n用户区根据P/E情况评估的已使用寿命\n\nSlcUsedLifespan\nU32\n只读\n变更广播\n非用户区根据P/E情况评估的已使用寿命\n\nTlcNandWriteLow\nU32\n只读\n变更广播\n用户区nand flash写入量低位\n\nTlcNandWriteHigh\nU32\n只读\n变更广播\n用户区nand flash写入量高位\n\nTlcPeCycle\nU32\n只读\n变更广播\n用户区擦除次数规格值\n\nSlcPeCycle\nU32\n只读\n变更广播\n非用户区擦除次数规格值\n\nTlcEraseCount\nU32\n只读\n变更广播\n用户区擦除次数(最大,最小,平均)\n\nSlcEraseCount\nU32\n只读\n变更广播\n非用户区擦除次数(最大,最小,平均)\n\nTlcWearout\nU32\n只读\n变更广播\n用户区剩余磨损\n\nSlcWearout\nU32\n只读\n变更广播\n非用户区剩余磨损\nlinks: #p-5278-nvmev10-1, #p-5278-h-2, #p-5278-h-1-nvme-3, #p-5278-h-11-nvme-4, #p-5278-h-111-nvme-5, #p-5278-h-2-nvme-6, #p-5278-h-21-nvme-7, #p-5278-h-211-bmcdevnvme-8, #p-5278-h-212-bmcdevnvmemanagement-9, #p-5278-h-213-bmcdevnvmeproductinfo-10, #p-5278-h-214-bmcdevnvmemultirecord-11, #p-5278-h-215-bmcdevnvmestatus-12, #p-5278-h-216-bmcdevnvmecooling-13, #p-5278-h-217-bmcdevnvmebasicmanagement-14, #p-5278-h-22-nvme-15, #p-5278-h-221-bmcdevnvmenvmemi-16, #p-5278-h-222-bmcdevnvmelogcollection-17, #p-5278-h-223-bmcdevnvmesmart-18, #p-5278-h-224-bmcdevdrivenvmehwdefinedsmart-19",
    "topic_user_name": "Changxing Open Ubmc",
    "best_answer_url": "",
    "reply_posts": []
}