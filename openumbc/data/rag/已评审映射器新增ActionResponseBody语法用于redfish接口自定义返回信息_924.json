{
    "topic_id": 924,
    "question": "【已评审】映射器新增ActionResponseBody语法，用于redfish接口自定义返回信息 - content: 关联issue\n映射器新增ActionResponseBody语法，用于Action类型的redfish接口根据自定义response返回信息\n背景\nredfish协议升级，如果资源定义了Action Response，则该Action的响应体需要按照定义的Action Response进行返回\n决策点\n映射器新增ActionResponseBody语法，用于Action类型的redfish接口根据定义的ActionResponseBody返回信息\n整体架构/方案\n映射器新增ActionResponseBody语法，用于Action类型的redfish接口根据定义的ActionResponseBody返回信息\n详细描述\n1、方案概述：\n映射器新增ActionResponseBody语法，用于Action类型的redfish接口根据定义的ActionResponseBody返回信息\n2、自定义action响应体配置示例\n{\n    \"Uri\": \"/redfish/v1/CertificateService/Actions/CertificateService.GenerateCSR\",\n    \"Interfaces\": [\n        {\n            \"Type\": \"POST\",\n            \"ReqBody\": {\n                ...\n            },\n            \"ActionResponseBody\": {\n                \"CSRString\": \"${ProcessingFlow[1]/Destination/CSRString}\",\n                \"Certificate\": \"${ReqBody/Certificate}\"\n            },\n            \"Statements\": {\n                ...\n            },\n            \"ProcessingFlow\": [\n                ...\n            ]\n        }\n    ]\n}\n\n响应示例\n{\n    \"CSRString\": \"----BEGIN CERTIFICATE REQUEST-----...----END CERTIFICATE REQUEST------\",\n    \"Certificate\": {\n        \"@odata.id\": \"/redfish/v1/Managers/BMC/NetworkProtocol/Https/Certifacates/1\"\n    }\n}\n\n3、redfish协议参考：https://www.dmtf.org/sites/default/files/standards/documents/DSP0266_1.22.0.pdf\n3.1、redfish协议描述：\n3.1.1只有响应码为200或者201的action类型的Post接口才支持自定义响应体\nTable 11 — POST (action) status codes\n\nTo indicate\nHTTP status code\nHTTP status code\n\nSuccess, and the action’s schema definition does not contain an action response.\n200 OK\nAn error response, with a message that indicates success or any additional relevant messages. If the action was successfully processed and completed without errors, warnings, or other notifications for the client, the service should return the Success message from the Base Message Registry in the code property in the response body.\n\nSuccess, and the action’s schema definition contains an action response\n200 OK\nThe response body conforms to the action response defined in the schema.\n\nA new resource was created, and the action’s schema definition does not contain an action response.\n201 Created\nA Location response header set to the URI of the created resource. An error response, with a message that indicates success or any additional relevant messages. If the action was successfully processed and completed without errors, warnings, or other notifications for the client, the service should return the Success message or Created message from the Base Message Registry in the code property in the response body.\n\n  A new resource was created, and the action’s schema definition contains an action response.\n201 Created\nA Location response header set to the URI of the created resource. The response body conforms to the action response defined in the schema.\n\nAdditional time is required to process.\n202 Accepted\nA Location response header set to the URI of a task monitor\n\nSuccess, and the action’s schema definition does not contain an action response.\n204 No Content\nNo response body.\n\n3.2、redfish协议示例：\n3.2.1、通过配置schema文件来定义响应体\n11.2.5.5 Action with a response body\nA response body for an action shall be defined using the actionResponse term within the action definition. For example, the following definition defines the GenerateTicket action with a response that contains the definition specified by #/definitions/GenerateTicketResponse .\n{\n    \"GenerateTicket\": {\n        \"actionResponse\": {\n            \"$ref\": \"#/definitions/GenerateTicketResponse\"\n        },\n        \"parameters\": {}\n    },\n    \"GenerateTicketResponse\": {\n        \"additionalProperties\": false,\n        \"description\": \"The response body for GenerateTicket.\",\n        \"properties\": {\n            \"TicketId\": {\n                \"description\": \"The ticket identifier.\",\n                \"readonly\": true,\n                \"type\": \"string\"\n            }\n        },\n        \"required\": [\"TicketId\"],\n        \"type\": \"object\"\n    }\n}\n\nIn the previous example, the following payload is an example response for the GenerateTicket action.\n{\n    \"TicketId\": \"40478281bd0f6b9e7131db6c4f673438\"\n}\n\n评审结论\n1、同意映射器新增ActionResponseBody语法，用于Action类型的redfish接口根据定义的ActionResponseBody返回信息\n2、需要添加映射器语法校验检查ActionResponseBody语法\n3、社区的文档需要添加ActionResponseBody语法的解释\nlinks: #p-1895-issue-1, https://gitcode.com/openUBMC/rackmount/issues/90, #p-1895-h-2, #p-1895-h-3, #p-1895-h-4, #p-1895-h-5, #p-1895-h-1-6, #p-1895-h-2action-7, #p-1895-h-3redfishhttpswwwdmtforgsitesdefaultfilesstandardsdocumentsdsp0266_1220pdf-8, https://www.dmtf.org/sites/default/files/standards/documents/DSP0266_1.22.0.pdf, #p-1895-h-31redfish-9, #p-1895-h-32redfish-10, #p-1895-h-11",
    "topic_user_name": "Zhengzege",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/924/2",
            "text": ""
        }
    ]
}