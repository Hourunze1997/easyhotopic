{
    "topic_id": 752,
    "question": "【已评审】新增获取硬盘NVMe mi标准协议信息资源树方法 - content: 【已评审】新增获取硬盘NVMe mi标准协议信息资源树方法\n关联issue\n支持硬盘获取NVMe mi标准协议信息\n评审背景\n\n某厂商需定制接口发送标准NVMe mi协议获取硬盘信息，组件提供rpc接口指定命令进行报文收发\n\n资源树新增方法\n评审点： 是否新增方法GetSmartInfo，SendNvmeMICommand，GetTelemetryData，GetIdentifyData\n资源树路径： /bmc/kepler/Systems/:SystemId/Storage/Drives/:Id\n资源树接口： bmc.kepler.Systems.Storage.Drive.NVMe\n新增方法：\n\n方法名称\n变化类型\nreq签名\nreq说明\nrsp签名\nrsp说明\n权限\n方法说明\n接口约束\n\nGetSmartInfo\n新增方法\nq\nVendor：指定smart信息为标准协议还是自定义,标准格式传0,自定义传厂商自定义标识\nay\nMessageResponse： 响应报文, 小端字节序排列\nBasicSetting\n通过标准NVMe-mi协议获取SMART/Health Information\n\nSendNvmeMICommand\n新增方法\nyuuay\nOpcode：该字段指定要处理的 NVMe-MI 命令的操作码Dword0：该字段为特定命令的 Dword 0Dword1：该字段为特定命令的 Dword 1RequestData：预留请求字节, 小端字节序排列\nyuay\nStatus：该字段为命令的响应码NVMeResponse：该字段为特定命令响应ResponseData：预留响应字节, 小端字节序排列\nUserMgmt\n按照标准NVMe-mi协议发送NVMe-MI Command格式命令,请求参数可以参照协议第5章Management Interface Command Set的请求报文填充\n\nGetTelemetryData\n新增方法\ns\nDataType：指定收集硬盘host或controller的日志,取值范围：Host/Controller\nu\nTaskId：任务标识\nBasicSetting\n通过标准NVMe-mi协议获取Telemetry Host/Controller-initiated\n\nGetIdentifyData\n新增方法\ny\nCNSValue：指定Controller or Namespace Structure决定该命令返回的数据结构,参考协议的Identify – CNS Values图表定义\nay\nMessageResponse： 响应报文, 小端字节序排列\nBasicSetting\n通过标准NVMe-mi协议获取Identify command信息\n\n附件：\nSendNvmeMICommand：NVMe-MI Command Request格式\nimage1205×561 55.9 KB\nimage1337×528 48.8 KB\n评审结论\n1、同意在/bmc/kepler/Systems/:SystemId/Storage/Drives/:Id路径下新增接口bmc.kepler.Systems.Storage.Drive.NVMe，并在接口下新增GetSmartInfo，SendNvmeMICommand，GetTelemetryData，GetIdentifyData方法，\n详细信息如下：\n\n方法名称：GetSmartInfo\nreq签名：q\nrsp签名：ay\n权限：BasicSetting\n说明：通过标准NVMe-mi协议获取SMART/Health Information\n\n方法名称：SendNvmeMICommand\nreq签名：yuuay\nrsp签名：yuay\n权限：UserMgmt\n说明：按照标准NVMe-mi协议发送NVMe-MI Command格式命令,请求参数可以参照协议第5章Management Interface Command Set的请求报文填充\n\n方法名称：GetTelemetryData\nreq签名：s\nrsp签名：u\n权限：BasicSetting\n说明：通过标准NVMe-mi协议获取Telemetry Host/Controller-initiated\n\n方法名称：GetIdentifyData\nreq签名：y\nrsp签名：ay\n权限：BasicSetting\n说明：通过标准NVMe-mi协议获取Identify command信息\n\n遗留问题\n补充参数说明，需要从协议文档获取属性定义的，如Opcode， CNSValue\n– 已补充相关参数需按照标准协议填写\nSendNvmeMICommand权限确定合理性\n– 已确定改格式报文有设置操作，需将使用权从BasicSetting限调整至UserMgmt\nlinks: #p-1568-nvme-mi-1, #p-1568-issue-2, https://gitcode.com/openUBMC/storage/issues/13, #p-1568-h-3, #p-1568-h-4, https://discuss.openubmc.cn/uploads/default/original/1X/abd91f566861e49533e1e7b219c8f3424a967e34.png, https://discuss.openubmc.cn/uploads/default/original/1X/f7d734d3ae8fac1d5179a57731b519222b7d79c5.png, #p-1568-h-5, #p-1568-h-6",
    "topic_user_name": "maoyuhao",
    "best_answer_url": "",
    "reply_posts": []
}