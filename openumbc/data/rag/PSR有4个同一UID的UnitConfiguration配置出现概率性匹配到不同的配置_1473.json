{
    "topic_id": 1473,
    "question": "【PSR】有4个同一UID的UnitConfiguration配置，出现概率性匹配到不同的配置 - Connector的A2a偶尔匹配到IEU1，有时候匹配到IEU2，想知道这个是怎么匹配的，因为这边的场景是有不同的机型，可能存在一个Riser卡的不同接线，想知道这个是怎么匹配，从而避免类似冲突问题。\n有重复A2a的PSR配置如下：\n        \"UnitConfiguration_IEU1\": {\n            \"SlotType\": \"IEU\",\n            \"SlotNumber\": 1,\n            \"SlotSilkText\": \"IEUSlot1\",\n            \"Configurations\": [\n\n                    \"UID\": \"00000001040302023942\",\n                    \"Index\": 1,\n                    \"Default\": true,\n                    \"SrcPortName\": [\n                        \"A2a\",\n                        \"A2c\",\n                        \"A3a\"\n                    ],\n                    \"TargetPortID\": [\n                        33,\n                        34,\n                        49\n                    ],\n                    \"Slot\": [\n                        255,\n                        2,\n                        3\n                    ],\n                    \"Device\": []\n\n...\n        \"UnitConfiguration_IEU2\": {\n            \"SlotType\": \"IEU\",\n            \"SlotNumber\": 2,\n            \"SlotSilkText\": \"IEUSlot2\",\n            \"Configurations\": [\n                {\n                    \"UID\": \"00000001040302023942\",\n                    \"Index\": 1,\n                    \"Default\": true,\n                    \"SrcPortName\": [\n                        \"C6a\",\n                        \"A2a\",\n                        \"A2c\",\n                        \"C7b\"\n                    ],\n                    \"TargetPortID\": [\n                        17,\n                        33,\n                        34,\n                        49\n                    ],\n                    \"Slot\": [\n                        4,\n                        5,\n                        6\n                    ],\n                    \"Device\": []\n                },\n\n日志有看到槽位被变更的记录，在闭源代码hwdiscovery\n1970-01-01 08:00:47.405771 hwdiscovery NOTICE: init.lua(136): get csr data from /data/opt/bmc/sr/backup/00000001040302023942_01010103.bin, format version: 1.00, data version: 1.24, position: 01010103\n1970-01-01 08:00:47.407495 hwdiscovery WARNING: init.lua(228): get data from /opt/bmc/sr/14100513_00000001040302023942.sr, error: Local file not found, failed to open file: /opt/bmc/sr/14100513_00000001040302023942.sr, status: 4\n1970-01-01 08:00:47.408754 hwdiscovery NOTICE: hwcomponent.lua(103): Local file not found, failed to open file: /opt/bmc/extend/CTCC/sr/14100513_00000001040302023942_cust.sr, status: 4\n1970-01-01 08:00:47.410081 hwdiscovery NOTICE: unit_configuration.lua(65): [Plugin:unit_configuration] Update Connector Connector_A2a_010101 slot to 2\n1970-01-01 08:00:47.411390 hwdiscovery NOTICE: hwcomponent.lua(163): start to process sr data, source: /data/opt/bmc/sr/backup/00000001040302023942_01010103.bin, format version: 1.00, data version: 1.24, position: 01010103\n1970-01-01 08:00:47.557862 hwdiscovery NOTICE: sdr.lua(74): get objects, count: 55, position: 01010103\n\n1970-01-01 08:00:48.319208 hwproxy NOTICE: app_objects.lua(39): get topology successfully, position: 01010C04, topology: {\"Anchor\":[\"I2cMux_SMC_4_01010C\"],\"I2cMux_SMC_4_01010C\":[\"Chip_Nvme_01010C04\"]}\n1970-01-01 08:00:48.322004 hwproxy NOTICE: object_manage.lua(217): add objects completely, path: /bmc/kepler/ObjectGroup/01010C04, position: 01010C04, life cycle id: 1, took 40ms\n1970-01-01 08:00:48.343744 hwdiscovery NOTICE: init.lua(243): set component unique id: 00000001040302023942 and eeprom data version: 1.24 to connector: Connector_A2a_010101, position: 01010103\n1970-01-01 08:00:48.345236 hwdiscovery NOTICE: init.lua(136): get csr data from /data/opt/bmc/sr/backup/00000001040302023942_01010103.bin, format version: 1.00, data version: 1.24, position: 01010103\n1970-01-01 08:00:48.346975 hwdiscovery WARNING: init.lua(228): get data from /opt/bmc/sr/14100513_00000001040302023942.sr, error: Local file not found, failed to open file: /opt/bmc/sr/14100513_00000001040302023942.sr, status: 4\n1970-01-01 08:00:48.348363 hwdiscovery NOTICE: hwcomponent.lua(103): Local file not found, failed to open file: /opt/bmc/extend/CTCC/sr/14100513_00000001040302023942_cust.sr, status: 4\n1970-01-01 08:00:48.350522 hwdiscovery NOTICE: unit_configuration.lua(65): [Plugin:unit_configuration] Update Connector Connector_A2a_010101 slot to 1\n1970-01-01 08:00:48.352462 hwdiscovery NOTICE: hwcomponent.lua(163): start to process sr data, source: /data/opt/bmc/sr/backup/00000001040302023942_01010103.bin, format version: 1.00, data version: 1.24, position: 01010103\n1970-01-01 08:00:48.503328 hwdiscovery NOTICE: sdr.lua(74): get objects, count: 55, position: 01010103",
    "topic_user_name": "HKZY_YangBo",
    "best_answer_url": "/t/topic/1473/4",
    "reply_posts": [
        {
            "user_name": "王祝炜",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/1473/2",
            "text": "content: wangzhuwei3@h-partners.com 日志麻烦转发我一份。\nlinks: mailto:wangzhuwei3@h-partners.com"
        },
        {
            "user_name": "HKZY_YangBo",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/1473/3",
            "text": "已发送"
        },
        {
            "user_name": "王祝炜",
            "topic_closed": true,
            "is_solution": true,
            "post_url": "/t/topic/1473/4",
            "text": "content: 关于riser卡的槽位更新，流程是：\n1、低速信号在位。比如是Scanner_A2a\n2、对应连接器变为在位。Connector_A2a的Presence变为1，触发框架读取eeprom数据加载riser卡。\n3、解析Connector名字里的SrcPortName，比如Connector_A2a就是A2a。\n4、根据PSR里的线缆配置，查到A2a对应的SlotNumber，设置到Connector的Slot属性，作为riser卡的槽位号。\nimage418×292 5.82 KB\n问题场景里，Connector_A2a 是riser卡的连接器，A2a这个UBC口同时出现在槽位1和槽位2的线缆配置里，lua table是无序的，判断riser卡的槽位就会概率匹配到不同的槽位。\n定位结论：\n同一个UID的riser卡可能插到槽位1，也可能插到槽位2，不同的线缆配置里都有低速信号的名称，根据低速信号的scanner名称无法区分两种槽位的线缆配置。\n规避方法：\n这种场景，配置2个PSR来避免冲突。\nlinks: https://discuss.openubmc.cn/uploads/default/original/2X/0/0b8a6cfc22023afa94cee0f2f1620c000bafed7c.png, #p-4111-h-1, #p-4111-h-2"
        }
    ]
}