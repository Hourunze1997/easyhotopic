{
    "topic_id": 1377,
    "question": "网卡配置指南 - content: 网卡配置指南\n 文档说明\n新适配一张网卡需要做什么\n新增一个sr文件\n这个sr文件是用来告诉openUBMC如何识别、管理和监网卡的\"说明书\"。就像给电脑安装新硬件时需要驱动程序一样，这个配置文件告诉BMC：\n\n网卡的名称以及型号等固定信息\n网卡支持什么带外协议\n如何监控网卡的工作状态\n出现什么问题时需要上报告警\n管理网卡的传感器\n\n为什么需要这个配置文件？\n\n设备识别：让BMC可以识别安装了什么网卡\n状态监控：实时监控网卡，网口，光模块的温度等信息\n故障预警：当网卡出现问题时及时告警\n维护支持：方便技术人员进行维护和故障排查\n\n如何配置这个文件？\n第一步：了解需要配置的网卡\n\n查看网卡型号（通常在网卡上会标注）\n确认网卡类型（PCIe、OCP、板载等）\n记录网卡的基本信息（四元组等）\n热设计\n\n第二步：修改配置文件\n\n基础信息配置（第1节）\n\n配置正确的文件名称，根据BOM+四元组信息组成对应网卡的文件名\n填写网卡名称和型号\n选择正确的网卡类型\n输入厂商和设备ID\n\n以上步骤配置完成后网卡可加载起来\n\n端口/光模块配置（第2节）\n\n设置网卡端口数量\n配置端口类型（光纤、铜缆等）\n配置光模块关联端口\n\n监控配置（第3节）\n\n设置温度监控阈值，用于告警或调速\n配置电压和功率监控，如告警或传感器\n设置状态监控参数\n\n其余配置（第4节）\n\n配置故障报警条件\n设置LED指示灯代码\n定义报警级别\n\n带外信息获取\n\n在 NetworkAdapter对象下有一个Model属性，该属性用于配合社区组件network_adapter加载并指定协议获取网卡带外信息\n目前社区已支持协议smbus、ncsi/pldm over mctp等\n如果需要新增厂商自定义协议等，可以上sig-hardware申报议题，后续会在社区提供适配新协议的指导说明\n\n对配置有疑问或者需要支撑的可以在当前话题评论或新增话题我们将尽快回复您\n1. 基础设备对象\n1.1 PCIe设备对象 (PCIeDevice_1)\n{\n    \"PCIeDevice_1\": {\n        \"DeviceName\": \"PCIe Card $ (设备型号)\",\n        \"FunctionClass\": 2,  // 功能类型\n        \"PCIeDeviceType\": \"MultiFunction\",  // 设备类型\n        \"SlotType\": \"FullLength\",  // 插槽类型\n        \"FunctionProtocol\": \"PCIe\",  // 协议类型\n        \"FunctionType\": \"Physical\"  // 功能类型\n    }\n}\n\n用途：定义PCIe设备的基本属性和类型\n必需配置：是\n关键属性：\n\n设备名称\n功能类型\n设备类型\n插槽类型\n\n1.2 网卡对象 (PCIeCard_1)\n{\n    \"PCIeCard_1\": {\n        \"Name\": \"设备型号\",\n        \"Description\": \"设备描述\",\n        \"VendorID\": \"厂商ID\",\n        \"DeviceID\": \"设备ID\",\n        \"Manufacturer\": \"制造商\",\n        \"PartNumber\": \"部件号\",\n        \"Model\": \"型号\",\n        \"FirmwareVersion\": \"固件版本\",\n        \"SerialNumber\": \"序列号\"\n    }\n}\n\n用途：定义网卡的基本信息和属性\n必需配置：是\n关键属性：\n\n名称\n描述\n厂商ID\n设备ID\n制造商信息\n\n1.3 网络适配器对象 (NetworkAdapter_1)\n{\n    \"NetworkAdapter_1\": {\n        \"Name\": \"适配器名称\",\n        \"Description\": \"适配器描述\",\n        \"NetworkPortCount\": \"端口数量\",\n        \"VendorID\": \"厂商ID\",\n        \"DeviceID\": \"设备ID\",\n        \"SupportedMctp\": true,  // 是否支持MCTP\n        \"SupportedLLDP\": true,  // 是否支持LLDP\n        \"HotPluggable\": false,  // 是否支持热插拔\n        \"LinkWidth\": \"链路宽度\",\n        \"LinkSpeed\": \"链路速度\"\n    }\n}\n\n用途：定义网络适配器的功能和特性\n必需配置：是\n关键属性：\n\n名称\n描述\n端口数量\n支持特性\n\n1.4 网卡类型对象\n根据网卡类型的不同，会使用不同的对象类型：\n1.4.1 标准PCIe网卡对象 (BoardPCIeCard_1)\n{\n    \"BoardPCIeCard_1\": {\n        \"Slot\": 1,\n        \"UID\": \"N/A\",\n        \"Name\": \"网卡名称\",\n        \"Manufacturer\": \"制造商\",\n        \"Type\": \"PCIeCard\",\n        \"Description\": \"网卡描述\",\n        \"PartNumber\": \"部件号\",\n        \"BoardType\": \"BoardPCIeCard\",\n        \"Number\": 1,\n        \"DeviceName\": \"<=/PCIeDevice_1.DeviceName\",\n        \"Position\": \"<=/PCIeDevice_1.Position\",\n        \"LinkWidthCapability\": \"<=/NetworkAdapter_1.LinkWidthCapability\",\n        \"LinkSpeedCapability\": \"<=/NetworkAdapter_1.LinkSpeedCapability\",\n        \"LinkWidth\": \"<=/NetworkAdapter_1.LinkWidth\",\n        \"LinkSpeed\": \"<=/NetworkAdapter_1.LinkSpeed\",\n        \"BoardNodeId\": \"<=/PCIeDevice_1.DeviceName\",\n        \"FruID\": \"<=/Fru_PCIeCard.FruId\"\n    }\n}\n\n用途：用于标准PCIe网卡\n适用场景：普通PCIe网卡\n关键属性：\n\n插槽信息\n链路能力\n板卡类型\nFRU信息\n\n1.4.2 OCP网卡对象 (OCPCard_1)\n{\n    \"OCPCard_1\": {\n        \"Slot\": 1,\n        \"UID\": \"N/A\",\n        \"Name\": \"OCP网卡名称\",\n        \"Manufacturer\": \"制造商\",\n        \"Type\": \"OCPCard\",\n        \"Description\": \"OCP网卡描述\",\n        \"PartNumber\": \"部件号\",\n        \"BoardType\": \"OCPCard\",\n        \"Number\": 1,\n        \"DeviceName\": \"<=/PCIeDevice_1.DeviceName\",\n        \"Position\": \"<=/PCIeDevice_1.Position\",\n        \"LinkWidthCapability\": \"<=/NetworkAdapter_1.LinkWidthCapability\",\n        \"LinkSpeedCapability\": \"<=/NetworkAdapter_1.LinkSpeedCapability\",\n        \"LinkWidth\": \"<=/NetworkAdapter_1.LinkWidth\",\n        \"LinkSpeed\": \"<=/NetworkAdapter_1.LinkSpeed\",\n        \"BoardNodeId\": \"<=/PCIeDevice_1.DeviceName\",\n        \"FruID\": \"<=/Fru_PCIeCard.FruId\"\n    }\n}\n\n用途：用于OCP（Open Compute Project）网卡\n适用场景：OCP规格网卡\n关键属性：\n\nOCP特定属性\n链路能力\n板卡类型\nFRU信息\n\n1.4.3 板载网卡对象 (BoardNICCard_1)\n{\n    \"BoardNICCard_1\": {\n        \"Slot\": 1,\n        \"UID\": \"N/A\",\n        \"Name\": \"板载网卡名称\",\n        \"Manufacturer\": \"制造商\",\n        \"Type\": \"NICCard\",\n        \"Description\": \"板载网卡描述\",\n        \"PartNumber\": \"部件号\",\n        \"BoardType\": \"BoardNICCard\",\n        \"Number\": 1,\n        \"DeviceName\": \"<=/PCIeDevice_1.DeviceName\",\n        \"Position\": \"<=/PCIeDevice_1.Position\",\n        \"LinkWidthCapability\": \"<=/NetworkAdapter_1.LinkWidthCapability\",\n        \"LinkSpeedCapability\": \"<=/NetworkAdapter_1.LinkSpeedCapability\",\n        \"LinkWidth\": \"<=/NetworkAdapter_1.LinkWidth\",\n        \"LinkSpeed\": \"<=/NetworkAdapter_1.LinkSpeed\",\n        \"BoardNodeId\": \"<=/PCIeDevice_1.DeviceName\",\n        \"FruID\": \"<=/Fru_PCIeCard.FruId\"\n    }\n}\n\n用途：用于板载网卡\n适用场景：主板集成网卡\n关键属性：\n\n板载特定属性\n链路能力\n板卡类型\nFRU信息\n\n1.5 网卡类型选择指南\n\n标准PCIe网卡 (BoardPCIeCard_1)\n\n适用于独立的PCIe网卡\n\nOCP网卡 (OCPCard_1)\n\n适用于OCP规格的网卡\n\n板载网卡 (BoardNICCard_1)\n\n适用于主板集成的网卡\n\n2. 端口对象\n2.1 网络端口对象 (NetworkPort_X)\n{\n    \"NetworkPort_0\": {\n        \"@Parent\": \"NetworkAdapter_1\",\n        \"SystemID\": 1,\n        \"PortID\": 0,\n        \"NetDevFuncType\": \"设备功能类型\",\n        \"MediumType\": \"FiberOptic\",  // 介质类型\n        \"SupportedLinkCapability\": \"链路能力\"\n    }\n}\n\n用途：定义网络端口属性和能力\n必需配置：是\n关键属性：\n\n端口ID\n介质类型\n链路能力\n\n2.2 光学模块对象 (OpticalModule_X)\n{\n    \"OpticalModule_0\": {\n        \"@Parent\": \"NetworkPort_0\",\n        \"ChannelNum\": 1,\n        \"TemperatureCelsius\": 0,\n        \"PowerState\": 0,\n        \"IsSupportedType\": 0,\n        \"Temp_UpperThresholdCritical\": 125\n    }\n}\n\n用途：定义光学模块属性和监控参数\n必需配置：对于光纤网卡是必需的\n关键属性：\n\n通道号\n温度\n电源状态\n阈值\n\n3. 监控对象\n传感器定制与开发请参考传感器定制与开发进行配置，以下仅举例网卡相关传感器\n3.1 阈值传感器对象 (ThresholdSensor)\n{\n    \"ThresholdSensor_Temp\": {\n        \"AssertMask\": 128,\n        \"DeassertMask\": 28800,\n        \"ReadingMask\": 2056,\n        \"Linearization\": 0,\n        \"M\": 100,\n        \"RBExp\": 224,\n        \"UpperNoncritical\": 105,\n        \"PositiveHysteresis\": 2,\n        \"NegativeHysteresis\": 2\n    },\n    \"ThresholdSensor_Voltage\": {\n        \"AssertMask\": 128,\n        \"DeassertMask\": 28800,\n        \"ReadingMask\": 2056,\n        \"Linearization\": 0,\n        \"M\": 100,\n        \"RBExp\": 224,\n        \"LowerNoncritical\": 3.0,\n        \"UpperNoncritical\": 3.6,\n        \"PositiveHysteresis\": 0.1,\n        \"NegativeHysteresis\": 0.1\n    },\n    \"ThresholdSensor_Power\": {\n        \"AssertMask\": 128,\n        \"DeassertMask\": 28800,\n        \"ReadingMask\": 2056,\n        \"Linearization\": 0,\n        \"M\": 100,\n        \"RBExp\": 224,\n        \"UpperNoncritical\": 25,\n        \"PositiveHysteresis\": 1,\n        \"NegativeHysteresis\": 1\n    }\n}\n\n用途：用于监控连续变化的物理量\n适用场景：\n\n温度监控\n电压监控\n功率监控\n\n关键属性：\n\n阈值设置\n滞后值\n线性化参数\n\n3.2 离散传感器对象 (DiscreteSensor)\n{\n    \"DiscreteSensor_Presence\": {\n        \"AssertMask\": 1,\n        \"DeassertMask\": 2,\n        \"ReadingMask\": 3,\n        \"Type\": 0\n    },\n    \"DiscreteSensor_PowerState\": {\n        \"AssertMask\": 4,\n        \"DeassertMask\": 8,\n        \"ReadingMask\": 12,\n        \"Type\": 0\n    },\n    \"DiscreteSensor_FaultState\": {\n        \"AssertMask\": 16,\n        \"DeassertMask\": 32,\n        \"ReadingMask\": 48,\n        \"Type\": 0\n    }\n}\n\n用途：用于监控离散状态\n适用场景：\n\n设备在位状态\n电源状态\n故障状态\n\n关键属性：\n\n状态掩码\n类型定义\n\n3.3 散热控制对象 (CoolingRequirement_X)\n{\n    \"CoolingRequirement_1_50\": {\n        \"Description\": \"网卡芯片调速\",\n        \"MonitoringStatus\": \"监控状态\",\n        \"TargetTemperatureCelsius\": 90,\n        \"MaxAllowedTemperatureCelsius\": 102\n    }\n}\n\n用途：定义散热控制参数\n必需配置：是\n关键属性：\n\n目标温度\n最大允许温度\n\n4. 事件对象\n精细化告警开发请参考事件定制进行配置，以下仅举例网卡相关告警\n4.1 基本事件对象\n{\n    \"Event_PCIeBandWidth\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardBandWidthDecreased\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_PCIeLinkSpeed\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardLinkSpeedReduced\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_PCIeCardUCE\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardUncorrectableErr\",\n        \"xxx\": \"xxxx\"\n    }\n}\n\n用途：定义基本事件监控\n必需配置：否\n\n4.2 温度相关事件\n{\n    \"Event_OverTemp\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardOverTemp\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_TempFail\": {\n        \"EventKeyId\": \"PcieCard.PCIeCardTempFail\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_TempSensorFail\": {\n        \"EventKeyId\": \"PcieCard.PCIeCardTempSensorFail\",\n        \"xxx\": \"xxxx\"\n    }\n}\n\n4.3 电源相关事件\n{\n    \"Event_PowerFail\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardPowerFail\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_VoltageAlarm\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardVoltageAlarm\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_PowerOverload\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardPowerOverload\",\n        \"xxx\": \"xxxx\"\n    }\n}\n\n4.4 端口相关事件\n{\n    \"Event_Port1LinkDown\": {\n        \"EventKeyId\": \"Port.PortDisconnected\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_OM1PowerAlarm\": {\n        \"EventKeyId\": \"Port.PortOpticalModulePowerAlarm\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_OM1SpeedMatch\": {\n        \"EventKeyId\": \"Port.PortOpticalModuleSpeedMismatch\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_Port1BWUsageMntr\": {\n        \"EventKeyId\": \"NICCard.SystemNetworkBandwidthUsageHigh\",\n        \"xxx\": \"xxxx\"\n    }\n}\n\n4.5 设备状态事件\n{\n    \"Event_DevicePresence\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardPresence\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_PowerState\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardPowerState\",\n        \"xxx\": \"xxxx\"\n    },\n    \"Event_FaultState\": {\n        \"EventKeyId\": \"PCIeCard.PCIeCardFaultState\",\n        \"xxx\": \"xxxx\"\n    }\n}\n\n4.6 事件配置说明\n\nEventKeyId：事件唯一标识符\nCondition：触发条件\n\n数值：直接触发条件\n表达式：基于传感器值的条件\n\nHysteresis：滞后值，防止频繁触发\nLedFaultCode：故障LED指示代码\n\n5. 硬件管理对象\n5.1 FRU对象 (Fru_PCIeCard)\n{\n    \"Fru_PCIeCard\": {\n        \"PcbId\": \"PCB ID\",\n        \"FruId\": 1,\n        \"FruName\": \"FRU名称\",\n        \"ConnectorGroupId\": \"连接器组ID\",\n        \"BoardId\": 255\n    }\n}\n\n用途：定义FRU信息\n必需配置：是\n关键属性：\n\nFRU ID\n名称\nPCB ID\n\n5.2 芯片对象 (Chip_X)\n{\n    \"Chip_Hi1822\": {\n        \"OffsetWidth\": 0,\n        \"AddrWidth\": 1,\n        \"Address\": 232,\n        \"WriteTmout\": 100,\n        \"ReadTmout\": 100\n    }\n}\n\n用途：定义芯片访问参数\n必需配置：是\n关键属性：\n\n地址\n超时时间\n\n6. 管理拓扑对象\n6.1 管理总线对象\n{\n    \"ManagementTopology\": {\n        \"Anchor\": {\n            \"Buses\": [\n                \"I2cMux_Chan\"\n            ]\n        }\n    }\n}\n\n用途：定义管理总线拓扑\n必需配置：是\n关键属性：\n\n总线类型\n通道\nlinks: #p-3200-h-1, #p-3200-h-2, #p-3200-h-3, #p-3200-sr-4, #p-3200-h-5, #p-3200-h-6, #p-3200-h-7, #p-3200-h-8, https://gitcode.com/openUBMC/network_adapter, #p-3200-h-1-9, #p-3200-h-11-pcie-pciedevice_1-10, #p-3200-h-12-pciecard_1-11, #p-3200-h-13-networkadapter_1-12, #p-3200-h-14-13, #p-3200-h-141-pcie-boardpciecard_1-14, #p-3200-h-142-ocp-ocpcard_1-15, #p-3200-h-143-boardniccard_1-16, #p-3200-h-15-17, #p-3200-h-2-18, #p-3200-h-21-networkport_x-19, #p-3200-h-22-opticalmodule_x-20, #p-3200-h-3-21, https://www.openubmc.cn/docs/zh/development/develop_guide/feature_development/sensor.html, #p-3200-h-31-thresholdsensor-22, #p-3200-h-32-discretesensor-23, #p-3200-h-33-coolingrequirement_x-24, #p-3200-h-4-25, https://www.openubmc.cn/docs/zh/development/develop_guide/feature_development/event.html, #p-3200-h-41-26, #p-3200-h-42-27, #p-3200-h-43-28, #p-3200-h-44-29, #p-3200-h-45-30, #p-3200-h-46-31, #p-3200-h-5-32, #p-3200-h-51-fru-fru_pciecard-33, #p-3200-h-52-chip_x-34, #p-3200-h-6-35, #p-3200-h-61-36",
    "topic_user_name": "maoyuhao",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "张雨博",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1377/2",
            "text": "content: 文档已被收集至社区文档中心。https://gitcode.com/openUBMC/docs/pull/84\n归档此文章\nlinks: https://gitcode.com/openUBMC/docs/pull/84"
        },
        {
            "user_name": "张雨博",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1377/3",
            "text": ""
        }
    ]
}