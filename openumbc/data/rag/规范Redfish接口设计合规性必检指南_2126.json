{
    "topic_id": 2126,
    "question": "【规范】Redfish接口设计合规性必检指南 - content: 背景\n本文档旨在为Redfish接口设计提供全面的合规性审计指导，结合DMTF Redfish规范（DSP0266）和业界实践，涵盖协议基础、数据模型、安全性、扩展机制等关键维度，并针对常见设计缺陷提供解决方案。\n合规审计条目\n《标准化属性定义原则》\n所有资源必须 100% 遵循 DMTF 发布的 Redfish Schema 定义，禁止任何形式的标准属性篡改；厂商扩展必须严格限定于 Oem/{{OemIdentifier}} 对象内，且需显示声明 @odata.type 标识 Schema 版本（例如：若 AccountService 资源实现了 1.3.0 版本引入的 ActiveDirectory 属性，则其 @odata.type 属性必须更新为对应的版本）。\n《易变属性识别与Etag管理原则》\n设计Redfish接口时，必须前置识别易变属性（如传感器读数、实时状态），并在接口映射的IgnoreEtags配置中显式声明这些属性，避免因高频数据变更引发事件风暴。\n《Redfish资源连通性与可发现性原则》\n所有资源必须构成以Service Root为起点的连通资源树，通过@odata.id绝对路径识别自身位置，确保客户端能通过标准方式遍历整个资源树，禁止出现不可达资源。资源关联必须严格遵循：\n\n关联类型\n适用场景\n实现方式\n\n嵌套资源\n直接父子关系\n父资源嵌套子资源@odata.id\n\n集合成员\n资源集合中的成员\nMembers数组引用\n\nLinks关联\n跨层级/跨集合引用\nLinks对象引用\n\n规范依据： Redfish DSP0266 6.1\n《OEM自定义查询参数命名规范》\n所有OEM自定义查询参数必须采用 OEM-<厂商唯一标识>-<参数名> 格式，参数名不得与标准Redfish查询参数（如：$select/$expand）同名，禁止包含 &、?、= 等解析冲突字符。\n规范依据： Redfish DSP0266 7.3.1\n《集合资源纯净性原则》\n集合资源的核心职责是提供成员资源的导航服务，禁止响应体扩展 OEM 属性。\n规范依据： Redfish DSP0266 9.3\n《属性 OEM 扩展三通道隔离原则》\n属性 OEM 扩展必须且仅能通过 OEM、 Links、 Actions 三个独立通道实现，三者均允许直接作用于任意标准资源（即使该资源未预定义 Links 或 Actions 字段）和自定义资源。严禁在 Oem 对象内部嵌套扩展 Links 或 Actions 字段，所有扩展必须严格遵循通道隔离。规则解析表：\n\n扩展通道\n扩展场景\n\nOem\n数据属性扩展（添加厂商自定义状态/配置）\n\nLinks\n资源关联扩展（添加导航链接/外部引用）\n\nActions\n操作行为扩展（添加厂商专属操作命令）\n\n规范依据： Redfish DSP0266 9.4\n《Redfish枚举设计原则》\nRedfish枚举设计约束：\n\n类型强制：必须使用字符串类型（string），禁止使用数字或布尔值替代枚举。\n状态数量策略：\n二元状态 → 优先采用布尔类型（boolean）\n三元及以上 → 必须使用枚举类型（enum）\n值域纯净性：不建议定义 \"unknown\" （未知）、\"other\"（其他）等通用占位值，此类值会显著降低系统互操作性。\n\n规范依据： Redfish DSP0266 9.5.2、Redfish DSP0266 9.7.1\n《字符串属性未初始化值空字符串返回原则》\n当Redfish接口的字符串属性由用户/外部服务配置且未设置初始值时，必须返回空字符串 \"\" 以标识属性受支持但未初始化；仅当服务端发生读取错误等异常时，才允许返回null表示错误状态。禁止使用N/A、 <Empty>等非标准占位符。\n\n场景\n返回值\n语义\n\n属性受支持且未初始化\n\"\"\n有效空值，等待用户配置\n\n属性因故障无法读取\nnull\n服务端错误状态\n\n属性不受支持/未实现/集合资源部分实例不支持\n不返回该属性\n客户端应忽略\n\n规范依据： Redfish DSP0266 9.5.3\n《量纲属性单位后缀强制标注原则》\n当属性值包含物理量单位或特殊语义时，必须在属性名称后缀明确标注单位标识符，禁止无量纲属性（如 状态码、比率值）和枚举型属性（如HealthStaus）添加单位后缀。常见单位属性示例：\n\n单位名称\n标准后缀\n示例属性\n\n瓦特\nWatts\nPowerWatts\n\n伏特\nVolts\nReadingVolts\n\n电量\nkWh\nEnergykWh\n\n摄氏度\nCelsius\nTemperatureCelsius\n\n每秒转速\nRPM\nRotationSpeedRPM\n\n带宽\nMbps、Gbps\nPortSpeedMbps、LinkSpeedGbps\n\nCPU速率\nMHz\nProcessorSpeedMHz\n\n毫秒\nMilliseconds\nSensorPollingIntervalMilliseconds\n\n秒\nSeconds\nKeepaliveIntervalSeconds\n\n分钟\nMinutes\nHeartbeatIntervalMinutes\n\n小时\nHours\nPowerOnHours\n\n天\nDays\nPasswordExpirationDays\n\n周\nWeeks\nBackupIntervalWeeks\n\n月\nMonths\nBillingCycleMonths\n\n年\nYears\nWarrantyYears\n\n位\nbit\nTransferInhibit\n\n字节\nBytes\nMemoryBytes\n\nKibibyte\nKiB\nFreeStorageSpaceKiB\n\nMebibyte\nMiB\nMemorySizeMiB\n\nGibibyte\nGiB\nTotalSystemMemoryGiB\n\nTebibyte\nTiB\nTotalCapacityTiB\n\n百分比\nPercent\nPowerLoadPercent\n\n计数\nCount\nProcessorCount\n\n资源状态\nState\nPowerState\n\n规范依据： Redfish DSP0266 9.7.1\n《复杂对象拆分子资源原则》\n属性避免嵌套超过 5 层（Oem/{{OemIdentifier}} 不纳入层级计算）的JSON结构，复杂对象应拆分为子资源。\n违规反例\n# 早期redfish资源设计（深层嵌套JSON）\nGET /redfish/v1/Chassis/1/Thermal\n{\n    \"Id\": \"Thermal\",\n    \"Fans\": [\n        {\n            \"MemberId\": \"Fan1\",\n            \"Reading\": 12000,\n            \"Status\": {\n                \"Health\": \"OK\",\n                \"State\": \"Enabled\"\n            }\n        }\n    ]\n}\n\n合规设计\n# 1. 拆分为子系统资源（减少主资源层级）\nGET /redfish/v1/Chassis/1/ThermalSubsystem\n{\n    \"Id\": \"ThermalSubsystem\",\n    \"Fans\": {\n        \"@odata.id\": \"/redfish/v1/Chassis/1/ThermalSubsystem/Fans\"\n    }\n}\n\n# 2. 复杂对象独立为子资源集合（扁平化）\nGET /redfish/v1/Chassis/1/ThermalSubsystem/Fans\n{\n    \"Members\": [\n        {\n            \"@odata.id\": \"/redfish/v1/Chassis/1/ThermalSubsystem/Fans/1\"\n        }\n    ]\n}\n\n# 3. 属性展开为独立资源（深度控制）\nGET /redfish/v1/Chassis/1/ThermalSubsystem/Fans/1\n{\n    \"FanDiameterMm\": 80,\n    \"SpeedPercent\": {\n        \"SpeedRPM\": 6660\n    }\n}\n\n规范依据： Redfish DSP0266 9.8.2\n《响应敏感数据置空原则》\n任何通过 GET 操作返回的响应中，敏感数据属性（如密码、密钥、令牌）必须显式设置为 null；POST/PATCH 请求中允许传输明文值，且服务端日志必须脱敏处理。此规则对标准资源和 Oem 扩展均强制生效。\n规范依据： Redfish DSP0266 13.2\nlinks: #p-5334-h-1, #p-5334-h-2, #p-5334-h-3, #p-5334-etag-4, #p-5334-redfish-5, #p-5334-oem-6, #p-5334-h-7, #p-5334-oem-8, #p-5334-redfish-9, #p-5334-h-10, #p-5334-h-11, #p-5334-h-12, #p-5334-h-13",
    "topic_user_name": "Data Sculptor",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/2126/2",
            "text": ""
        }
    ]
}