{
    "topic_id": 1668,
    "question": "Syslog RELP协议定制指导 - content: RELP协议介绍\nRELP（Reliable Event Logging Protocol）是基于TCP封装的可靠日志消息传输协议，是为了解决TCP 与 UDP 协议的缺点而在应用层实现的传输协议。\n与其他协议不同，RELP需要多安装rsyslog-relp(omrelp)以支持该协议。\nomrelp安装方式\n可以通过rsyslog官方获取，BMC支持RELP需要分别安装omrelp与librelp，下面对安装方法进行介绍\n在conan_index添加依赖包的编译\n使用conan_index安装omrelp与librelp，需要在代码仓中添加如下文件\n.\n└── recipes\n    ├── omrelp \n    │   ├── all\n    │   │   ├── conanfile.py \n    │   │   ├── conandata.yml\n    │   │   └── permission.ini\n    │   └── config.yml \n    └── librelp \n        ├── all\n        │   ├── conanfile.py \n        │   ├── conandata.yml\n        │   └── permission.ini\n        └── config.yml \n\n依赖开源软件获取方式\n\nomrelp：从https://github.com/rsyslog/rsyslog中提取omrelp.so\nlibrelp：依赖https://github.com/rsyslog/librelp进行构建\n\nomrelp构建脚本conanfile.py内容\n可以参考libyaml的构建脚本，build方法中autotools_dynamic.configure步骤使用参数如下：\n--enable-relp=yes\n--enable-generate-man-pages=no\n--disable-Werror\n--enable-libgcrypt=no\n\n前置执行方法：\nautoreconf -i\n\n在package方法中，使用copy将源文件plugins/omrelp/.libs路径下的omrelp.so放置到BMC的usr/lib64/rsyslog路径下\nlibrelp构建脚本conanfile.py内容\n可以参考libyaml的构建脚本，build方法中autotools_dynamic.configure步骤使用参数如下：\n--enable-tls=no\n\n前置执行方法：\nsudo apt-get install byacc -y\nautoreconf -i\n\n在package方法中，使用copy将源文件src/.libs路径下的librelp.so、librelp.so.0、librelp.so.0.5.1放置到BMC的usr/lib64路径下\n其他配置文件\n\npermissions.ini中，限制获取到的文件权限全部为755\nconandata.yml中，声明引用开源软件的来源，如果遇到无法获取的情况，可以尝试将开源软件引入个人仓，再通过引用个人仓进行编译构建\nconfig.yml中，声明使用的版本，版本号需要与conandata.yml中的版本号相同\n\nmanifest引入编译好的开源软件包\n在manifest仓中manifest.yml文件的dependencies中声明刚刚编译完成的omrelp与librelp与版本\n  - conan: \"librelp/x.x.x@openUBMC.dev/dev\"\n  - conan: \"omrelp/x.x.x@openUBMC.dev/dev\"\n\n定制化北向接口与资源协作接口\n接口相关信息可参考评审链接\n资源协作接口处理逻辑\n优先判断是否为RELP（需要同时打开RELPSupported与RELPEnabled）\n若不为RELP，则判断资源协作接口属性Protocol\n设置syslog支持RELP协议\n添加设置逻辑前确保已安装omrelp与librelp\n在定制仓中的初始化阶段，设置资源树属性RELPSupported为true（ path ：/bmc/kepler/Managers/1/Syslog，interface ：bmc.kepler.Managers.Syslog）\n为确保设置成功，建议添加重试逻辑（避免组件启动时序依赖导致设置失败）\n北向接口定制\n裁剪原有的syslog协议类型属性，添加如下图所示的逻辑\n定制后的北向接口处理逻辑1319×656 27.6 KB\n配置项与定制项\n若有相关方面诉求，需要在定制仓中，添加新的配置项与定制项，用于设置RELPEnabled属性，设置后，只要确保了RELPSupported与RELPEnabled均为true，资源协作接口属性Protocol不生效\nsyslog接收端支持RELP\n首先，确保接收端的/usr/lib64/rsyslog路径下，有文件imrelp.so\n修改配置文件/etc/rsyslog.d/remote.conf 后重启rsyslog，配置文件如下：\n#加载RELP模块\n$ModLoad imrelp\n\n#服务端侦听端口，必须确保处于侦听状态，并不被其他进程占用\n#本例使用11412端口，实际使用时，将端口号改为实际需要的端口号\n$InputRELPServerRun 11412\n\n#日志存放位置,可定义配置日志存放路径\n$template Remote,\"/var/log/relp.log\"\n\n#排除本地IP的日志记录，只记录远程日志\n:fromhost-ip, !isequal, \"127.0.0.1\" ?Remote\nlinks: #p-4049-relp-1, #p-4049-omrelp-2, https://github.com/rsyslog, #p-4049-conan_indexhttpsgitcodecomopenubmcconan_index-3, https://gitcode.com/openUBMC/conan_index, #p-4049-h-4, https://github.com/rsyslog/rsyslog, https://github.com/rsyslog/librelp, #p-4049-omrelpconanfilepy-5, https://gitcode.com/openUBMC/conan_index/blob/main/recipes/libyaml/all/conanfile.py, #p-4049-librelpconanfilepy-6, https://gitcode.com/openUBMC/conan_index/blob/main/recipes/libyaml/all/conanfile.py, #p-4049-h-7, #p-4049-manifest-8, https://gitcode.com/openUBMC/manifest, https://gitcode.com/openUBMC/manifest/blob/main/build/product/BMC/openUBMC/manifest.yml, #p-4049-h-9, https://discuss.openubmc.cn/t/topic/1400, #p-4049-h-10, #p-4049-syslogrelp-11, #p-4049-h-12, https://discuss.openubmc.cn/uploads/default/original/2X/0/0e9743a0eb5b7345eb558491bc987dd3457d8724.png, #p-4049-h-13, #p-4049-syslogrelp-14",
    "topic_user_name": "Zhangyu",
    "best_answer_url": "",
    "reply_posts": []
}