{
    "topic_id": 1942,
    "question": "【待评审】新增redfish请求参数、接口响应内容和查询任务信息接口响应内容的定制化插件机制 - content: 关联issue\nredfish组件新增redfish请求参数、接口响应内容和查询任务信息接口响应体的定制化插件机制\n背景\n为了满足部分用户对redfish请求参数、接口响应内容和查询任务信息接口 （/redfish/v1/TaskService/Tasks/:TaskId）响应的定制诉求，需要提供插件化定制机制，允许客户定制相关内容\n决策点\n决策点1：在定制仓中新增src/plugins/redfish/custom_request_response.lua文件，返回get_req_param函数用于定制redfish请求参数；返回rsp_postprocess函数，用于定制redfish接口响应内容\n该文件在bmc上位于:\n/opt/bmc/extend/<CUSTOMER>/apps/<CUSTOMER>/plugins/redfish/custom_request_response.lua\n\nPS:<CUSTOMER>是对应定制的客户名称\n决策点2：在定制仓中新增src/plugins/redfish/custom_task_response_body.lua文件，返回task_response_body函数用于定制redfish查询任务信息接口（/redfish/v1/TaskService/Tasks/:TaskId）的响应内容\n该文件在bmc上位于:\n/opt/bmc/extend/<CUSTOMER>/plugins/redfish/custom_task_response_body.lua\n\nPS:<CUSTOMER>是对应定制的客户名称\n整体架构/方案\n定制化插件机制的实现\nimage398×771 18.9 KB\n定制redfish请求参数、接口响应内容和redfish 查询任务信息接口响应的总体流程\n定制redfish请求参数、接口响应内容和redfish 查询任务信息接口响应的总体流程965×729 22 KB\n定制化redfish请求参数\n所在定制仓文件：src/plugins/redfish/custom_request_response.lua\n所在bmc位置：\n/opt/bmc/extend/<CUSTOMER>/apps/<CUSTOMER>/plugins/redfish/custom_request_response.lua\n\n函数名称：get_req_param\n参数：\n\n参数名称\n参数类型\n参数说明\n\nreq\ntable\n请求内容，包含body、header、query、url、method和path\n\nreq结构体的定义:\n\n参数名称\n参数类型\n参数说明\n\nbody\nstring\n请求体\n\nheader\ntable\n请求头\n\nquery\nstring\n查询参数\n\nurl\nstring\n资源标识，包含路径和查询参数\n\nmethod\nstring\n请求方法\n\npath\nstring\n路径参数，本次请求的资源路径（不含查询参数）\n\n返回值：\n\n返回顺序从上往下\n\n参数名称\n参数类型\n参数说明\n\nreq_body\nstring\n定制后的请求体\n\nreq_header\ntable\n定制后的请求头\n\nreq_query\ntable\n定制后的查询参数\n\n定制化redfish响应内容\n所在定制仓文件：src/plugins/redfish/custom_request_response.lua\n所在bmc位置：\n/opt/bmc/extend/<CUSTOMER>/apps/<CUSTOMER>/plugins/redfish/custom_request_response.lua\n\n函数名称：rsp_postprocess\n参数：\n\n参数名称\n参数类型\n参数说明\n\ncode\nint\nHTTP响应码\n\nbody\nstring\n响应体\n\nheader\ntable\n响应头\n\nmanufacture\nstring\n定制化客户名称\n\n返回值：\n\n返回顺序从上往下\n\n参数名称\n参数类型\n参数说明\n\nrsp_body\nstring\n定制后的响应体\n\nrsp_header\ntable\n定制后的响应头\n\n定制化redfish查询任务信息接口的响应内容\n所在定制仓文件：src/plugins/redfish/custom_task_response_body.lua\n所在bmc位置：\n/opt/bmc/extend/<CUSTOMER>/plugins/redfish/custom_task_response_body.lua\n\nPS:<CUSTOMER> 是对应定制的客户名称\n函数名称：task_response_body\n参数：\n\n参数名称\n参数类型\n参数说明\n\nbody\njson object\n该任务接口对应的响应体\n\ntask_data\ntable\n该任务对应的资源协作接口信息\n\nmanufacture\nstring\n定制化客户名称\n\n返回值：\n\n参数名称\n参数类型\n参数说明\n\nrsp_body\njson object\n定制后的响应体\n\n评审结论\nlinks: #p-4775-issue-1, https://gitcode.com/openUBMC/JD/issues/8, #p-4775-h-2, #p-4775-h-3, #p-4775-h-1srcpluginsredfishcustom_request_responseluaget_req_paramredfishrsp_postprocessredfish-4, #p-4775-h-2srcpluginsredfishcustom_task_response_bodyluatask_response_bodyredfishredfishv1taskservicetaskstaskid-5, #p-4775-h-6, #p-4775-h-7, https://discuss.openubmc.cn/uploads/default/original/2X/d/d06a50fc7ba1c9582c5c3103046bbdace5e430ec.png, #p-4775-redfishredfish-8, https://discuss.openubmc.cn/uploads/default/original/2X/5/595079bdaf4fe4e9ea771fe0d5adad6b993e6071.png, #p-4775-redfish-9, #p-4775-redfish-10, #p-4775-redfish-11, #p-4775-h-12",
    "topic_user_name": "Zhengzege",
    "best_answer_url": "",
    "reply_posts": []
}