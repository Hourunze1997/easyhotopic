{
    "topic_id": 671,
    "question": "hardware进程重拉原因分析求助 - content: BMC版本：5.05.12.15\n现象：反复reboot测试，网卡槽位概率255\n\n日志分析：\n\nhardware进程重拉后pcie_device组件过早拿到了pcie_device，进入sync_pcie_addr_info_to_device流程，\n此时pcieaddrinfo还未执行完代码流程，slotid为默认值255，同步给pcie_device，导致问题产生\n\n框架日志：\nimage1609×589 20.7 KB\n2025-04-04 02:57:06.954189 hwproxy NOTICE: init.lua(324): [power_mgmt_plugins] run cmd[start_power_monitor]\n2025-04-04 02:57:06.954541 hwproxy NOTICE: init.lua(226): set [power] read interval 10 successfully\n2025-04-04 02:57:07.968315 hwproxy NOTICE: init.lua(324): [power_mgmt_plugins] run cmd[start_power_monitor]\n2025-04-04 02:57:07.968681 hwproxy NOTICE: init.lua(226): set [power] read interval 10 successfully\n2025-04-04 02:59:23.881456 [:00000014] hardware: lua call [15 to :14 : 2519532 msgsz = 18] error : [31m./opt/bmc/skynet/lualib/skynet.lua:901: ./opt/bmc/skynet/lualib/skynet.lua:330: .../bmc/apps/network_adapter/lualib/hardware_config/CX5.lua:86: attempt to perform bitwise operation on a nil value (local 'v') stack traceback:  .../bmc/apps/network_adapter/lualib/hardware_config/CX5.lua:86: in local 'bsd_to_string'  .../bmc/apps/network_adapter/lualib/hardware_config/CX5.lua:93: in field 'parser'  ./opt/bmc/lualib/libmgmt_protocol/transport/scheduler.lua:60: in upvalue 'func'  ./opt/bmc/skynet/lualib/skynet.lua:804: in local 'cb'  ./opt/bmc/libmc/lualib/mc/context.lua:146: in function 'mc.context.with_context'  (...tail calls...)  ./opt/bmc/skynet/lualib/skynet.lua:280: in function <./opt/bmc/skynet/lualib/skynet.lua:252> stack traceback:  [C]: in function 'assert'  ./opt/bmc/skynet/lualib/skynet.lua:901: in function 'skynet.manager.dispatch_message'[0m\n2025-04-04 03:00:18.245890 framework ERROR: sml_ctrl.c(454): is_logical_drive_epd:Get LD target id failed, return 4609\n2025-04-04 04:28:20.447758 maca NOTICE: base.lua(317): component[network_adapter] exited total 1 times, total 1 times for all modules\n2025-04-04 04:28:20.722988 maca NOTICE: base.lua(317): component[general_hardware] exited total 1 times, total 2 times for all modules\n2025-04-04 04:28:20.952902 maca NOTICE: base.lua(317): component[storage] exited total 1 times, total 3 times for all modules\n2025-04-04 04:28:21.058167 maca NOTICE: base.lua(317): component[mctpd] exited total 1 times, total 4 times for all modules\n2025-04-04 04:28:21.162611 maca NOTICE: base.lua(317): component[lsw] exited total 1 times, total 5 times for all modules\n2025-04-04 04:28:21.255855 maca NOTICE: base.lua(317): component[thermal_mgmt] exited total 1 times, total 6 times for all modules\n2025-04-04 04:28:21.350056 maca NOTICE: base.lua(317): component[chassis] exited total 1 times, total 7 times for all modules\n2025-04-04 04:28:21.450087 maca NOTICE: base.lua(317): component[power_mgmt] exited total 1 times, total 8 times for all modules\n2025-04-04 04:28:21.544329 maca NOTICE: base.lua(317): component[manufacture] exited total 1 times, total 9 times for all modules\n2025-04-04 04:28:21.644697 maca NOTICE: base.lua(317): component[compute] exited total 1 times, total 10 times for all modules\n2025-04-04 04:28:21.768435 maca NOTICE: base.lua(317): component[pcie_device] exited total 1 times, total 11 times for all modules\n2025-04-04 04:28:21.915804 maca NOTICE: base.lua(317): component[bmc_soc] exited total 1 times, total 12 times for all modules\n2025-04-04 04:28:22.032830 maca NOTICE: base.lua(317): component[bios] exited total 1 times, total 13 times for all modules\n2025-04-04 04:28:22.774125 [:00000002] hardware: LAUNCH snlua bootstrap\n2025-04-04 04:28:22.825549 [:00000003] hardware: LAUNCH snlua launcher\n2025-04-04 04:28:22.845106 [:00000004] hardware: LAUNCH snlua cdummy\n2025-04-04 04:28:22.857536 [:00000005] hardware: LAUNCH harbor 0 4\n2025-04-04 04:28:22.865222 [:00000006] hardware: LAUNCH snlua datacenterd\n2025-04-04 04:28:22.875281 [:00000007] hardware: LAUNCH snlua service_mgr\n2025-04-04 04:28:22.905720 [:00000008] hardware: LAUNCH snlua hica/subsys/hardware/service/main\n2025-04-04 04:28:22.926035 [:00000009] hardware: LAUNCH snlua sd_bus\n2025-04-04 04:28:23.471814 [:0000000a] hardware: LAUNCH snlua harbor\n2025-04-04 04:28:23.534683 [:00000002] hardware: KILL self\n2025-04-04 04:28:23.542737 [:0000000b] hardware: LAUNCH snlua pcie_device/service/main\n2025-04-04 04:28:23.543062 [:0000000c] hardware: LAUNCH snlua bios/service/main\n2025-04-04 04:28:23.543208 [:0000000d] hardware: LAUNCH snlua compute/service/main\n2025-04-04 04:28:23.543322 [:0000000e] hardware: LAUNCH snlua bmc_soc/service/main\n2025-04-04 04:28:23.543431 [:0000000f] hardware: LAUNCH snlua manufacture/service/main\n2025-04-04 04:28:23.543536 [:00000010] hardware: LAUNCH snlua thermal_mgmt/service/main\n2025-04-04 04:28:24.238124 [:00000012] hardware: LAUNCH snlua general_hardware/service/main\n2025-04-04 04:28:24.750841 [:00000013] hardware: LAUNCH snlua power_mgmt/service/main\n2025-04-04 04:28:24.944060 [:00000014] hardware: LAUNCH snlua network_adapter/service/main\n2025-04-04 04:28:24.944733 [:00000015] hardware: LAUNCH snlua mctpd/service/main\n2025-04-04 04:28:24.945273 [:00000016] hardware: LAUNCH snlua lsw/service/main\n2025-04-04 04:28:24.945803 [:00000017] hardware: LAUNCH snlua storage/service/main\n2025-04-04 04:28:25.061628 [:00000018] hardware: LAUNCH snlua chassis/service/main\n2025-04-04 04:28:25.213006 [:00000019] hardware: LAUNCH snlua mctpd/service/write_service\n2025-04-04 04:28:26.047537 [:0000001a] hardware: LAUNCH snlua storage/service/smld\n2025-04-04 04:28:26.278903 maca NOTICE: base.lua(374): monitor component mctpd added, service: bmc.kepler.mctpd\n\n求助：\n1.hardware 报错日志可能的原因，比如：ncsi返回的数据未校验\n2.hardware 异常出现在03：00，为什么04：28 maca检测到hardware多个组件异常退出\n3.maca检查机制是：连续3次检测到一个组件健康状态异常才会重拉进程 还是检测到一个进程下所有组件多少次健康状态异常会重拉进程\nLogDump.zip (3.0 MB)\napp_revision.txt (3.8 KB)\nlinks: https://discuss.openubmc.cn/uploads/default/original/1X/abb9c5f663595aae2854b7a423a8ce0bd8c7cc90.png, /uploads/short-url/iouUdwp2hhzkYVnpX9w0l7pNsb6.zip, /uploads/short-url/zWcyAKarCy7MdnSSCQiEoKkf6ym.txt",
    "topic_user_name": "Huangliang",
    "best_answer_url": "/t/topic/671/2",
    "reply_posts": [
        {
            "user_name": "maoyuhao",
            "topic_closed": true,
            "is_solution": true,
            "post_url": "/t/topic/671/2",
            "text": "1、异常重启可以检查一下一键收集日志中CoreDump目录下是否有CoreDump文件产生\n2、打印中明确说明network_adapter/lualib/hardware_config/CX5.lua:93出现异常，可进一步分析network_adapter组件的问题\n3、重启机制为连续3次检测到一个组件健康状态异常就会重拉进程"
        },
        {
            "user_name": "Huangliang",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/671/3",
            "text": "1、异常重启可以检查一下一键收集日志中CoreDump目录下是否有CoreDump文件产生\n答复：->  无CoreDump文件\n3、重启机制为连续3次检测到一个组件健康状态异常就会重拉进程\n疑问：->如framework.log日志所示，maca检测到的是 hardware进程下 多个组件 异常退出，每个组件都只退出了一次，并没有 连续3次检测到同一个组件状态异常，为什么会导致 hardware进程重启呢"
        },
        {
            "user_name": "maoyuhao",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/671/4",
            "text": "怀疑产生coredump，这种情况下不会打印自检失败会直接重启进程。建议进一步分析网卡模块报错原因"
        }
    ]
}