{
    "topic_id": 197,
    "question": "TelemetryService特性介绍 - content: 介绍\n最新openUBMC支持符合redfish标准的TelemetryService特性。\nTelemetryService(中文称为遥测服务)主要为了满足\n\n定期上报或记录由一组指定采集项组成的报告\n\n针对受监控的采集项指定触发阈值，并触发对应事件或记录\n\n两种场景，能够有效提高客户端/服务端交互的效率。\nRedfish数据模型中的采集项\n一个采集项是一个可度量的数量或者指标的值。采集项可以是一个环境上传感器的读值，或者一个数据计数器的值，如“传感器的读值”。\n在Redfish中，可采集项作为属性分布在Redfish资源中。\n可采集项在Redfish数据模型中以多种方式出现，它们可以是：\n\n一个资源中的属性\n\n一个资源中的一个复杂对象的属性\n\n在一个只含有采集项的资源中\n\n在openUBMC中，我们预置了多种采集项供用户组合。\nMetrics类型\n一个metric可以被它的值的表现、走向和它如何被处理的来描述。\nMetric定义可以指定以下类型的metric表现：\n\nNumeric: 值为任意实数的metric\nDiscrete: 值只能取特定离散值的metric, 如倾斜传感器，它测量物理实体的方位，但其值只能是垂直、水平和倾斜\nGauge: 值在一定范围内连续的metric, 大多数数字和数字计量metric都是gauge metric\nCounter: 值为单调递增的非负整数的metric. 当一个counter到达它的最大值，值会置为0并继续计数\nCountdown: 值为单调递减的非负整数的metric. 当一个countdown到达它的最小值，值会置为预设值并继续向下计数\n\nMetric会被以多种方式处理，metric定义可以指定以下类型的处理方式：\n\nCalculated: 通过对一个或多个其他metric计算来实现的metric（指定了计算方式）\nSynthesized: 通过对一个或多个其他metric计算来实现的metric（未指定计算方式）\nPhysical sensor: 作为一个物理传感器来实现的metric\n\n上述术语可用于更准确地定义一些常见metrics.\n\nEnvironmental: 一个测量物理世界特征的metric, 如温度。Environmental metric被实现为physical sensor, calculated或者synthesized\n\n对于physical sensor, 需要知道真实的物理值和测量值是有区别的。对于一个physical sensor，metric定义可以指定精度、准确度和误差特性\n对于calculation metric, calculated metric的误差特性可以根据输入metrics的误差特性计算得出，这被称为误差传播\n\nDigital meter: 用于获取数字仪表读数的numeric metric, 如cache命中寄存器的读数\nStatistical: 在一个时间间隔中计算得到的calculated metric, 如最大功耗\n\ntelemetry模型\nTelemetry模型被设计为一组可选功能。这些功能是相互独立的。Redfish服务可以实现telemetry模型中的一项、两项或更全功能。例如，metric定义可以在没有实现triggers的情况下提供。对于每一个metric property, 可以决定是否提供其metric定义。\ntelemetry服务\n如果提供了Redfish服务，需要在service root包含TelemetryService属性。\nTelemetryService资源是service root最上层的可见资源。TelemetryService有一系列从属于它的资源集合：MetricDefinition资源集合、MetricReportDefinition资源集合、MetricReport资源集合和Triggers资源集合。\n\nMetricDefinition资源包含metric properties的特征或元数据。\nMetricReportDefinition资源包含了生成metric report的描述符，MetricReport资源则是从对应MetricReportDefinition生成的报告。\nMetricDefinition\nMetricDefinition包含指向该定义所应用的metric properties的链接。\n\n在该数据模型中，Power资源包含了一个PowerConsumedWatts属性，描述PowerConsumedWattsmetric property的metric definition是metric definition集合的一个成员。这个metric definition被命名为PowerconsumedWatts来更容易地将metric property和它的definition联系起来。\nMetric definition包含了该definition使用的任何property的引用，即允许相同的metric definition用于描述多个metric properties. 例如，PowerConsumedWattsmetric definition可以引用Chassis集合中每一个Power资源下的PowerConsumedWatts属性。\n在metric definition中，属性可以分为四类：context, usage, measurement和metric references.\ncontext\ncontext类提供以下属性：\n\nProperty\nDescription\nValues\n\nMetricType\nmetric的类型\nNumericDiscreteGaugeCounter\n\nImplementation\n获取metric的方式\nPhysicalSensorDigitalMeterCalculatedSynthesized\n\nPhysicalContext\nmetric的物理上下文\nSee the PhysicalContext schema.\n\nusage\nusage类提供客户端如何使用metric的指导：\n\nProperty\nDescription\nValues\n\nCalculable\n可用于metric读数的计算类型\nNonCalculatable: 没有可以被用于这个metric读数的计算Summable: 多个实例的metric读数之和可以累加NonSummable: 多个实例的metric读数之和累加无意义\n\nCalibration\n客户端添加到metric读数的度量偏移，以获取到实际值\n一个十进制值\n\nIsLinear\n判断metric读数是否是线性的，线性的metrics可以用大于、小于关系比较\nboolean\n\nMaxReadingRange\nmetric读数的最大的可能值\n一个十进制值\n\nMetricDataType\nmetric读数的数据类型\nBooleanStringDecimalIntegerStringEnumeration: 一组定义的枚举字符串\n\nMinReadingRange\nmetric读数的最小的可能值\n一个十进制值\n\nmeasurement\nmeasurement类提供的是表征measurement本身特性（来自 Energy Efficient HPC WG’s PowerAPI 标准）：\n\nProperty\nDescription\n\nAccuracy\n测量值与实际值的估计+/-百分比误差\n\nPrecision\n值中的有效位数\n\nTimestampAccuracy\n返回时间戳的准确性，以 ISO8601 duration表示。\n\n以下是Redfish telemetry模型定义的其它属性：\n\nProperty\nDescription\n\nCalculationAlgorithm\n为获得metric执行的计算\n\nCalculationTimeInterval\n对metric读数进行计算的时间间隔\n\nDiscreteValues\n离散metric的可能值\n\nSensingInterval\n更新metric的时间间隔\n\nUnits\nmetric单位，由UCUM定义\n\nmetric references\nMetricDefinition资源包含了一个metric definition适用的所有metric properties引用的list. 一个metric definition可能适用于很多metric properties, 这可能导致MetricProperties属性包含一个非常大的引用每一个metric property的list.\n为了减小这个list的大小，可以用通配符Wildcards搭配MetricProperties一起使用。通配符机制也可以用于MetricReportDefinition和Triggers资源。\nMetricProperties\nMetricProperties属性的键值是一个包含metric definition可以描述的任意metric property的list, 键值元素字符串中可能包含通配符，通配符用大括号括起来。\n{\n    \"MetricProperties\": [\n        \"/redfish/v1/Chassis/{ChassisID}/Power#/PowerControl/0/PowerConsumedWatts\",\n        \"/redfish/v1/Chassis/{ChassisID}/Power#/PowerControl/1/PowerConsumedWatts\"\n    ]\n}\n\nWildcards\nWildcards属性的键值是一个通配符替换列表的list, 每个通配符条目包含MetricProperties中使用的通配符以及用于替换的值。*表示所有可能取值。\n下例表示每个MetricProperties键值元素中的字符串ChassisID可以替换为1、2和3.\n{\n    \"Wildcards\": [\n        {\n            \"Name\": \"ChassisID\",\n            \"Values\": [\n                \"1\",\n                \"2\",\n                \"3\"\n            ]\n        }\n    ]\n}\n\nMetricDefinition例子\n下面的例子包含了Power资源下的PowerConsumedWatts属性的metric definition.\nPower资源包含了一个array类型的PowerControl属性，array中每一个元素都包含一个PowerConsumedWatts属性，metric definition中的MetricProperties属性指向了两个从Power资源获取的PowerConsumedWatts属性。\n{\n    \"@odata.id\": \"/redfish/v1/TelemetryService/MetricDefinitions/PowerConsumedWatts\",\n    \"@odata.type\": \"#MetricDefinition.v1_0_3.MetricDefinition\",\n    \"Id\": \"PowerConsumedWatts\",\n    \"Name\": \"Power Consumed Watts Metric Definition\",\n    \"MetricType\": \"Numeric\",\n    \"Implementation\": \"PhysicalSensor\",\n    \"PhysicalContext\": \"PowerSupply\",\n    \"MetricDataType\": \"Decimal\",\n    \"Units\": \"W\",\n    \"Precision\": 4,\n    \"Accuracy\": 1,\n    \"Calibration\": 2,\n    \"MinReadingRange\": 0,\n    \"MaxReadingRange\": 50,\n    \"SensingInterval\": \"PT1S\",\n    \"TimestampAccuracy\": \"PT1S\",\n    \"Wildcards\": [\n        {\n            \"Name\": \"ChassisID\",\n            \"Values\": [\n                \"1\",\n                \"2\",\n                \"3\"\n            ]\n        }\n    ],\n    \"MetricProperties\": [\n        \"/redfish/v1/Chassis/{ChassisID}/Power#/PowerControl/0/PowerConsumedWatts\",\n        \"/redfish/v1/Chassis/{ChassisID}/Power#/PowerControl/1/PowerConsumedWatts\"\n    ]\n}\n\nMetricReportDefinition\n被Redfish服务创建的metric report可以用Redfish event服务传输上报，或者被存储在本地用于检索，或者都支持。Metric report根据读数变化或者上报请求周期性地创建，常见用于聚合metric读数。\n与MetricDefinition类似，MetricReportDefinition资源定义了metric report的内容和周期性，也包含这个定义适用的metric properties.\n\n在MetricReportDefinition资源下，属性可以被分为四类：context, when to generate, disposition和metric references.\ncontext\ncontext类提供以下属性：\n\nProperty\nDescription\nValues\n\nMetricReportDefinitionType\nmetric report创建的方式\nPeriodic: 周期性生成OnChange: metric值变化时生成OnRequest: 用户侧发送GET请求时生成\n\nMetricReportDefinitionEnabled\n是否允许对应metric report生成\nboolean\n\nwhen to generate\n当MetricReportDefinitionType为Periodic时，对应Schedule指定生成metric report的时间。Schedule下RecurrenceInterval属性决定了生成metric report的频率，其它属性则控制metric report生成的其它方面。\n下面的例子指定metric report每60s生成一次，100次后停止。\n{\n    \"MetricReportDefinitionType\": \"Periodic\",\n    \"Schedule\": {\n        \"RecurrenceInterval\": \"PT60S\",\n        \"MaxOccurrences\": 100\n    },\n    ...\n}\n\ndisposition\n下面的属性定义了服务对matric值进行的操作：\n\nProperty\nDescription\nValues\n\nReportActions\n指定当metric report生成时对其进行的操作\nLogToMetricReportsCollection: metric report生成时，将其记录到metric report集合中RedfishEvent: metric report生成时，发送MetricReport类型的Redfish事件消息\n\nReportUpdates\n指定当metric report已经存在时如何操作后续报告\nOverwrite: 以更新过的报告覆盖之前的报告AppendWrapsWhenFull: 当metric report更新时，将新的信息附加到报告中，达到最大容量后开始覆盖AppendStopsWhenFull: 当metric report更新时，将新的信息附加到报告中，达到最大容量就停止NewReport: 当metric report更新时，创建一个新的metric report, 资源名为metric report资源名加时间戳\n\nCalculationAlgorithm\n指定适用于metric properties list的函数\nAverage: metric是这个metric一段时间的读数的平均值Maximum: metric是这个metric一段时间的读数的最大值Minimum: metric是这个metric一段时间的读数的最小值Summation: metric是这个metric一段时间的读数的和\n\nCollectionTimeScope\n指定收集metric值的时间范围\nPoint: metric值适用于Timestamp属性指定的时间点Interval: metric值适用于Timestamp和CollectionDuration属性决定的一段时间StartupInterval: metric值适用于开始测量起的一个时间间隔后（存疑，原文为The metric values to a time interval that began at the startup of the measured resource.）\n\nmetric references\nMetricReportDefinition资源包含了一个引用Redfish数据模型包含的metric properties或可以被运算的metric property的列表，因此，MetricProperties属性可能作为一个属性出现，也可能作为一个Metrics属性中的属性。对于这些用法，通配符机制都适用。\nMetricProperties\nMetricProperties为array类型，以指向包含在metric report中的metrics为元素，可能含有通配符。\n下面的JSON片段指向了两个机架实例Tray_1和Tray_2的PowerControl属性的第0项中的AverageConsumedWatts属性。\n{\n    \"Wildcards\": [\n        {\n            \"Name\": \"PWild\",\n            \"Values\": [\n                \"0\"\n            ]\n        },\n        {\n            \"Name\": \"TWild\",\n            \"Values\": [\n                \"Tray_1\",\n                \"Tray_2\"\n            ]\n        }\n    ],\n    \"MetricProperties\": [\n        \"/redfish/v1/Chassis/{TWild}/Power#/PowerControl/{PWild}/PowerConsumedWatts/PowerMetrics/AverageConsumedWatts\"\n    ]\n}\n\nMetrics\n尽管上面的例子可以用于引用关注的Redfish模型中的属性，但还有相当一部分场景需要用到无法直接获取的属性。为覆盖这些情况，Metrics属性可以用于指向对metric property进行的运算，实现定义不存在于Redfish数据模型的数据。\nMetrics属性用于指定metric report中包含的metrics, 这些metrics是通过将指定的算法运算到每一个列出的metric properties上得到的。Metrics属性是一个包含了以下属性的对象数组：\n\nProperty\nDescription\n\nMetricId\nmetric的标签\n\nMetricProperties\n用于执行计算的metric properties的URI列表\n\nCollectionFunction\n对列表中每个metric properties执行的函数\n\nCollectionDuration\n函数执行的时间间隔\n\nCollectionTimeScope\n函数适用的时间范围\n\n以下JSON片段定义了用PowerConsumedWatts属性第0项的PowerControl属性计算1s时间间隔的平均值。\n{\n    \"Wildcards\": [\n        {\n            \"Name\": \"PWild\",\n            \"Values\": [\n                \"0\"\n            ]\n        },\n        {\n            \"Name\": \"TWild\",\n            \"Values\": [\n                \"Tray_1\",\n                \"Tray_2\"\n            ]\n        }\n    ],\n    \"Metrics\": [\n        {\n            \"MetricId\": \"AverageConsumeWatts\",\n            \"CollectionFunction\": \"Average\",\n            \"CollectionTimeScope\": \"Interval\",\n            \"CollectionDuration\": \"PT1S\",\n            \"MetricProperties\": [\n                \"/redfish/v1/Chassis/{TWild}/Power#/PowerControl/{PWild}/PowerConsumedWatts\"\n            ]\n        }\n    ]\n}\n\nMetricReportDefinition例子\nPower数据\n{\n    \"@odata.id\": \"/redfish/v1/TelemetryService/MetricReportDefinitions/PowerMetrics\",\n    \"@odata.type\": \"#MetricReportDefinition.v1_3_0.MetricReportDefinition\",\n    \"Id\": \"PowerMetrics\",\n    \"Name\": \"Transmit and Log Power Metrics\",\n    \"MetricReportDefinitionType\": \"Periodic\",\n    \"MetricReportDefinitionEnabled\": true,\n    \"Schedule\": {\n        \"RecurrenceInterval\": \"PT0.1S\"\n    },\n    \"ReportActions\": [\n        \"RedfishEvent\",\n        \"LogToMetricReportsCollection\"\n    ],\n    \"ReportUpdates\": \"Overwrite\",\n    \"MetricReport\": {\n        \"@odata.id\": \"/redfish/v1/TelemetryService/MetricReports/PowerMetrics\"\n    },\n    \"Status\": {\n        \"State\": \"Enabled\"\n    },\n    \"Wildcards\": [\n        {\n            \"Name\": \"PWild\",\n            \"Values\": [\n                \"0\",\n                \"1\"\n            ]\n        },\n        {\n            \"Name\": \"TWild\",\n            \"Values\": [\n                \"Tray_1\",\n                \"Tray_2\",\n                \"Tray_3\"\n            ]\n        }\n    ],\n    \"MetricProperties\": [\n        \"/redfish/v1/Chassis/{TWild}/Power#/PowerControl/{PWild}/PowerMetrics/AverageConsumedWatts\",\n        \"/redfish/v1/Chassis/{TWild}/Power#/PowerControl/{PWild}/PowerMetrics/MinConsumedWatts\",\n        \"/redfish/v1/Chassis/{TWild}/Power#/PowerControl/{PWild}/PowerMetrics/MaxConsumedWatts\"\n    ]\n}\n\nPower使用率\n{\n    \"@odata.id\": \"/redfish/v1/TelemetryService/MetricReportDefinitions/PlatformPowerUsage\",\n    \"@odata.type\": \"#MetricReportDefinition.v1_3_0.MetricReportDefinition\",\n    \"Id\": \"PlatformPowerUsage\",\n    \"Name\": \"Transmit and Log Platform Power Usage\",\n    \"MetricReportDefinitionType\": \"Periodic\",\n    \"MetricReportDefinitionEnabled\": true,\n    \"Schedule\": {\n        \"RecurrenceInterval\": \"PT1H\"\n    },\n    \"ReportActions\": [\n        \"RedfishEvent\",\n        \"LogToMetricReportsCollection\"\n    ],\n    \"ReportUpdates\": \"AppendWrapsWhenFull\",\n    \"AppendLimit\": 256,\n    \"MetricReport\": {\n        \"@odata.id\": \"/redfish/v1/TelemetryService/MetricReports/PlatformPowerUsage\"\n    },\n    \"Status\": {\n        \"State\": \"Enabled\"\n    },\n    \"Wildcards\": [\n        {\n            \"Name\": \"PWild\",\n            \"Values\": [\n                \"0\"\n            ]\n        },\n        {\n            \"Name\": \"TWild\",\n            \"Values\": [\n                \"Tray_1\",\n                \"Tray_2\"\n            ]\n        }\n    ],\n    \"MetricProperties\": [\n        \"/redfish/v1/Chassis/{TWild}/Power#/PowerControl/{PWild}/PowerConsumedWatts\"\n    ]\n}\n\nMetricReport\n由MetricReportschema定义的metric reports包含了metric读数和与这些数据相关联的元数据。根据相应的metric report definition配置，metric report可以在telemetry service下的metric report集合资源中，也可以异步地作为事件上报。\n以下属性可以在metric report中出现：\n\nProperty\nDescription\n\nMetricReportDefinition\n指向生成这个metric report的metric report definition\n\nMetricValues\n捕获到的metric读数的对象数组\n\nTimestamp\nmetric report创建的日期和时间，这不一定是对metric读数本身采样时的时间\n\nMetricValues数组包含与metric report definition相关的已被捕获的读数列表，根据metric report definition的配置，metric report可以包含历史数据。下面的属性可以用在MetricValue数组的数据中：\n\nProperty\nDescription\n\nMetricId\nmetric的标签\n\nMetricValue\nmetric读数的字符串表示。必须注意，即使是boolean和number也需要编码为字符串，也就是说客户端需要根据metric definition解码\n\nTimestamp\nmetric被服务采样的日期和时间 存疑：与上面的定义说明不太符合\n\nMetricProperty\n派生此metric的属性对应的URI\n\nMetricDefinition\n指向metric definition的链接，提供metric property的特征\n\nMetricReport例子\nPower使用率\n{\n    \"@odata.id\": \"/redfish/v1/TelemetryService/MetricReports/PlatformPowerUsage\",\n    \"@odata.type\": \"#MetricReport.v1_3_0.MetricReport\",\n    \"Id\": \"PlatformPowerUsage\",\n    \"Name\": \"PlatformPowerUsage\",\n    \"MetricReportDefinition\": {\n        \"@odata.id\": \"/redfish/v1/TelemetryService/MetricReportDefinitions/PlatformPowerUsage\"\n    },\n    \"MetricValues\": [\n        {\n            \"Timestamp\": \"2016-11-08T12:25:00-05:00\",\n            \"MetricValue\": \"103\",\n            \"MetricProperty\": \"/redfish/v1/Chassis/Tray_1/Power#/PowerControl/0/PlatformConsumedWatts\"\n        },\n        {\n            \"Timestamp\": \"2016-11-08T12:25:00-05:00\",\n            \"MetricValue\": \"103\",\n            \"MetricProperty\": \"/redfish/v1/Chassis/Tray_2/Power#/PowerControl/0/PlatformConsumedWatts\"\n        },\n        {\n            \"Timestamp\": \"2016-11-08T13:25:00-05:00\",\n            \"MetricValue\": \"106\",\n            \"MetricProperty\": \"/redfish/v1/Chassis/Tray_1/Power#/PowerControl/0/PlatformConsumedWatts\"\n        },\n        {\n            \"Timestamp\": \"2016-11-08T13:25:00-05:00\",\n            \"MetricValue\": \"106\",\n            \"MetricProperty\": \"/redfish/v1/Chassis/Tray_2/Power#/PowerControl/0/PlatformConsumedWatts\"\n        },\n        {\n            \"Timestamp\": \"2016-11-08T14:25:00-05:00\",\n            \"MetricValue\": \"107\",\n            \"MetricProperty\": \"/redfish/v1/Chassis/Tray_1/Power#/PowerControl/0/PlatformConsumedWatts\"\n        },\n        {\n            \"Timestamp\": \"2016-11-08T14:25:00-05:00\",\n            \"MetricValue\": \"107\",\n            \"MetricProperty\": \"/redfish/v1/Chassis/Tray_2/Power#/PowerControl/0/PlatformConsumedWatts\"\n        }\n    ]\n}\n\nTriggers\nTriggers资源指定了适用于列出的metrics的触发门限，可以触发一个或多个action, 如通过事件上报传输或者以log形式存储。\nTriggers资源允许用一组通用的触发器应用于多个metric properties，以消除客户端对各种资源使用触发门限的差异。\n\n通用属性\n以下属性通常用于所有Triggers资源：\n\nProperty\nDescription\nValues\n\nMetricType\n受监测的metrics类型\nNumericDiscrete\n\nTriggerActions\n触发器条件满足时进行的操作\nLogToLogService: 用日志服务记录触发器条件RedfishEvent: 作为Redfish事件上报给订阅RedfishMetricReport: 强制更新指定metric reports\n\nMetricProperties\n受触发器监测的metrics\n由Redfish数据模型对应URIs组成的字符串数组，可以使用通配符\n\nNumberic触发器\nMetricType为Numberic时配套使用NumericThresholds属性用于指定数字类型的触发器，会包含以下属性：\n\nProperty\nDescription\n\nUpperWarning\n超过正常范围的读数值\n\nUpperCritical\n超过正常范围且需要注意的读数值\n\nLowerWarning\n低于正常范围的读数值\n\nLowerCritical\n低于正常范围且需要注意的读数值\n\n上述每一个门限属性都是对象，且包含以下属性：\n\nProperty\nDescription\n\nReading\n门限值\n\nActivation\n触发触发器的门限方向\n\nDwellTime\n必须超过门限触发值的持续时间\n\nDiscrete触发器\nMetricType为Discrete时配套使用DiscreteTriggerConditions和DiscreteTriggers属性用于指定离散型触发器。\nDiscreteTriggerConditions属性指定触发器出现的条件，可以包含以下值：\n\nSpecified: 当metric值为DiscreteTriggers属性中列出的值时触发触发器\nChanges: 当metric值改变时触发触发器\n\n如果DiscreteTriggerCondition包含了Specified值，DiscreteTriggers属性就是一个定义了会触发触发器的metric取值的数组。DiscreteTriggers是一个包含了以下属性的数组：\n\nProperty\nDescription\n\nName\n触发器命名\n\nValue\n构造触发事件的离散型metric取值\n\nDwellTime\n触发器触发前单个触发事件的持续事件\n\nSeverity\n对应Redfish上报事件Severity属性取值\nlinks: #p-281-h-1, #p-281-redfish-2, #p-281-metrics-3, #p-281-telemetry-4, #p-281-telemetry-5, #p-281-metricdefinition-6, #p-281-context-7, #p-281-usage-8, #p-281-measurement-9, #p-281-metric-references-10, #p-281-metricproperties-11, #p-281-wildcards-12, #p-281-metricdefinition-13, #p-281-metricreportdefinition-14, #p-281-context-15, #p-281-when-to-generate-16, #p-281-disposition-17, #p-281-metric-references-18, #p-281-metricproperties-19, #p-281-metrics-20, #p-281-metricreportdefinition-21, #p-281-power-22, #p-281-power-23, #p-281-metricreport-24, #p-281-metricreport-25, #p-281-power-26, #p-281-triggers-27, #p-281-h-28, #p-281-numberic-29, #p-281-discrete-30",
    "topic_user_name": "",
    "best_answer_url": "",
    "reply_posts": []
}