{
    "topic_id": 2180,
    "question": "【待评审】新增webrest电源短按屏蔽功能接口评审 - content: 背景：为支持并行升级web人机接口，需要新增webrest接口：\n评审点一： UI/Rest/BMCSettings/UpdateService接口响应体中新增UpgradeMode属性，表征当前处于哪种升级模式\n\n说明：web页面有选择“并行模式”按钮，如果进行页面切换并切回固件管理页面后，需要知道当前是否正处于串行或并行模式中；\n\nuri：UI/Rest/BMCSettings/UpdateService\n变化类型：新增属性\n操作类型： GET\n应用场景：web切换到固件升级页面后，查询当前升级模式以供页面显示\n详细描述：响应参数添加下表属性\n\n属性名称\n取值类型\n说明\n取值范围\n默认值\n操作权限\n约束\n\nUpgradeMode\nstring\n当前升级模式\n“Serial”\n\n“Parallel”\n“Serial”\nReadOnly\n无\n\n为实现上述webrest接口，需要在UpdateService类下面新增属性\n\n资源path：/bmc/kepler/UpdateService\n资源interface：bmc.kepler.UpdateService\n变化类型：新增属性\n应用场景：web切换到固件升级页面后，查询当前升级模式以供页面显示，需要提供资源协作接口\n持久化类型： 不持久化\n操作权限：只读属性，ReadOnly\n详细描述：见下表\n\n属性名称\n变化类型\n签名\n访问权限\n持久化\n变化通知\n属性值来源\n说明\n是否允许为null\n约束\n\nUpgradeMode\n新增属性\ns\n读：ReadOnly\n\n写：不涉及\n无\nfalse\n组件设置\n当前升级模式\n否\n取值：“Serial”, “Parallel”\n\n评审点二：新增webrest接口，用于查询并行升级所有固件的升级状态及进度\n\n说明：web界面处于并行升级模式时，需要展示各个固件的升级状态及进度等相关信息，如果每次调用只能查询一个任务的状态的话，需要反复例测10+接口，会有性能问题，故需要增加一个接口用于统一查询所有固件的升级状态信息；\n\nuri：/UI/Rest/BMCSettings/UpdateService/UpdateProgress\n变化类型：新增uri\n操作类型： GET\n应用场景：升级页面获取正在升级固件列表用于web展示\n请求参数：{}\n响应参数：见下表\n操作权限：ReadOnly\n\n属性名称\n取值类型\n说明\n取值范围\n默认值\n是否允许为null\n约束\n\nUpgradeMode\nstring\n当前升级模式\n“Serial”\n\n“Parallel”\n“Serial”\n否\n无\n\nUpgradeTasks\narray\n正在升级的固件列表\njson对象，具体见下表\n空表\n否\n无\n\nUpgradeTasks对象参数说明如下：\n\n名称\n取值\n取值说明\n取值样例\n\nTaskName\nString\n任务名称\n\nPercentage\nString\n升级进度（百分比）\n8%\n\nTaskState\nString\n升级状态，具体取值如下：\n\nPending：挂起状态\n\nRunning：正在升级\n\nWarning：升级异常\n\nCompleted：升级完成)\nRunning\n\nErrorCode\nint32\n错误码，取值如下：\n\n1：升级固件异常\n\n2：升级文件不存在\n\n3：无效的升级固件\n\n4：内存不足\n\n8：先下电之后才能升级\n\n9：固件版本不匹配\n\n12：升级固件和设备类型不匹配\n\n13：不支持升级BIOS\n\n27：升级版本和WEB不匹配\n\n28：设备状态不支持固件升级\n\n70：升级固件太旧\n1\n\nComponent\nString\n升级的固件类型\nCPLD\n\nFileName\nString\n升级的文件名称\nimage.hpm\n\n样例展示：\nURL: /UI/Rest/BMCSettings/UpdateService/UpdateProgress\n操作类型：GET\n请求参数：{}\n响应消息体举例：\n{\n    \"UpgradeMode\"：String,   // 取值范围： \"Serial\", \"Parallel\"\n    \"UpgradeTasks\": [\n        {\n            \"TaskName\": String,\n            \"Percentage\": String, // 示例：\"8%\"\n            \"TaskState\": String,   // 取值范围： \"Pending\", “Running\", \"Warning\", \"Completed\"\n            \"ErrorCode\": Number,\n            \"Component\": String,\n            \"FileName\": String\n        },\n        {\n            \"TaskName\": String,\n            \"Percentage\": String,   // 示例：\"8%\"\n            \"TaskState\": String,\n            \"ErrorCode\": Number,\n            \"Component\": String,\n            \"FileName\": String\n        },\n        {\n            \"TaskName\": String,\n            \"Percentage\": String,   // 示例：\"8%\"\n            \"TaskState\": String,\n            \"ErrorCode\": Number,\n            \"Component\": String,\n            \"FileName\": String\n        }\n    ]\n}\n\n评审点三：新增webrest统一生效接口，用于“开始生效按钮触发生效”：\n\n说明：由于固件生效需要复位BMC、下电OS等条件，该控制动作要由用户来选择，BMC不能直接操作，故通过参数让用户做决定，本次生效可以做什么样的控制操作。\n\nuri：/UI/Rest/BMCSettings/UpdateService/StartActive\n变化类型：新增uri\n操作类型： POST\n应用场景：统一生效页面一键触发生效\n请求参数：见下表\n操作权限：有\"PowerOff\"选项：BasicSetting与PowerMgmt；无\"PowerOff\"选项：BasicSetting\n\n属性名称\n取值类型\n说明\n取值范围\n默认值\n是否允许为null\n约束\n\nActivationActions\narray\n生效控制方式\n“ResetBMC”\n\n“PowerOff”\n空表\n否\n无\n\n响应参数：通用任务uri\n示例：\n// \"ActivationControl\"为空数组，代表为了生效固件可以复位BMC或者下电OS；ResetBMC：复位BMC；PowerOff：整机下电；\nURL: /UI/Rest/BMCSettings/UpdateService/StartActive\n操作类型：POST\n请求参数：\n{ \n    //  \"ActivationActions\"为可选参数，取值：\"ResetBMC\"、\"PowerOff\"\n     \"ActivationActions\": [\n         \"ResetBMC\",\n         \"PowerOff\"\n    ]\n}\n响应消息体举例：\n{\"url\":\"/UI/Rest/Task/1\"}\n\n评审点四：新增查询待生效固件状态接口，用于查询有哪些待生效固件以及固件的生效状态：\nuri：UI/Rest/BMCSettings/UpdateService/PendingFirmwareList\n变化类型：新增uri\n操作类型： GET\n应用场景：生效页面获取正在生效固件列表用于web展示\n请求参数：{}\n响应参数：见下表\n操作权限：ReadOnly\n\n属性名称\n取值类型\n说明\n取值范围\n默认值\n是否允许为null\n约束\n\nPendingFirmwareList\narray\n待生效的固件列表\njson对象，具体见下表\n空表\n否\n无\n\n样例展示：\nUI/Rest/BMCSettings/UpdateService/PendingFirmwareList\n操作类型：GET\n请求参数：\n{}\n响应消息体举例：\n{\n    \"PendingFirmwareList\": [\n        {\n            \"SystemId\": 1,\n            \"FirmwareType\": \"firmware_type\", // 固件类型\n            \"ActiveStatus\": \"active_status\", // 生效状态\n            \"ActiveAction\": \"active_action\", // 生效动作\n        }\n    ]\n}\n\nPendingFirmwareList对象参数说明如下：\n\n属性名字段\n取值\n中文\n\nSystemId\nnumber(0~255)\n\nFirmwareType\nBMC/CPLD/BIOS/VRD/MCU\n-\n\nActiveStatus\nToBeActivated/Activating/Activated\n待生效/生效中/已生效\n\nActiveAction\nResetBMC/PowerOff\n重启BMC/整机下电\n\n评审结论\n通过，具体结论如下：\n\n评审点1：同意在webrest接口  UI/Rest/BMCSettings/UpdateService 响应中新增属性 UpgradeMode，同意在资源协作接口bmc.kepler.UpdateService下新增属性UpgradeMode， 取值范围均限定为 [\"Serial\", \"Parallel\"]\n评审点2：同意在webrest接口  /UI/Rest/BMCSettings/UpdateService/UpdateProgress GET操作的响应中增加并行升级的子任务信息属性 UpgradeTasks，类型为 数组\n评审点3：同意在webrest接口 /UI/Rest/BMCSettings/UpdateService/StartActive POST操作的请求中增加可选参数 ActivationActions，类型为 数组，请求中不包含ActivationActions时按照全部取值处理（即同时包含\"ResetBMC\"、“PowerOff”）\n评审点4：同意新增待生效固件列表webrest接口 UI/Rest/BMCSettings/UpdateService/PendingFirmwareList，操作类型为 GET\nlinks: #p-5539-webwebrest-1, #p-5539-uirestbmcsettingsupdateserviceupgrademode-2, #p-5539-webrest-3, #p-5539-webrest-4, #p-5539-h-5, #p-5539-h-6",
    "topic_user_name": "wangxin",
    "best_answer_url": "",
    "reply_posts": []
}