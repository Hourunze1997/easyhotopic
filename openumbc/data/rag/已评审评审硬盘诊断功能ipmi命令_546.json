{
    "topic_id": 546,
    "question": "【已评审】评审硬盘诊断功能ipmi命令 - content: 关联issue\n支持硬盘诊断功能控制\n评审背景\n\nBMC带外硬盘日志自动收集可能会影响客户带内的性能（跟具体的硬盘有关，有的盘会出现IO跌零的现象），客户希望改成手动控制，因此需要支持通过BMC接口查询和设置硬盘诊断功能的状态，包括日志收集等。\n\n评审点\n\n扩展IPMI命令\n\n1、扩展IPMI命令\n1.1 扩展设置存储配置接口\n1.1.1 设置硬盘日志自动收集开启状态和周期\n\nIPMI命令字： 30 93\n应用场景： 设置硬盘日志自动收集开启状态和周期\n操作类型： SET\n操作权限： BasicSetting\n请求参数：\n\n字节\n名称\n取值说明\n\n1:3\nManufactureId\n0x0007DB（LS Byte first，第1个字节为DBh，第2个字节为07h，第3个字节为00h）\n\n4\nSubCommand\n0x3E\n\n5\n预留\n\n6\nParameter Selector，取值参见表1-1\n\n7\nSet Selector，取值参见表1-1\n\n8\nBlock Selector，取值参见表1-1\n\n9\nExrtern Selector，取值参见表1-1\n\n10\n[7:1]：resvered[0]：0-last frame1-casecade frame\n\n11:12\nWriting Offset\n\n13\nWriting Length\n\n14:N\nData，具体数据参见表1-1\n\n响应参数\n\n字节\n名称\n取值说明\n约束\n\n1\nCompletionCode\n响应码\n\n2:4\nManufactureId\n0x0007DB（LS Byte first，第1个字节为DBh，第2个字节为07h，第3个字节为00h）\n\n5:8\n预留\n\n9:N\nData，具体数据参见下表1-1\n\n表1-1\n\nParameter Selector\nParameter Data\n\n25（十进制）\n设置硬盘日志自动收集开启状态和收集周期请求：Set Selector，不涉及，填0xFFBlock Selector，不涉及，填0xFFExtern Selector，不涉及，填0xFFdata1：开启状态1-开启0-关闭data2：收集周期1-255（小时）\n\n示例：\nipmitool raw 0x30 0x93 0xdb 0x07 0x00 0x3E 0x00 0x19 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00 0x31 0x32 0x34\nBMC响应：完成码00、厂商Id 0xdb 0x07 0x00\n\n1.2 扩展获取存储配置接口\n1.2.1 查询硬盘日志自动收集开启状态和周期\n\nIPMI命令字： 30 93\n应用场景： 查询硬盘日志自动收集开启状态和周期\n操作类型： GET\n操作权限： ReadOnly\n请求参数：\n\n字节\n名称\n取值说明\n\n1:3\nManufactureId\n0x0007DB（LS Byte first，第一个字节为DBh，第2个字节为07h，第3个字节为00h）\n\n4\nSubCommand\n0x3D\n\n5\n预留\n\n6\nParameter Selector，取值参见表1-2\n\n7\nSet Selector，取值参见表1-2\n\n8\nBlock Selector，取值参见表1-2\n\n9\nExtern Selector，取值参见表1-2\n\n10:11\nReading offset\n\n12\nReading length\n\n响应参数\n\n字节\n名称\n取值说明\n约束\n\n1\nCompletionCode\n响应码\n\n2:4\nManufactureId\n0x0007DB（LS Byte first，第一个字节为DBh，第2个字节为07h，第3个字节为00h）\n\n5\n[7:1]：resvered[0]：0-last frame1-casecade frame\n\n6:N\nData，具体数据参见下表1-2\n\n表1-2\n\nParameter Selector\nParameter Data\n\n25（十进制）\n查询硬盘日志自动收集开启状态和收集周期请求：Set Selector，不涉及，填0xFFBlock Selector，不涉及，填0xFFExtern Selector，不涉及，填0xFF响应：data1：开启状态1-开启0-关闭data2：收集周期：1-255（小时）\n\n示例：\nipmitool raw 0x30 0x93 0xdb 0x07 0x00 0x3D 0x00 0x19 0xFF 0xFF 0xFF 0x00 0x00 0x00\nBMC响应：完成码 00、厂商Id 0xdb 0x07 0x00、0x00、开启状态、收集周期\n\n1.3 扩展设置存储配置接口\n1.3.1 手动触发硬盘收集日志（单盘或所有盘）\n\nIPMI命令字： 30 93\n应用场景： 手动触发硬盘收集日志（单盘或所有盘）\n操作类型： SET\n操作权限： BasicSetting\n请求参数：\n\n字节\n名称\n取值说明\n\n1:3\nManufactureId\n0x0007DB（LS Byte first，第1个字节为DBh，第2个字节为07h，第3个字节为00h）\n\n4\nSubCommand\n0x3E\n\n5\n预留\n\n6\nParameter Selector，取值参见表1-3\n\n7\nSet Selector，取值参见表1-3\n\n8\nBlock Selector，取值参见表1-3\n\n9\nExrtern Selector，取值参见表1-3\n\n10\n[7:1]：resvered[0]：0-last frame1-casecade frame\n\n11:12\nWriting Offset\n\n13\nWriting Length\n\n14:N\nData，具体数据参见表1-3\n\n响应参数\n\n字节\n名称\n取值说明\n约束\n\n1\nCompletionCode\n响应码\n\n2:4\nManufactureId\n0x0007DB（LS Byte first，第1个字节为DBh，第2个字节为07h，第3个字节为00h）\n\n5:8\n预留\n\n9:N\nData，具体数据参见下表1-3\n\n表1-3\n\nParameter Selector\nParameter Data\n\n26（十进制）\n手动触发硬盘日志收集（单盘或所有盘）请求：Set Selector：不涉及，填0xFFBlock Selector：物理盘IDBlock Selector不等于0xFF：收集指定Id的物理盘日志；Block Selector等于0xFF：收集所有物理盘日志Extern Selector：不涉及，填0xFF\n\n示例：\nipmitool raw 0x30 0x93 0xdb 0x07 0x00 0x3E 0x00 0x1A 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00\nBMC响应：响应码00、厂商Id 0xdb 0x07 0x00\n\n评审结论：\n（1）同意扩展IPMI命令设置硬盘日志自动收集开启状态LogAutoCollectEnable、收集周期LogAutoCollectInterval\n\nIPMI命令字：30 93\n子命令：0x3E\n操作权限：BasicSetting\nParameter Selector：25\n\n（2）同意扩展IPMI命令查询硬盘日志自动收集开启状态LogAutoCollectEnable、收集周期LogAutoCollectInterval\n\nIPMI命令字：30 93\n子命令：0x3D\n操作权限：ReadOnly\nParameter Selector：25\n\n（3）同意扩展IPMI命令手动触发收集硬盘日志\n\nIPMI命令字：30 93\n子命令：0x3E\n操作权限：BasicSetting\nParameter Selector：26\n请求说明：\n仅涉及Block Selector（物理盘Id）；Set Selector修改为不涉及，填0xFF\nBlock Selector不等于0xFF：收集指定Id的物理盘日志；\nBlock Selector等于0xFF：收集所有物理盘日志\nlinks: #p-1055-issue-1, https://gitcode.com/openUBMC/storage/issues/7, #p-1055-h-2, #p-1055-h-3, #p-1055-h-1ipmi-4, #p-1055-h-11-5, #p-1055-h-111-6, #p-1055-h-1-1-7, #p-1055-h-12-8, #p-1055-h-121-9, #p-1055-h-1-2-10, #p-1055-h-13-11, #p-1055-h-131-12, #p-1055-h-1-3-13, #p-1055-h-14",
    "topic_user_name": "Fangzq",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/546/2",
            "text": ""
        }
    ]
}