{
    "topic_id": 1020,
    "question": "【已评审】支持新增自定义用户角色设置 - content: 支持新增自定义用户角色设置\nISSUE链接：\n\ngitcode.com\n\nGitCode - 全球开发者的开源社区,开源代码托管平台\nGitCode是面向全球开发者的开源社区,包括原创博客,开源代码托管,代码协作,项目管理等。与开发者社区互动,提升您的研发效率和质量。\n\n背景:\n某互联网客户需要支持新增自定义用户角色, 当前4个自定义用户角色不满足使用\n决策点：\n\n资源协作接口/bmc/kepler/AccountService/Roles新增bmc.kepler.AccountService.Roles接口,接口新增New方法;新增ExtendedCustomRoleEnabled属性\n\n资源协作接口/bmc/kepler/AccountService/Roles/${RoleId} bmc.kepler.AccountService.Role接口下新增Delete方法;\n\n<V2已实现>Web-Rest支持/UI/Rest/AccessMgnt/RightManagement的POST接口;\n\n<V2已实现>Web-Rest新增/UI/Rest/AccessMgnt/RightManagement/${RoleId}接口,支持DELETE;\n\nWeb-Rest /UI/Rest/AccessMgnt/AdvancedSecurity接口新增属性ExtendedCustomRoleEnabled;\n\n<V2特定客户已实现>导入导出项UserRole的Id范围支持CustomRole5~CustomRole16；增加配置导入子项EnabledStatus\n\n兼容性风险：\n\n升级版本新增自定义角色， 并有用户/用户组使用此角色后， 回退旧版本会发生异常\n计划先预埋能力，能力默认不开启，由客户组件仓做开启操作\n\n详细描述：\n一、资源协作接口/bmc/kepler/AccountService/Roles新增bmc.kepler.AccountService.Roles接口,接口新增New方法:\n资源路径: /bmc/kepler/AccountService/Roles\n资源接口: bmc.kepler.AccountService.Roles\n应用场景: 创建自定义用户角色\nBMC权限定义与Redfish权限定义映射关系\n\nPrivilegeMap配置权限\n接口九大权限\n九大权限英文名称\n\nLogin\n查询功能\nReadOnly\n\nConfigureUsers\n用户配置\nUserMgmt\n\nConfigureSelf\n配置自身\nConfigureSelf\n\nConfigureComponents\n常规设置\nBasicSetting\n\nOemPowerControl\n电源控制\nPowerMgmt\n\nOemSecurityMgmt\n安全配置\nSecurityMgmt\n\nOemKvm\n远程控制\nKVMMgmt\n\nOemVmm\n远程媒体\nVMMMgmt\n\nOemDiagnosis\n调试诊断\nDiagnoseMgmt\n\n创建自定义用户角色方法\n\n字段\n值\n\n方法名称\nNew\n\n变化类型\n新增方法\n\nreq签名\na{ss}yasas\n\nreq说明\na{ss}:上下文信息y: RoleId，表示自定义角色Id，取值范围：9~20，分别对应CustomRole5~16as: AssignedPrivileges，表示支持的标准权限，取值范围为[“ConfigureSelf”, “ReadOnly”, “BasicSetting”, “UserMgmt”]as: OemPrivileges，表示支持的Oem权限，取值范围[“DiagnoseMgmt”, “PowerMgmt”, “SecurityMgmt”, “VMMMgmt”, “KVMMgmt”]\n\nrsp签名\n/\n\nrsp说明\n/\n\n权限\nUserMgmt\n\n新增ExtendedCustomRoleEnabled属性\n\n字段\n值\n\n属性名称\nExtendedCustomRoleEnabled\n\n变化类型\n新增属性\n\n签名\nb\n\n读写&权限\nR:ReadOnlyW:UserMgmt\n\n持久化\n掉电持久化\n\n变化通知\nfalse\n\n接口说明\n支持新增定制自定义角色能力开关\n\n接口约束\nNA\n\n二、资源协作接口/bmc/kepler/AccountService/Roles/{id} bmc.kepler.AccountService.Role接口下新增Delete方法:\n资源路径: /bmc/kepler/AccountService/Roles/${RoleId}\n资源接口: bmc.kepler.AccountService.Role\n应用场景: 删除自定义用户角色\n\n字段\n值\n\n方法名称\nDelete\n\n变化类型\n新增方法\n\nreq签名\na{ss}\n\nreq说明\na{ss}:上下文信息\n\nrsp签名\n/\n\nrsp说明\n/\n\n权限\nUserMgmt\n\n三、Web-Rest接口/UI/Rest/AccessMgnt/RightManagement新增支持POST操作：\nuri: /UI/Rest/AccessMgnt/RightManagement\n变化类型: 新增接口操作\n操作类型: POST\n应用场景: 创建自定义用户角色\n操作权限: UserMgmt\n请求示例\n{    \n    \"BasicConfigEnabled\": false,\n    \"DiagnosisEnabled\": false,\n    \"ID\": 9,\n    \"PowerControlEnabled\": false,\n    \"ReauthKey\": \"xxx\",\n    \"RemoteControlEnabled\": false,\n    \"SecurityConfigEnabled\": false,\n    \"UserConfigEnabled\": false,\n    \"VMMEnabled\": false\n}\n\n参数\n类型\n是否必选\n属性说明\n取值范围\n\nID\nInteger\n是\n自定义用户角色ID\n9~14, 16~21(V2的id15被NoAccess占用，此处与V2保持一致9~14对应CustomRole5~10，16~21对应CustomRole11~16)\n\nBasicConfigEnabled\nBoolean\n是\n常规设置使能\ntrue/false\n\nDiagnosisEnabled\nBoolean\n是\n调试诊断使能\ntrue/false\n\nPowerControlEnabled\nBoolean\n是\n电源控制使能\ntrue/false\n\nRemoteControlEnabled\nBoolean\n是\n远程控制使能\ntrue/false\n\nSecurityConfigEnabled\nBoolean\n是\n安全配置使能\ntrue/false\n\nUserConfigEnabled\nBoolean\n是\n用户配置使能\nfalse(不允许开启)\n\nVMMEnabled\nBoolean\n是\n远程媒体使能\ntrue/false\n\nReauthKey\nString\n是\n二次认证密文\n/\n\n错误说明：\n\n字段\n值\n\n错误场景\n增加自定义角色ID已存在\n\n错误名\nResourceAlreadyExists\n\nDescription\nIndicates that a resource change or creation was attempted but that the operation cannot proceed because the resource already exists.\n\nMessage\nThe requested resource already exists.\n\nSeverity\nCritical\n\nResolution\nDo not repeat the create operation as the resource has already been created.\n\nHttpStatusCode\n400\n\nSnmpStatusCode\n5\n\nIpmiCompletionCode\n0xff\n\n四、Web-Rest新增/UI/Rest/AccessMgnt/RightManagement/${RoleId}接口,支持DELETE：\nuri: /UI/Rest/AccessMgnt/RightManagement/${RoleId}\nRoleId范围: 9~14, 16~21(V2的id15被NoAccess占用，此处与V2保持一致9~14对应CustomRole5~10，16~21对应CustomRole11~16)\n变化类型: 新增DELETE接口\n操作类型: DELETE\n应用场景: 删除自定义用户角色\n操作权限: UserMgmt\n\n参数\n类型\n属性说明\n取值范围\n\nReauthKey\nString\n二次认证密文\n/\n\n五、Web-Rest /UI/Rest/AccessMgnt/AdvancedSecurity接口新增属性ExtendedCustomRoleEnabled:\nuri: /UI/Rest/AccessMgnt/AdvancedSecurity\n变化类型: 新增属性ExtendedCustomRoleEnabled\n操作类型： GET\n应用场景: 根据属性校验是否开启定制功能（V2此功能通过定制化Id判断是否开启）\n\n字段\n字段说明\n类型\n默认值\n\nExtendedCustomRoleEnabled\n新增自定义角色使能标志\nBoolean\nfalse\n\n六、导入导出项UserRole的Id范围支持CustomRole5~CustomRole16:\n\n字段\n值\n\n导出项\nUserRole\n\n导出子项\nId\n\n含义说明\n角色编号\n\n约束说明\n取值类型：字符串导入导出类型：支持导入和导出是否支持导出后直接导入生效：是\n\n取值类型\nstring\n\n属性类型\nImportAndExport\n\n取值说明\n取值范围：“NoAccess”, “CommonUser”, “Operator”, “Administrator”, “CustomRole${RoleId}”(RoleId:1~16)(默认CustomRole1~CustomRole4，客户可定制CustomRole5~16)\n\n备注\n1.当Id为[“NoAccess”, “CommonUser”, “Operator”, “Administrator”]时，不可修改权限2.导入仅支持变更自定义角色的权限配置；“CustomRole${RoleId}”,3.支持通过导入Id创建5~16号自定义角色\n\n补充：\n\n字段\n值\n\n导出项\nUserRole\n\n导出子项\nEnabledStatus\n\n含义说明\n角色使能(标志自定义角色的新增/删除)\n\n约束说明\n取值类型：bool默认值：true导入导出类型：支持导入和导出是否支持导出后直接导入生效：是\n\n取值类型\nbool\n\n属性类型\nImportAndExport\n\n取值说明\n取值范围：true/false\n\n备注\n1.对于UserRole.Id为CustomRole5~16的配置项：1)EnabledStatus为true时表示增加角色（当角色已存在时则为修改角色）2)EnabledStatus为false时表示删除角色2.对于UserRole.Id为\"NoAccess\", “CommonUser”, “Operator”, \"Administrator\"或CustomRole1~4时1)EnabledStatus仅支持导出，导入时会被忽略\n\n评审结论\n决策点1：同意新增资源协作接口bmc.kepler.AccountService.Roles，并且新增如下方法和属性\n1）新增New方法，请求签名：a{ss}yasas，响应签名：无，权限UserMgmt\n2）新增属性ExtendedCustomRoleEnabled，签名b，读权限：ReadOnly，写权限：UserMgmt，默认值为false，不发送变化通知；\n决策点2：同意资源协作接口bmc.kepler.AccountService.Role新增Delete方法，无请求签名和响应签名，权限UserMgmt\n决策点3：同意webrest接口/UI/Rest/AccessMgnt/RightManagement新增支持POST操作;\n决策点4：同意新增webrest接口/UI/Rest/AccessMgnt/RightManagement/${RoleId}，且支持DELETE操作\n决策点5：同意webrest接口/UI/Rest/AccessMgnt/AdvancedSecurity新增只读属性ExtendedCustomRoleEnabled\n决策点6：同意UserRole配置项的Id取值范围扩展支持CustomRole5~CustomRole，同意新增子项EnabledStatus\nlinks: #p-2145-h-1, #p-2145-issue-2, https://gitcode.com/openUBMC/account/issues/11, https://gitcode.com/openUBMC/account/issues/11, #p-2145-h-3, #p-2145-h-4, #p-2145-h-5, #p-2145-h-6, #p-2145-bmckepleraccountservicerolesbmckepleraccountservicerolesnew-7, #p-2145-bmckepleraccountservicerolesid-bmckepleraccountserviceroledelete-8, #p-2145-web-restuirestaccessmgntrightmanagementpost-9, #p-2145-web-restuirestaccessmgntrightmanagementroleiddelete-10, #p-2145-web-rest-uirestaccessmgntadvancedsecurityextendedcustomroleenabled-11, #p-2145-userroleidcustomrole5customrole16-12, #p-2145-h-13",
    "topic_user_name": "fangyufan",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1020/2",
            "text": ""
        }
    ]
}