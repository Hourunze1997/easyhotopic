{
    "topic_id": 1653,
    "question": "【已评审】新增查询/设置环境变量北向接口（IPMI/CLI）评审 - content: 【背景说明】:\n\n一、某机型HOST芯片没有集成GE控制器，在BMC芯片里集成了2个GE控制器，HOST芯片通过PCIe连接BMC芯片，由BMC芯片给HOST芯片出GE口；BMC芯片GE控制器的MAC地址通过环境变量控制；使用场景为：生产装备加工环节或者研发阶段，需要通过IPMI接口或者CLI命令配置HOST.GMAC的MAC地址\n二、安全协处理器所使用内存大小可动态调整，由具体的产品根据是否启用可信平台控制模块，在装备阶段配置协处理器内存大小限制值到环境变量。使用场景为：装备阶段，对安全协处理器所使用内存大小进行配置\n基于以上两个场景，需要新增北向接口以支持查询/设置环境变量\n\n评审点一，新增设置/查询环境变量的IPMI命令：\n设置环境变量的IPMI命令： Set Soc Environment Variable\n操作类型：SET\n请求说明：\n\n字节顺序\n域内容\n\nNetFn\n30h\n\nCMD\n90h\n\n1\nSub command，子命令= 0x80\n\n2\nParameter Selector\n\n3\nData Length\n\n4:N\nConfiguration parameter data 请参见表Host Info Parameters Table - set\n\n响应说明：\n\n字节顺序\n域内容\n\n1\nCompletion Code\n\n表Host Info Parameters Table - set\n\nParameter\n操作权限\n#\nParameter Data\n说明\n\nSet Host Gmac\nBasicSetting\n01h\n请求：data3：Data Length 7；data4：HostGmacIndex；data[5-10]：MacAddr\n\nSet Coprocessor Boot Mem Limit\nSecurityMgmt\n02h\n请求：data3：Data Length 4；data[4-7]：MemSize，十六进制\n仅限装备使用\n\n使用示例：\n// 请求：设置HOST.GMAC 1的MAC地址为00 18 82 01 02 04\nipmitool raw 30 90 80 01 07 01 00 18 82 01 02 04\n// 响应：\n00\n\n查询环境变量的IPMI命令：Get Soc Environment Variable\n操作类型：GET\n请求说明：\n\n字节顺序\n域内容\n\nNetFn\n30h\n\nCMD\n90h\n\n1\nSub command，子命令= 0x81\n\n2\nParameter Selector\n\n3\nData Length\n\n4:N\nParameter Data 请参见表Host Info Parameters Table - get\n\n响应说明：\n\n字节顺序\n域内容\n\n1\nCompletion Code\n\n2\nData Length\n\n3:N\nParameter Data 请参见表Host Info Parameters Table - get\n\n表Host Info Parameters Table - get\n\nParameter\n操作权限\n#\nParameter Data\n说明\n\nGet Host Gmac\nBasicSetting\n01h\n请求：Data Length: 1；data4：HostGmacIndex。响应：Data Length：6；data[3-8]：MacAddr\n\nGet Coprocessor Boot Mem Limit\nSecurityMgmt\n02h\n请求：Data Length: 0。响应：Data Length：4；data[3-6]：MemSize，十六进制。\n仅限装备使用\n\n使用示例：\n// 请求：查询HOST.GMAC 1的MAC地址\nipmitool raw 30 90 81 01 01 01\n// 响应：\n00 06 00 18 82 01 02 04\n\n评审点二，新增设置HOST.GMAC的CLI命令：\n查询SOC环境变量的CLI命令：\n变化类型：新增命令字\n操作权限：BasicSetting\nipmcget -t envvar -d <dataitem> -v <gmacindex>\n    -d <dataitem>\n       hostgmac                      Get host GMAC address\n\n使用示例：\n// 请求：查询HOST.GMAC 1的MAC地址\nipmcget -t envvar -d hostgmac -v 1\n\n20:22:01:88:AB:48\n\n设置SOC环境变量的CLI命令：\n变化类型：新增命令字\n操作权限：BasicSetting\nipmcset -t envvar -d <dataitem> -v <gmacindex> <macaddr>\n    -d <dataitem>\n       hostgmac                      Set host GMAC address\n\n使用示例：\n// 请求：设置HOST.GMAC 1的MAC地址\nipmcset -t envvar -d hostgmac -v 1 20:22:01:88:AB:48\n\nSet host GMAC address successfully.\n\n参数说明：\n\n参数名称\n取值类型\n说明\n取值范围\n是否可选\n\ngmacindex\ninteger\ngmac的索引\n[1, 2]\n否\n\nmacaddr\nstring\nmac地址\nmac地址\n否\n\n评审结论\n\n评审点1： 通过，同意新增IPMI命令，用于查询和设置 SoC 环境变量信息，其中命令的 NetFn = 30h， Cmd = 90h，子命令字设置为 80h， 查询为 81h。具体命令定义，参数说明以及权限见议题。\n评审点2： 通过，同意新增CLI命令，用于查询和设置 HOST GMAC 信息。具体命令如下：查询：ipmcget -t envvar -d hostgmac -v <gmacindex>设置：ipmcset -t envvar -d hostgmac -v <gmacindex> <macaddr>具体的命令定义以及参数说明见议题。\nlinks: #p-4013-ipmi-1, #p-4013-ipmi-set-soc-environment-variable-2, #p-4013-set-3, #p-4013-h-4, #p-4013-h-5, #p-4013-host-info-parameters-table-set-6, #p-4013-h-7, #p-4013-ipmiget-soc-environment-variable-8, #p-4013-get-9, #p-4013-h-10, #p-4013-h-11, #p-4013-host-info-parameters-table-get-12, #p-4013-h-13, #p-4013-hostgmaccli-14, #p-4013-soccli-15, #p-4013-h-16, #p-4013-basicsetting-17, #p-4013-h-18, #p-4013-soccli-19, #p-4013-h-20, #p-4013-basicsetting-21, #p-4013-h-22, #p-4013-h-23, #p-4013-h-24",
    "topic_user_name": "lixiaoning",
    "best_answer_url": "",
    "reply_posts": [
        {
            "user_name": "huanghan",
            "topic_closed": null,
            "is_solution": false,
            "post_url": "/t/topic/1653/2",
            "text": ""
        }
    ]
}