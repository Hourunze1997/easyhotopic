{
    "topic_id": 873,
    "question": "咨询openUBMC是否同时支持两个调试网口 - content: 看1711模组手册，应该是支持两个网口，gmac0现在做调试，gmac1现在也想用起来。想咨询一下如果使用两个网口，openUBMC需要如何修改配置。\nimage922×210 47.7 KB\nimage747×303 49.6 KB\n目前硬件上是两个口都接了phy引出\nlinks: https://discuss.openubmc.cn/uploads/default/original/1X/e4d4828d4f6898aefeccff31de4773343b2b8a3b.png, https://discuss.openubmc.cn/uploads/default/original/1X/b7936c1e14239a4197e2c9c5c5b99841ab15b9c4.png",
    "topic_user_name": "南京百敖",
    "best_answer_url": "/t/topic/873/2",
    "reply_posts": [
        {
            "user_name": "lixiaoning",
            "topic_closed": true,
            "is_solution": true,
            "post_url": "/t/topic/873/2",
            "text": "感谢咨询，针对您的问题，这边有如下建议：\n\n1711模组支持4路网口数据通道：两路RMII（RMII0、RMII1）对应eth0、eth1和两路SGMII（SGMII0、SGMII1）对应eth2、eth3。RMII对接百兆的PHY，SGMII对接千兆的PHY。\n根据问题中的需求，应该是要把eth3使用起来，应该优先配置一个EthMac对象，用以把eth3网口拉起来并且配置网口的MAC、网口速率等网口硬件配置。\n此外还需要配置一个EthGroup对象，用来配置该网口组的类型、IP、网段、子网掩码等。\n\n针对该网口配置的其他建议，可否请您提供一下具体业务场景，我们再针对性的给与答复。"
        },
        {
            "user_name": "南京百敖",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/873/3",
            "text": "content: 感谢回复，客户功能都用起来了，我们还给eth3做了一套命令，用来设置网络信息\nimage739×345 76.8 KB\n但是另外还有个现象，就是eth3设置网络信息后虽然可以ping通，但是BMC ethtool查看此网口的速率是10M，且连接状态是no，这块会是什么原因导致？\nimage869×578 55.4 KB\nlinks: https://discuss.openubmc.cn/uploads/default/original/2X/0/031fb4bf1a0fba417edebd16e21eeaec402deb66.png, https://discuss.openubmc.cn/uploads/default/original/2X/b/ba7fd73afe94d69093f3c4c68d838a8525c65796.png"
        },
        {
            "user_name": "lixiaoning",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/873/4",
            "text": "与我们驱动同事交流后得知ethtool查询结果依赖phy芯片，驱动层对特定的phy芯片类型做了适配，没有适配的可能会导致查询结果异常，请问一下您这边具体使用的是哪款phy芯片呢？"
        },
        {
            "user_name": "南京百敖",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/873/5",
            "text": "方案后来有变动，SGMII 1接了交换芯片\n\n（SGMII 0）⇄ PHY ⇄ 管理网口\n（SGMII 1）⇄ Switch 芯片 ⇄ PHY ⇄ 网口\n\nSGMII 0 PHY芯片型号YT8521\nSGMII 1 交换芯片型号 NF5120，PHY芯片型号1008"
        },
        {
            "user_name": "Byosoft Liyuxin",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/873/6",
            "text": "content: image741×394 56.1 KB\nimage865×520 80 KB\neth3采用上述配置\nlinks: https://discuss.openubmc.cn/uploads/default/original/2X/f/fec01800573693126500066d6557eb3da1cd814e.jpeg, https://discuss.openubmc.cn/uploads/default/original/2X/b/b3864300554eecc28107c7012e593095b12eb776.jpeg"
        },
        {
            "user_name": "南京百敖",
            "topic_closed": true,
            "is_solution": false,
            "post_url": "/t/topic/873/7",
            "text": "content: 目前需求 通过ipmcset命令修改 Eth3相关信息像Eth2一样灵活设置\n主要修改以下信息：\n1、ipv4  ipv6地址、子网掩码、网关\n2、mac地址\n3、vlan\n目前的思路是通过linux的命令修改以上信息，但是修改后不会持久化，并且bmc的linux也不能像网络上的一些常规linux那样透过配置文件持久化 因为找不到文件。\n  ip addr add %s/%d dev %s && \\\n        ip link set %s up && \\\n        ip route replace default via %s dev %s table %d && \\\n        ip rule add from %s table %d priority 30000\n\n于是就通过openUBMC的持久化 每次在自定义组件的init的时候  将持久化的数据获取出来重新设置一遍\n在这个过程中一直出现bmc起不来的现象\n如下图的配置中  EthMac_Eth3  的MacUseEnabled :true  以及圈出来的配置 通过ipmi命令 达到了分别设置Eth2和Eth3的mac地址的目的。\n但是一旦通过linux 命令设置了其他的vlanid的时候  重启bmc就起不来了\n观察日志  当前组件起不来   虽然已经变更了  vlanid 但是 Eth3.4091的这个配置中的初始化依然向这边发送数据包 但是找不到\nimage1668×705 79.4 KB\n1970-01-01 08:48:28.791705 bmc_network ERROR: eth_group_comm.lua(75): eth3.4091 send arp result is : fail, err is : ./opt/bmc/apps/bmc_network/lualib/common/base.lua:20: arp send fail: No such device[19]\n\n1970-01-01 08:48:29.910252 bmc_network ERROR: eth_group_comm.lua(75): eth3.4091 send arp result is : fail, err is : ./opt/bmc/apps/bmc_network/lualib/common/base.lua:20: arp send fail: No such device[19]\nlinks: https://discuss.openubmc.cn/uploads/default/original/2X/2/274ec578156c6772bcc24f72d29142e5a792f8d3.jpeg"
        }
    ]
}