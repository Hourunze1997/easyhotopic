{
    "topic_id": 224,
    "question": "manifest.yml支持的模板变量说明 - content: 功能说明\n构建策略配置文件manifest.yml支持模板变量，这些变量将在构建时替换成真实值，如：\ngpp:\n  files:\n    # rootfs镜像文件固定为rootfs_BMC.img\n    - file: ${work_out}/rootfs_BMC.img\n    # rootfs镜像压缩文件固定为rootfs_BMC.img\n    - file: ${work_out}/rootfs_BMC.tar.gz\n    # rootfs_BMC.img的cms签名文件\n    - file: ${work_out}/rootfs_BMC.img.cms\n\n其中${work_out}就是一个模板变量，用于指定构建任务临时输出目录home/manifest/temp/build_openUBMC_debug_dev/output，因此，构建时会替换为:\n# 构建gpp包所需配置。\n# manufecture中的gpp/files会覆盖当前的配置\ngpp:\n  files:\n    # rootfs镜像文件固定为rootfs_BMC.img\n    - file: home/manifest/temp/build_openUBMC_debug_dev/output/rootfs_BMC.img\n    # rootfs镜像压缩文件固定为rootfs_BMC.img\n    - file: home/manifest/temp/build_openUBMC_debug_dev/output/rootfs_BMC.tar.gz\n    # rootfs_BMC.img的cms签名文件\n    - file: home/manifest/temp/build_openUBMC_debug_dev/output/rootfs_BMC.img.cms\n\n模板变量清单\n当前支持的模板变量及说明：\n\n变量名\n说明\n\ncode_root\nbuild目录，展开为[manifest]/\n\nproduct\nproduct目录，展开为[manifest]/build/product\n\nmanufacture\n生产配置目录，展开为[manifest]/build/manufacture\n\nhpm_build_dir\nhpm构建目录，展开为[manifest]/temp/build_[board_name][build_type][build_stage]/hpm_build_dir\n\nboard_path\n单板临时目录，构建时会下载或复制一些临时文件放在此处，展开为[manifest]/temp/board_[board_name]\n\nori_board_path\nmanifest.yml所在目录\n\nversion\n版本号，会自动截断B版本号，如1.01.02.03.B004则version的版本号为1.01.02.03\n\nmanufacture_version\n装备版本号，一般会在version的最后一段加1表示（耦数表示release版本号）\n\nmanufacture_code\n装备编码，对应publish构建时-z指定的参数，如05024ABC，跟manfiest.yml的manufacture配置相同\n\ntosupporte_code\n发布编码，对应publish构建时-sc指定的参数，默认为default，跟manifest.yml的tosupport配置相同\n\nboard_name\n单板名称，如openUBMC\n\nwork_out\n构建时临时制品存储目录，展开为[manifest]/temp/build_[board_name][build_type][build_stage]/output\n\noutput_path\n最终制品存储目录，展开为[manifest]/output\n\nsdk_path\n芯片SDK目录，展开为[manifest]/temp/build_[board_name][build_type][build_stage]/sdk\n\nmajor_ver\n主版本号，对应1.01.02.03.B001中的1\n\nminor_ver\n次版本号，对应1.01.02.03.B001中的01\n\nrelease_ver\n发布版本号，对应1.01.02.03.B001中的02\n\npatch_ver\n补丁版本号，对应1.01.02.03.B001中的03\n\nbuild_ver\n构建号，对应对应1.01.02.03.B001中的B001\n\nshow_version\n对应manfiest.yml的base/show_version\n\n注：\n\n[manifest] 对应manifest仓的路径\n[board_name] 是当前正在构建的单板名，如openUBMC\n[build_type] 指构建类型，对应bingo build的-bt参数，取值为release或debug\n[build_stage] 指构建阶段，对应bingo build的–stage参数，取值为dev、rc、stable\n\n时间戳模板\nmanifest.yml支持时间戳模板，在构建时会按python的时间戳格式替换，系统启动构建时会记录一个时间戳，因此可以保证单次构建的所有时间戳格式化输出一致。\n当前只有package_name以及files的源和目标文件名中使用，时间戳模板与python的时间格式化完全相同，支持的格式参考  datetime — 基本日期和时间类型 — Python 3.13.2 文档\n如：\ntosupporte:\n  default:\n    package_name: \"toCommunity/toTest/${board_name}_%Y%m%d%H%M%S.zip\"\n    build_type: release\n    files:\n      - file: \"${output_path}/rootfs_${board_name}.hpm\"\n        dst: ${board_name}_%Y%m%d%H%M%S.hpm\n\n如果board_name为openUBMC，上述模板格式化后变为：\ntosupporte:\n  default:\n    package_name: \"toCommunity/toTest/openUBMC_20250310202122.zip\"\n    build_type: release\n    files:\n      - file: \"/home/manifest/output/rootfs_${board_name}.hpm\"\n        dst: openUBMC_20250310202122.hpm\nlinks: #p-320-h-1, #p-320-h-2, #p-320-h-3, https://docs.python.org/zh-cn/3.13/library/datetime.html#strftime-and-strptime-format-codes",
    "topic_user_name": "xuhaijun",
    "best_answer_url": "",
    "reply_posts": []
}